
(function(a){if(!Object.defineProperty){throw ("Font.js requires Object.defineProperty, which this browser does not support.")}if(!document.createElement("canvas").getContext){throw ("Font.js requires <canvas> and the Canvas2D API, which this browser does not support.")}(function(h){try{var c=new Uint8Array(1);return}catch(i){}function g(j,e){return this.slice(j,e)}function d(l,j){var e,k=l.length;if(arguments.length<2){j=0}for(e=0;e<k;++e,++j){this[j]=l[e]&255}}function f(j){var e,k;if(typeof j==="number"){e=new Array(j);for(k=0;k<j;++k){e[k]=0}}else{e=j.slice(0)}e.subarray=g;e.buffer=e;e.byteLength=e.length;e.set=d;if(typeof j==="object"&&j.buffer){e.buffer=j.buffer}return e}h.Uint8Array=f;h.Uint32Array=f;h.Int32Array=f}(a));(function(d){if(d.opera){return}if("response" in XMLHttpRequest.prototype||"mozResponseArrayBuffer" in XMLHttpRequest.prototype||"mozResponse" in XMLHttpRequest.prototype||"responseArrayBuffer" in XMLHttpRequest.prototype){return}var c;if(d.VBArray){c=function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}}else{c=function(){this.responseBody}}Object.defineProperty(XMLHttpRequest.prototype,"response",{get:c})}(a));if(!a.btoa){a.btoa=function(l){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var f,e,d,p,o,n,m,q,k=0,s=0,j="",h=[];if(!l){return l}do{f=l.charCodeAt(k++);e=l.charCodeAt(k++);d=l.charCodeAt(k++);q=f<<16|e<<8|d;p=q>>18&63;o=q>>12&63;n=q>>6&63;m=q&63;h[s++]=g.charAt(p)+g.charAt(o)+g.charAt(n)+g.charAt(m)}while(k<l.length);j=h.join("");var c=l.length%3;return(c?j.slice(0,c-3):j)+"===".slice(c||3)}}function b(){this.fontFamily="fjs"+(999999*Math.random()|0)}b.prototype.url="";b.prototype.format="";b.prototype.data="";b.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==";b.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400};b.prototype.systemfont=false;b.prototype.loaded=false;b.prototype.onload=function(){};b.prototype.onerror=function(){};b.prototype.canvas=false;b.prototype.context=false;b.prototype.validate=function(g,e,h,c,f){if(f!==false&&f<0){this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed).");return}var d=getComputedStyle(g,null).getPropertyValue("width").replace("px","");if(d>0){document.head.removeChild(e);document.body.removeChild(g);this.loaded=true;this.onload()}else{setTimeout(function(){c.validate(g,e,h,c,f===false?false:f-50)},1000)}};b.prototype.ondownloaded=function(){var E=this;var o=function(e){return String.fromCharCode(e)};var H=function(P){if(P<256){return o(0)+o(P)}var i=P>>8;var e=P&255;return o(i)+o(e)};var l=function(e){if(e<0){e=4294967295+e+1}return parseInt(e,10).toString(16)};var k=function(i,e){return 256*i+e};var G=function(P,e){var i=P>>7===1,Q;P=P&127;Q=256*P+e;if(!i){return Q}return Q-32768};var q=function(Q,P,i,e){return 16777216*Q+65536*P+256*i+e};var s=function(e){E.onerror(e)};var w=o(0)+o(1)+o(0)+o(0);var h="OTTO";var M=this.data;var J=o(M[0])+o(M[1])+o(M[2])+o(M[3]);var v=(J===w);var f=(v?false:J===h);if(v){this.format="truetype"}else{if(f){this.format="opentype"}else{s("Error: file at "+this.url+" cannot be interpreted as OpenType font.");return}}var x=k(M[4],M[5]),B=12,O,m=B+16*x,u={},F;for(O=B;O<m;O+=16){F=o(M[O])+o(M[O+1])+o(M[O+2])+o(M[O+3]);u[F]={name:F,checksum:q(M[O+4],M[O+5],M[O+6],M[O+7]),offset:q(M[O+8],M[O+9],M[O+10],M[O+11]),length:q(M[O+12],M[O+13],M[O+14],M[O+15])}}var n=function(e){if(!u[e]){s("Error: font is missing the required OpenType '"+e+"' table.");return false}return e};F=n("head");if(F===false){return}O=u[F].offset;u[F].version=""+M[O]+M[O+1]+M[O+2]+M[O+3];var A=k(M[O+18],M[O+19]);this.metrics.quadsize=A;F=n("hhea");if(F===false){return}O=u[F].offset;u[F].version=""+M[O]+M[O+1]+M[O+2]+M[O+3];this.metrics.ascent=G(M[O+4],M[O+5])/A;this.metrics.descent=G(M[O+6],M[O+7])/A;this.metrics.leading=G(M[O+8],M[O+9])/A;F=n("OS/2");if(F===false){return}O=u[F].offset;u[F].version=""+M[O]+M[O+1];this.metrics.weightclass=k(M[O+4],M[O+5]);F=n("cmap");if(F===false){return}O=u[F].offset;u[F].version=""+M[O]+M[O+1];x=k(M[O+2],M[O+3]);var g,D,c,p,C,r=false;for(var g=0;g<x;g++){D=O+4+g*8;c=k(M[D],M[D+1]);p=k(M[D+2],M[D+3]);C=q(M[D+4],M[D+5],M[D+6],M[D+7]);if(c===3&&p===1){r=C}}var t="A";if(r!==false){O+=r;J=k(M[O],M[O+1]);if(J===4){var N=k(M[O+6],M[O+7])/2;var d=function(e){return[9,10,11,12,13,32,127,128,129,141,142,143,144,149,157,158,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8232,8233,8234,8235,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,12288].indexOf(e)===-1};var I=O+14,L=O+14+2*N,j=false;for(;I<L;I+=2){j=k(M[I],M[I+1]);if(d(j)){break}j=false}if(j!=false){t=String.fromCharCode(j);var z=(-(j-1)+65536)%65536;var K=o(0)+H(j)+H(65535)+H(0)+H(j)+H(65535)+H(z)+H(1);var y=btoa(K);this.base64=this.base64.substring(0,380)+y+this.base64.substring(380+y.length)}}}this.bootstrapValidation(t,false)};b.prototype.bootstrapValidation=function(d,i){var e=this.fontFamily+" testfont";var g=document.createElement("style");g.setAttribute("type","text/css");g.innerHTML="@font-face {\n  font-family: '"+e+"';\n  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n       format('truetype');}";document.head.appendChild(g);var k=false;if(!this.systemfont){k=this.toStyleNode();document.head.appendChild(k)}var m=document.createElement("p");m.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;";m.style.fontFamily="'"+this.fontFamily+"', '"+e+"'";m.innerHTML=d+d+d+d+d+d+d+d+d+d;document.body.appendChild(m);if(typeof getComputedStyle==="undefined"){this.onload();error("Error: getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.")}else{var l=this.systemfont?1000:this.metrics.quadsize;var f=document.createElement("canvas");f.width=l;f.height=l;this.canvas=f;var c=f.getContext("2d");c.font="1em '"+this.fontFamily+"'";c.fillStyle="white";c.fillRect(-1,-1,l+2,l+2);c.fillStyle="black";c.fillText("test text",50,l/2);this.context=c;var h=this;var j=function(){h.validate(m,g,k,h,i)};setTimeout(j,50)}};b.prototype.processSystemFont=function(){this.systemfont=true;this.metrics=false;this.bootstrapValidation("A",1000)};b.prototype.loadFont=function(){var c=this;if(this.url.indexOf(".")===-1){setTimeout(function(){c.processSystemFont()},10);return}var d=new XMLHttpRequest();d.open("GET",c.url,true);d.responseType="arraybuffer";d.onload=function(e){var f=d.response;if(f){c.data=new Uint8Array(f);c.ondownloaded()}else{c.onerror("Error downloading font resource from "+c.url)}};d.onerror=function(e){c.onerror("Error downloading font resource from "+c.url)};d.send(null)};b.prototype.styleNode=false;b.prototype.toStyleNode=function(){if(this.styleNode){return this.styleNode}this.styleNode=document.createElement("style");this.styleNode.type="text/css";var c="@font-face {\n";c+="  font-family: '"+this.fontFamily+"';\n";c+="  src: url('"+this.url+"') format('"+this.format+"');\n";c+="}";this.styleNode.innerHTML=c;return this.styleNode};b.prototype.measureText=function(c,j){if(!this.loaded){this.onerror("measureText() was called while the font was not yet loaded");return false}this.context.font=j+"px '"+this.fontFamily+"'";var g=this.context.measureText(c);g.fontsize=j;g.ascent=0;g.descent=0;g.bounds={minx:0,maxx:g.width,miny:0,maxy:0};g.height=0;var d=[],f=g.width/this.metrics.quadsize;if(f<=1){d.push(c)}else{d.push(c)}var h=d.length,e;for(e=0;e<h;e++){this.measureSegment(d[e],j,g)}return g};b.prototype.measureSegment=function(o,d,D){var x=function(h,i){return document.defaultView.getComputedStyle(h,null).getPropertyValue(i)};var F;var s=document.createElement("div");s.style.position="absolute";s.style.opacity=0;s.style.font=d+"px '"+this.fontFamily+"'";var c=10;s.innerHTML=o;for(F=1;F<c;F++){s.innerHTML+="<br/>"+o}document.body.appendChild(s);D.leading=1.2*d;var l=x(s,"height");l=l.replace("px","");if(l>=d*c){D.leading=(l/c)|0}document.body.removeChild(s);if(/^\s*$/.test(o)){return D}var f=this.canvas,C=this.context,r=this.systemfont?1000:this.metrics.quadsize,t=r,H=r,y=r/2,v=50,e=(r-D.width)/2;if(e!==(e|0)){e=e|0}C.fillStyle="white";C.fillRect(-v,-v,t+2*v,H+2*v);C.fillStyle="black";C.fillText(o,e,y);var B=(D.width+v)|0,A=4*d,u=e-v/2,z=y-A/2,m=C.getImageData(u,z,B,A).data;var F=0,E=0,q=B*4,G=m.length,I=A/2;while(++F<G&&m[F]===255){}var p=(F/q)|0;F=G-1;while(--F>0&&m[F]===255){}var J=(F/q)|0;for(F=0,E=0;E<B&&m[F]===255;){F+=q;if(F>=G){E++;F=(F-G)+4}}var k=E;var n=1;for(F=G-3,E=0;E<B&&m[F]===255;){F-=q;if(F<0){E++;F=(G-3)-(n++)*4}}var g=B-E;D.ascent=(I-p);D.descent=(J-I);D.bounds={minx:k-(v/2),maxx:g-(v/2),miny:-D.descent,maxy:D.ascent};D.height=1+(J-p);return D};Object.defineProperty(b.prototype,"src",{set:function(c){this.url=c;this.loadFont()}});if(typeof define!=="undefined"){define(function(){return b})}else{a.Font=b}}(window));