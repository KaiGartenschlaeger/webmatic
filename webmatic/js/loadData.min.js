
function loadConfigData(d,a,c,e,b,g,f){$.ajax({type:"GET",url:a,dataType:"json",async:d,cache:d}).done(function(i){var h;switch(c){case"config":if(!d){saveDataToFile=true;h=saveConfigFile(c,i,b,e,true)}else{h=i;optionsMap=i;localStorage.setItem(e,JSON.stringify(i))}break;case"variables":h=saveConfigFile(c,i,b,e,g);break;case"programs":h=saveConfigFile(c,i,b,e,g);break;case"favorites":h=saveConfigFile(c,i,b,e,g);break;case"rooms":h=saveConfigFile(c,i,b,e,g);break;case"functions":h=saveConfigFile(c,i,b,e,g);break;case"devices":h=i;devicesMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"configClient":optionsClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"programsClient":programsClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"favoritesClient":favoritesClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"roomsClient":roomsClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"functionsClient":functionsClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"variablesClient":variablesClientMap=i;localStorage.setItem(e,JSON.stringify(i));break}if(typeof f==="function"){f(h)}}).fail(function(h,i){if(h.status===404){createConfigFile(c,e)}else{log("Request failed: "+i,2)}})}function saveConfigFile(e,d,c,f,g){if(g){saveDataToFile=true;var a={};if(e==="rooms"||e==="favorites"||e==="functions"){var b=0;$.each(d,function(h,k){if(h==="date"){a[h]=k;return}b++;var j={};var i=k;if(k.startsWith("room")||k.startsWith("func")){k=mapText(k)}j.name=k;j.oldname=i;j.visible=true;j.position=b;j[e+"_divisor"]="unsorted";a[h]=j});a.size=b;a.divisors={}}else{if(e==="programs"){var b=0;$.each(d,function(h,j){if(h==="date"){a[h]=j;return}b++;var i={};i.name=j.name;i.oldname=j.name;i.visible=j.visible;i.oldvisible=j.visible;i.position=b;i.active=j.active;i.operate=j.operate;i.oldoperate=j.operate;i.date=j.date;i.info=j.info;i.onlyPic=false;i[e+"_divisor"]="unsorted";a[h]=i});a.size=b;a.divisors={}}else{if(e==="variables"){var b=0;$.each(d,function(l,n){if(l==="date"){a[l]=n;return}b++;var m={};var j=n.name;if(j.startsWith("%24%7B")){j=mapText(j.substring(6,j.length-3))}m.name=j;m.oldname=n.name;m.visible=n.visible;m.oldvisible=n.visible;m.position=b;m.value=n.value;m.active=n.active;var h=n.info;if(h.startsWith("%24%7B")){h=mapText(h.substring(6,h.length-3))}m.operate=isReadOnlyVariable(h);m.oldoperate=m.operate;m.date=n.date;m.info=h;var o=n.valueType;m.valueType=o;m.valueUnit=n.valueUnit;m.onlyPic=false;if(o==="16"){m.valueList=n.valueList;m.listType="auto"}else{if(o==="2"){var k=n.valueName0;if(k.startsWith("${")){k=mapText(k.substring(2,k.length-1))}m.valueName0=k;var i=n.valueName1;if(i.startsWith("${")){i=mapText(i.substring(2,i.length-1))}m.valueName1=i}else{if(o==="4"){m.valueMin=n.valueMin;m.valueMax=n.valueMax;m.step=1;m.faktor=1}}}m[e+"_divisor"]="unsorted";a[l]=m});a.size=b;a.divisors={}}else{a=d}}}a=refreshJSONObj(e,a,c);localStorage.setItem(f,JSON.stringify(a));if(saveDataToFile){saveDataToFile=false;$.post("cgi/saveconfig.cgi",{name:e,text:JSON.stringify(a)})}return a}else{setMap(e,d);return d}}function refreshJSONObj(f,e,d){var a=getMap(f);if(f==="rooms"||f==="favorites"||f==="functions"){if(!d){var b={};var c=e.size;$.each(e,function(g,j){if(g==="date"||g==="size"||g==="divisors"){if(g==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=j}}else{b[g]=j}return}if(g in a){var i=a[g];j.visible=i.visible;j.position=i.position;if(j.oldname===i.oldname){var h=i.name;if(h.startsWith("room")||h.startsWith("func")){h=mapText(h)}j.name=h}else{saveDataToFile=true}if(f+"_divisor" in i){j[f+"_divisor"]=i[f+"_divisor"]}else{j[f+"_divisor"]="unsorted";saveDataToFile=true}}else{c++;j.position=c;saveDataToFile=true}b[g]=j});b.size=c;e=b}}else{if(f==="programs"){if(!d){var b={};var c=e.size;$.each(e,function(g,i){if(g==="date"||g==="size"||g==="divisors"){if(g==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=i}}else{b[g]=i}return}if(g in a){var h=a[g];i.position=h.position;if(i.oldname===h.oldname){i.name=h.name}else{saveDataToFile=true}if(i.oldvisible===h.oldvisible){i.visible=h.visible}else{saveDataToFile=true}if(i.oldoperate===h.oldoperate){i.operate=h.operate}else{saveDataToFile=true}if("onlyPic" in h){i.onlyPic=h.onlyPic}else{i.onlyPic=false;saveDataToFile=true}if(f+"_divisor" in h){i[f+"_divisor"]=h[f+"_divisor"]}else{i[f+"_divisor"]="unsorted";saveDataToFile=true}}else{c++;i.position=c;saveDataToFile=true}b[g]=i});b.size=c;e=b}}else{if(f==="variables"){if(!d){var b={};var c=e.size;$.each(e,function(h,j){if(h==="date"||h==="size"||h==="divisors"){if(h==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=j}}else{b[h]=j}return}var k=j.valueType;if(h in a){var i=a[h];j.position=i.position;if(j.oldname===i.oldname){var g=i.name;if(g.startsWith("%24%7B")){g=mapText(g.substring(6,g.length-3))}j.name=g}else{saveDataToFile=true}if(j.oldvisible===i.oldvisible){j.visible=i.visible}else{saveDataToFile=true}if(j.oldoperate===i.oldoperate){j.operate=i.operate}else{saveDataToFile=true}if("onlyPic" in i){j.onlyPic=i.onlyPic}else{j.onlyPic=false;saveDataToFile=true}if(k==="16"){if("listType" in i){j.listType=i.listType}else{j.listType="auto";saveDataToFile=true}}else{if(k==="4"){if("step" in i){j.step=i.step}else{j.step=1;saveDataToFile=true}if("faktor" in i){j.faktor=i.faktor}else{j.faktor=1;saveDataToFile=true}}}if(f+"_divisor" in i){j[f+"_divisor"]=i[f+"_divisor"]}else{j[f+"_divisor"]="unsorted";saveDataToFile=true}}else{c++;j.position=c;saveDataToFile=true}b[h]=j});b.size=c;e=b}}else{if(f==="config"&&!d){e.storageVersion=storageVersion;if(!("ccu_historian" in e)){e.ccu_historian=""}if(!("default_menugfxsize" in e)){e.default_menugfxsize="large"}if(!("no_more_settings" in e)){e.no_more_settings=0}if(!("new_version" in e)){e.new_version="stable"}if(!("dont_leave" in e)){e.dont_leave=false}if(!("clientsList" in e)){e.clientsList=!isTempClient?clientsList:new Object()}if(!("default_sort_manually" in e)){e.default_sort_manually=true}clientsList=e.clientsList;if(client!==""&&!isTempClient&&!(client in clientsList)){clientsList[client]=client;e.clientsList=clientsList}if(!("two_sites" in e)){e.two_sites=false}if(!("transition" in e)){e.transition="flip"}if(!("columns" in e)){e.columns=1}if(!("show_description" in e)){e.show_description=true}if(!("show_lastUsedTime" in e)){e.show_lastUsedTime=true}if(!("favorites_divisor" in e)){e.favorites_divisor=false}if(!("rooms_divisor" in e)){e.rooms_divisor=false}if(!("functions_divisor" in e)){e.functions_divisor=false}if(!("variables_divisor" in e)){e.variables_divisor=false}if(!("programs_divisor" in e)){e.programs_divisor=false}}}}}setMap(f,e);return e}function createConfigFile(a,b){saveDataToFile=true;if(a==="config"){var c="{";c+='"storageVersion" : '+storageVersion+",";c+='"favorites" : true,';c+='"rooms" : true,';c+='"functions" : true,';c+='"variables" : true,';c+='"programs" : true,';c+='"others" : true,';c+='"collapsed" : "rooms",';c+='"systemvar_readonly" : true,';c+='"default_theme" : "wma",';c+='"default_font" : "a",';c+='"ccu_historian" : "",';c+='"default_menugfxsize" : "large",';c+='"no_more_settings" : 0,';c+='"new_version" : "stable",';c+='"dont_leave" : false,';c+='"clientsList" : {'+(client!==""&&!isTempClient?'"'+client+'":"'+client+'"':"")+"},";c+='"default_sort_manually" : true,';c+='"two_sites" : false,';c+='"transition" : "flip",';c+='"columns" : 1,';c+='"show_description" : true,';c+='"show_lastUsedTime" : true,';c+='"favorites_divisor" : false,';c+='"rooms_divisor" : false,';c+='"functions_divisor" : false,';c+='"variables_divisor" : false,';c+='"programs_divisor" : false';c+="}";optionsMap=saveConfigFile(a,JSON.parse(c),true,b,true)}else{if(a.endsWith("Client")){var c="{}";a=a.slice(0,-6);if(client!==""){switch(a){case"config":optionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"variables":variablesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"programs":programsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"favorites":favoritesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"rooms":roomsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"functions":functionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"devices":devicesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break}}}else{loadConfigData(false,"cgi/"+a+".cgi",a,b,true,true)}}};