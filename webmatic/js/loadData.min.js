
function loadConfigData(d,a,c,e,b,g,f){$.ajax({type:"GET",url:a,dataType:"json",async:d,cache:false}).done(function(i){var h;switch(c){case"config":if(!d){saveDataToFile=true;h=saveConfigFile(c,i,b,e,true)}else{h=i;optionsMap=i;localStorage.setItem(isPreRelease+e,JSON.stringify(i))}break;case"variables":h=saveConfigFile(c,i,b,e,g);break;case"programs":h=saveConfigFile(c,i,b,e,g);break;case"favorites":h=saveConfigFile(c,i,b,e,g);break;case"rooms":h=saveConfigFile(c,i,b,e,g);break;case"functions":h=saveConfigFile(c,i,b,e,g);break;case"devices":h=saveConfigFile(c,i,b,e,g);devicesMap=h;break;case"configClient":optionsClientMap=i;localStorage.setItem(isPreRelease+e,JSON.stringify(i));break;case"programsClient":programsClientMap=i;localStorage.setItem(isPreRelease+e,JSON.stringify(i));break;case"favoritesClient":favoritesClientMap=i;localStorage.setItem(isPreRelease+e,JSON.stringify(i));break;case"roomsClient":roomsClientMap=i;localStorage.setItem(isPreRelease+e,JSON.stringify(i));break;case"functionsClient":functionsClientMap=i;localStorage.setItem(isPreRelease+e,JSON.stringify(i));break;case"variablesClient":variablesClientMap=i;localStorage.setItem(isPreRelease+e,JSON.stringify(i));break;case"devicesClient":devicesClientMap=i;localStorage.setItem(isPreRelease+e,JSON.stringify(i));break}if(typeof f==="function"){f(h)}}).fail(function(h,i){if(h.status===404){createConfigFile(c,e)}else{log("Request failed: "+i,2)}})}function saveConfigFile(e,d,c,g,h){if(h){saveDataToFile=true;var f="";var a={};if(e==="rooms"||e==="favorites"||e==="functions"){var b=0;$.each(d,function(i,m){if(i==="date"){a[i]=m;return}b++;var l={};try{m=decodeURI(m)}catch(k){}var j=m;if(m.startsWith("room")||m.startsWith("func")){m=mapText(m)}else{if(m.startsWith("${")){m=mapText(m.substring(2,m.length-1))}else{if(m.startsWith("%24%7B")){m=mapText(m.substring(6,m.length-3))}}}l.name=m;l.oldname=j;l.visible=true;l.position=b;l[e+"_divisor"]="unsorted";a[i]=l});a.size=b;a.divisors={}}else{if(e==="programs"){var b=0;$.each(d,function(i,l){if(i==="date"){a[i]=l;return}b++;var k={};try{k.name=decodeURI(l.name)}catch(j){k.name=l.name}try{k.oldname=decodeURI(l.name)}catch(j){k.oldname=l.name}k.visible=l.visible;k.oldvisible=l.visible;k.position=b;k.active=l.active;k.operate=l.operate;k.oldoperate=l.operate;k.date=l.date;try{k.info=decodeURI(l.info)}catch(j){k.info=l.info}k.onlyPic=false;k[e+"_divisor"]="unsorted";a[i]=k});a.size=b;a.divisors={}}else{if(e==="variables"){var b=0;$.each(d,function(q,k){if(q==="date"){a[q]=k;return}b++;var m={};var j;try{j=decodeURI(k.name)}catch(n){j=k.name}if(j.startsWith("${")){j=mapText(j.substring(2,j.length-1))}else{if(j.startsWith("%24%7B")){j=mapText(j.substring(6,j.length-3))}}m.name=j;try{m.oldname=decodeURI(k.name)}catch(n){m.oldname=k.name}m.visible=k.visible;m.oldvisible=k.visible;m.position=b;try{m.value=decodeURI(k.value)}catch(n){m.value=k.value}m.active=k.active;var i;try{i=decodeURI(k.info)}catch(n){i=k.info}if(i.startsWith("${")){i=mapText(i.substring(2,i.length-1))}else{if(i.startsWith("%24%7B")){i=mapText(i.substring(6,i.length-3))}}m.operate=isReadOnlyVariable(i);m.oldoperate=m.operate;m.date=k.date;m.info=i;var l=k.valueType;m.valueType=l;try{m.valueUnit=decodeURI(k.valueUnit)}catch(n){m.valueUnit=k.valueUnit}m.onlyPic=false;if(l==="16"){try{m.valueList=decodeURI(k.valueList)}catch(n){m.valueList=k.valueList}m.listType="auto"}else{if(l==="2"){var p;try{p=decodeURI(k.valueName0)}catch(n){p=k.valueName0}if(p.startsWith("${")){p=mapText(p.substring(2,p.length-1))}else{if(p.startsWith("%24%7B")){p=mapText(p.substring(6,p.length-3))}}m.valueName0=p;var o;try{o=decodeURI(k.valueName1)}catch(n){o=k.valueName1}if(o.startsWith("${")){o=mapText(o.substring(2,o.length-1))}else{if(o.startsWith("%24%7B")){o=mapText(o.substring(6,o.length-3))}}m.valueName1=o}else{if(l==="4"){m.valueMin=k.valueMin;m.valueMax=k.valueMax;m.step=1;m.faktor=1}}}m[e+"_divisor"]="unsorted";a[q]=m});a.size=b;a.divisors={}}else{if(e==="devices"){$.each(d,function(i,m){if(i==="date"){a[i]=m;return}else{if(i==="id"){a[i]=m;f=m;if(m in favoritesMap){a.name=favoritesMap[m]["name"]}else{if(m in roomsMap){a.name=roomsMap[m]["name"]}else{if(m in functionsMap){a.name=functionsMap[m]["name"]}}}}else{if(i==="entries"){var j=[];var l=0;$.each(d[i],function(n,o){l++;var p={};$.each(o,function(r,t){if(r==="channels"){var s=[];var q=0;$.each(o[r],function(w,x){q++;var v={};$.each(x,function(y,z){try{z=decodeURI(z)}catch(A){}v[y]=z});s.push(v)});p[r]=s;p.channelsCount=q}else{try{t=decodeURI(t)}catch(u){}p[r]=t}});j.push(p)});a[i]=j;a.entriesCount=l}else{try{m=decodeURI(m)}catch(k){}a[i]=m}}}})}else{a=d}}}}a=refreshJSONObj(e,a,c);localStorage.setItem(isPreRelease+g,JSON.stringify(a));if(saveDataToFile){saveDataToFile=false;$.post("cgi/saveconfig.cgi",{name:e+f,text:JSON.stringify(a),folder:userFolder})}return a}else{setMap(e,d);return d}}function refreshJSONObj(g,f,d){var a=getMap(g);if(g==="rooms"||g==="favorites"||g==="functions"){if(!d){var e=false;var b={};var c=f.size;if(c!==a.size){e=true}$.each(f,function(h,k){if(h==="date"||h==="size"||h==="divisors"){if(h==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=k}}else{b[h]=k}return}if(h in a){var j=a[h];k.visible=j.visible;k.position=j.position;if(k.oldname===j.oldname){var i=j.name;if(i.startsWith("room")||i.startsWith("func")){i=mapText(i)}else{if(i.startsWith("${")){i=mapText(i.substring(2,i.length-1))}else{if(i.startsWith("%24%7B")){i=mapText(i.substring(6,i.length-3))}}}k.name=i}else{e=true;saveDataToFile=true}if(g+"_divisor" in j){k[g+"_divisor"]=j[g+"_divisor"]}else{k[g+"_divisor"]="unsorted";e=true;saveDataToFile=true}k.picdate=j.picdate}else{c++;k.position=c;saveDataToFile=true}b[h]=k});b.size=c;f=b;if(e){activateSettingChangedButton(g)}}}else{if(g==="programs"){if(!d){var b={};var c=f.size;$.each(f,function(h,j){if(h==="date"||h==="size"||h==="divisors"){if(h==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=j}}else{b[h]=j}return}if(h in a){var i=a[h];j.position=i.position;if(j.oldname===i.oldname){j.name=i.name}else{saveDataToFile=true}if(j.oldvisible===i.oldvisible){j.visible=i.visible}else{saveDataToFile=true}if(j.oldoperate===i.oldoperate){j.operate=i.operate}else{saveDataToFile=true}if("onlyPic" in i){j.onlyPic=i.onlyPic}else{j.onlyPic=false;saveDataToFile=true}if(g+"_divisor" in i){j[g+"_divisor"]=i[g+"_divisor"]}else{j[g+"_divisor"]="unsorted";saveDataToFile=true}j.picdate=i.picdate}else{c++;j.position=c;saveDataToFile=true}b[h]=j});b.size=c;f=b}}else{if(g==="variables"){if(!d){var b={};var c=f.size;$.each(f,function(i,k){if(i==="date"||i==="size"||i==="divisors"){if(i==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=k}}else{b[i]=k}return}var l=k.valueType;if(i in a){var j=a[i];k.position=j.position;if(k.oldname===j.oldname){var h=j.name;if(h.startsWith("${")){h=mapText(h.substring(2,h.length-1))}else{if(h.startsWith("%24%7B")){h=mapText(h.substring(6,h.length-3))}}k.name=h}else{saveDataToFile=true}if(k.oldvisible===j.oldvisible){k.visible=j.visible}else{saveDataToFile=true}if(k.oldoperate===j.oldoperate){k.operate=j.operate}else{saveDataToFile=true}if("onlyPic" in j){k.onlyPic=j.onlyPic}else{k.onlyPic=false;saveDataToFile=true}if(l==="16"){if("listType" in j){k.listType=j.listType}else{k.listType="auto";saveDataToFile=true}}else{if(l==="4"){if("step" in j){k.step=j.step}else{k.step=1;saveDataToFile=true}if("faktor" in j){k.faktor=j.faktor}else{k.faktor=1;saveDataToFile=true}}}if(g+"_divisor" in j){k[g+"_divisor"]=j[g+"_divisor"]}else{k[g+"_divisor"]="unsorted";saveDataToFile=true}k.picdate=j.picdate}else{c++;k.position=c;saveDataToFile=true}b[i]=k});b.size=c;f=b}}else{if(g==="devices"){if(!d){var b={};$.each(f,function(h,i){b[h]=i});f=b}}else{if(g==="config"&&!d){f.storageVersion=storageVersion;if(!("ccu_historian" in f)){f.ccu_historian=""}if(!("default_menugfxsize" in f)){f.default_menugfxsize="large"}if(!("no_more_settings" in f)){f.no_more_settings=0}if(!("new_version" in f)){f.new_version="stable"}if(!("dont_leave" in f)){f.dont_leave=false}if(!("clientsList" in f)){f.clientsList=!isTempClient?clientsList:new Object()}if(!("default_sort_manually" in f)){f.default_sort_manually=true}clientsList=f.clientsList;if(client!==""&&!isTempClient&&!(client in clientsList)){clientsList[client]=client;f.clientsList=clientsList}if(!("two_sites" in f)){f.two_sites=false}if(!("transition" in f)){f.transition="flip"}if(!("columns" in f)){f.columns=1}if(!("show_description" in f)){f.show_description=true}if(!("show_lastUsedTime" in f)){f.show_lastUsedTime=true}if(!("favorites_divisor" in f)){f.favorites_divisor=false}if(!("rooms_divisor" in f)){f.rooms_divisor=false}if(!("functions_divisor" in f)){f.functions_divisor=false}if(!("variables_divisor" in f)){f.variables_divisor=false}if(!("programs_divisor" in f)){f.programs_divisor=false}}}}}}setMap(g,f);return f}function createConfigFile(a,b){saveDataToFile=true;if(a==="config"){var c="{";c+='"storageVersion" : '+storageVersion+",";c+='"favorites" : true,';c+='"rooms" : true,';c+='"functions" : true,';c+='"variables" : true,';c+='"programs" : true,';c+='"others" : true,';c+='"collapsed" : "rooms",';c+='"systemvar_readonly" : true,';c+='"default_theme" : "wma",';c+='"default_font" : "a",';c+='"ccu_historian" : "",';c+='"default_menugfxsize" : "large",';c+='"no_more_settings" : 0,';c+='"new_version" : "stable",';c+='"dont_leave" : false,';c+='"clientsList" : {'+(client!==""&&!isTempClient?'"'+client+'":"'+client+'"':"")+"},";c+='"default_sort_manually" : true,';c+='"two_sites" : false,';c+='"transition" : "flip",';c+='"columns" : 1,';c+='"show_description" : true,';c+='"show_lastUsedTime" : true,';c+='"favorites_divisor" : false,';c+='"rooms_divisor" : false,';c+='"functions_divisor" : false,';c+='"variables_divisor" : false,';c+='"programs_divisor" : false';c+="}";optionsMap=saveConfigFile(a,JSON.parse(c),true,b,true)}else{if(a.endsWith("Client")){var c="{}";a=a.slice(0,-6);if(client!==""){switch(a){case"config":optionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"variables":variablesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"programs":programsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"favorites":favoritesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"rooms":roomsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"functions":functionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"devices":devicesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break}}}else{loadConfigData(false,"cgi/"+a+".cgi",a,b,true,true)}}};