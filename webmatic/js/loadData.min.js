
function loadConfigData(d,a,c,e,b,g,f){$.ajax({type:"GET",url:a,dataType:"json",async:d,cache:false}).done(function(i){var h;switch(c){case"config":if(!d){saveDataToFile=true;h=saveConfigFile(c,i,b,e,true)}else{h=i;optionsMap=i;localStorage.setItem(e,JSON.stringify(i))}break;case"variables":h=saveConfigFile(c,i,b,e,g);break;case"programs":h=saveConfigFile(c,i,b,e,g);break;case"favorites":h=saveConfigFile(c,i,b,e,g);break;case"rooms":h=saveConfigFile(c,i,b,e,g);break;case"functions":h=saveConfigFile(c,i,b,e,g);break;case"devices":h=i;devicesMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"configClient":optionsClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"programsClient":programsClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"favoritesClient":favoritesClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"roomsClient":roomsClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"functionsClient":functionsClientMap=i;localStorage.setItem(e,JSON.stringify(i));break;case"variablesClient":variablesClientMap=i;localStorage.setItem(e,JSON.stringify(i));break}if(typeof f==="function"){f(h)}}).fail(function(h,i){if(h.status===404){createConfigFile(c,e)}else{log("Request failed: "+i,2)}})}function saveConfigFile(e,d,c,f,g){if(g){saveDataToFile=true;var a={};if(e==="rooms"||e==="favorites"||e==="functions"){var b=0;$.each(d,function(h,l){if(h==="date"){a[h]=l;return}b++;var k={};try{l=decodeURI(l)}catch(j){}var i=l;if(l.startsWith("room")||l.startsWith("func")){l=mapText(l)}else{if(l.startsWith("${")){l=mapText(l.substring(2,l.length-1))}}k.name=l;k.oldname=i;k.visible=true;k.position=b;k[e+"_divisor"]="unsorted";a[h]=k});a.size=b;a.divisors={}}else{if(e==="programs"){var b=0;$.each(d,function(h,k){if(h==="date"){a[h]=k;return}b++;var j={};try{j.name=decodeURI(k.name)}catch(i){j.name=k.name}try{j.oldname=decodeURI(k.name)}catch(i){j.oldname=k.name}j.visible=k.visible;j.oldvisible=k.visible;j.position=b;j.active=k.active;j.operate=k.operate;j.oldoperate=k.operate;j.date=k.date;try{j.info=decodeURI(k.info)}catch(i){j.info=k.info}j.onlyPic=false;j[e+"_divisor"]="unsorted";a[h]=j});a.size=b;a.divisors={}}else{if(e==="variables"){var b=0;$.each(d,function(p,j){if(p==="date"){a[p]=j;return}b++;var l={};var i=decodeURI(j.name);if(i.startsWith("${")){i=mapText(i.substring(2,i.length-1))}l.name=i;try{l.oldname=decodeURI(j.name)}catch(m){l.oldname=j.name}l.visible=j.visible;l.oldvisible=j.visible;l.position=b;try{l.value=decodeURI(j.value)}catch(m){l.value=j.value}l.active=j.active;var h;try{h=decodeURI(j.info)}catch(m){h=j.info}if(h.startsWith("${")){h=mapText(h.substring(2,h.length-1))}l.operate=isReadOnlyVariable(h);l.oldoperate=l.operate;l.date=j.date;l.info=h;var k=j.valueType;l.valueType=k;try{l.valueUnit=decodeURI(j.valueUnit)}catch(m){l.valueUnit=j.valueUnit}l.onlyPic=false;if(k==="16"){try{l.valueList=decodeURI(j.valueList)}catch(m){l.valueList=j.valueList}l.listType="auto"}else{if(k==="2"){var o;try{o=decodeURI(j.valueName0)}catch(m){o=j.valueName0}if(o.startsWith("${")){o=mapText(o.substring(2,o.length-1))}l.valueName0=o;var n;try{n=decodeURI(j.valueName1)}catch(m){n=j.valueName1}if(n.startsWith("${")){n=mapText(n.substring(2,n.length-1))}l.valueName1=n}else{if(k==="4"){l.valueMin=j.valueMin;l.valueMax=j.valueMax;l.step=1;l.faktor=1}}}l[e+"_divisor"]="unsorted";a[p]=l});a.size=b;a.divisors={}}else{a=d}}}a=refreshJSONObj(e,a,c);localStorage.setItem(f,JSON.stringify(a));if(saveDataToFile){saveDataToFile=false;$.post("cgi/saveconfig.cgi",{name:e,text:JSON.stringify(a)})}return a}else{setMap(e,d);return d}}function refreshJSONObj(g,f,d){var a=getMap(g);if(g==="rooms"||g==="favorites"||g==="functions"){if(!d){var e=false;var b={};var c=f.size;if(c!==a.size){e=true}$.each(f,function(h,k){if(h==="date"||h==="size"||h==="divisors"){if(h==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=k}}else{b[h]=k}return}if(h in a){var j=a[h];k.visible=j.visible;k.position=j.position;if(k.oldname===j.oldname){var i=j.name;if(i.startsWith("room")||i.startsWith("func")){i=mapText(i)}else{if(i.startsWith("${")){i=mapText(i.substring(2,i.length-1))}}k.name=i}else{e=true;saveDataToFile=true}if(g+"_divisor" in j){k[g+"_divisor"]=j[g+"_divisor"]}else{k[g+"_divisor"]="unsorted";e=true;saveDataToFile=true}}else{c++;k.position=c;saveDataToFile=true}b[h]=k});b.size=c;f=b;if(e){activateSettingChangedButton(g)}}}else{if(g==="programs"){if(!d){var b={};var c=f.size;$.each(f,function(h,j){if(h==="date"||h==="size"||h==="divisors"){if(h==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=j}}else{b[h]=j}return}if(h in a){var i=a[h];j.position=i.position;if(j.oldname===i.oldname){j.name=i.name}else{saveDataToFile=true}if(j.oldvisible===i.oldvisible){j.visible=i.visible}else{saveDataToFile=true}if(j.oldoperate===i.oldoperate){j.operate=i.operate}else{saveDataToFile=true}if("onlyPic" in i){j.onlyPic=i.onlyPic}else{j.onlyPic=false;saveDataToFile=true}if(g+"_divisor" in i){j[g+"_divisor"]=i[g+"_divisor"]}else{j[g+"_divisor"]="unsorted";saveDataToFile=true}}else{c++;j.position=c;saveDataToFile=true}b[h]=j});b.size=c;f=b}}else{if(g==="variables"){if(!d){var b={};var c=f.size;$.each(f,function(i,k){if(i==="date"||i==="size"||i==="divisors"){if(i==="divisors"){if("divisors" in a){b.divisors=a.divisors}else{b.divisors=k}}else{b[i]=k}return}var l=k.valueType;if(i in a){var j=a[i];k.position=j.position;if(k.oldname===j.oldname){var h=j.name;if(h.startsWith("${")){h=mapText(h.substring(2,h.length-1))}k.name=h}else{saveDataToFile=true}if(k.oldvisible===j.oldvisible){k.visible=j.visible}else{saveDataToFile=true}if(k.oldoperate===j.oldoperate){k.operate=j.operate}else{saveDataToFile=true}if("onlyPic" in j){k.onlyPic=j.onlyPic}else{k.onlyPic=false;saveDataToFile=true}if(l==="16"){if("listType" in j){k.listType=j.listType}else{k.listType="auto";saveDataToFile=true}}else{if(l==="4"){if("step" in j){k.step=j.step}else{k.step=1;saveDataToFile=true}if("faktor" in j){k.faktor=j.faktor}else{k.faktor=1;saveDataToFile=true}}}if(g+"_divisor" in j){k[g+"_divisor"]=j[g+"_divisor"]}else{k[g+"_divisor"]="unsorted";saveDataToFile=true}}else{c++;k.position=c;saveDataToFile=true}b[i]=k});b.size=c;f=b}}else{if(g==="config"&&!d){f.storageVersion=storageVersion;if(!("ccu_historian" in f)){f.ccu_historian=""}if(!("default_menugfxsize" in f)){f.default_menugfxsize="large"}if(!("no_more_settings" in f)){f.no_more_settings=0}if(!("new_version" in f)){f.new_version="stable"}if(!("dont_leave" in f)){f.dont_leave=false}if(!("clientsList" in f)){f.clientsList=!isTempClient?clientsList:new Object()}if(!("default_sort_manually" in f)){f.default_sort_manually=true}clientsList=f.clientsList;if(client!==""&&!isTempClient&&!(client in clientsList)){clientsList[client]=client;f.clientsList=clientsList}if(!("two_sites" in f)){f.two_sites=false}if(!("transition" in f)){f.transition="flip"}if(!("columns" in f)){f.columns=1}if(!("show_description" in f)){f.show_description=true}if(!("show_lastUsedTime" in f)){f.show_lastUsedTime=true}if(!("favorites_divisor" in f)){f.favorites_divisor=false}if(!("rooms_divisor" in f)){f.rooms_divisor=false}if(!("functions_divisor" in f)){f.functions_divisor=false}if(!("variables_divisor" in f)){f.variables_divisor=false}if(!("programs_divisor" in f)){f.programs_divisor=false}}}}}setMap(g,f);return f}function createConfigFile(a,b){saveDataToFile=true;if(a==="config"){var c="{";c+='"storageVersion" : '+storageVersion+",";c+='"favorites" : true,';c+='"rooms" : true,';c+='"functions" : true,';c+='"variables" : true,';c+='"programs" : true,';c+='"others" : true,';c+='"collapsed" : "rooms",';c+='"systemvar_readonly" : true,';c+='"default_theme" : "wma",';c+='"default_font" : "a",';c+='"ccu_historian" : "",';c+='"default_menugfxsize" : "large",';c+='"no_more_settings" : 0,';c+='"new_version" : "stable",';c+='"dont_leave" : false,';c+='"clientsList" : {'+(client!==""&&!isTempClient?'"'+client+'":"'+client+'"':"")+"},";c+='"default_sort_manually" : true,';c+='"two_sites" : false,';c+='"transition" : "flip",';c+='"columns" : 1,';c+='"show_description" : true,';c+='"show_lastUsedTime" : true,';c+='"favorites_divisor" : false,';c+='"rooms_divisor" : false,';c+='"functions_divisor" : false,';c+='"variables_divisor" : false,';c+='"programs_divisor" : false';c+="}";optionsMap=saveConfigFile(a,JSON.parse(c),true,b,true)}else{if(a.endsWith("Client")){var c="{}";a=a.slice(0,-6);if(client!==""){switch(a){case"config":optionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"variables":variablesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"programs":programsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"favorites":favoritesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"rooms":roomsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"functions":functionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"devices":devicesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break}}}else{loadConfigData(false,"cgi/"+a+".cgi",a,b,true,true)}}};