
var lokalFont="";var lokalDesign="";var lokalGfx="";var oldDataSaved=false;function saveOldData(){if(localStorage.getItem("optionsMenuGfxFont")!==null){lokalFont=localStorage.getItem("optionsMenuGfxFont");oldDataSaved=true}if(localStorage.getItem("optionsMenuGfxTheme")!==null){lokalDesign=localStorage.getItem("optionsMenuGfxTheme");oldDataSaved=true}if(localStorage.getItem("optionsMenuGfxSize")!==null){lokalGfx=localStorage.getItem("optionsMenuGfxSize");oldDataSaved=true}}if(localStorage.getItem("webmaticrecognizeMap")===null){loadRecognization()}else{recognizeMap=JSON.parse(localStorage.getItem("webmaticrecognizeMap"));client=("REMOTE_ADDR" in recognizeMap?recognizeMap.REMOTE_ADDR:"")}if(localStorage.getItem("webmaticoptionsMap")===null){saveOldData();localStorage.clear();localStorage.setItem("webmaticrecognizeMap",JSON.stringify(recognizeMap));loadConfigData(false,"../webmatic_user/config.json","config","webmaticoptionsMap",false,true)}else{optionsMap=JSON.parse(localStorage.getItem("webmaticoptionsMap"));var ok=true;if(optionsMap.storageVersion!==storageVersion){ok=false;saveOldData();localStorage.clear();localStorage.setItem("webmaticrecognizeMap",JSON.stringify(recognizeMap));newVersion=true}loadConfigData(ok,"../webmatic_user/config.json","config","webmaticoptionsMap",false,true)}if(localStorage.getItem("webmaticoptionsclientMap")===null){if(client!==""){loadConfigData(false,"../webmatic_user/config"+client+".json","configClient","webmaticoptionsclientMap",false,true,function(){if(oldDataSaved){if(lokalFont!==""){optionsClientMap.default_font=lokalFont}if(lokalDesign!==""){optionsClientMap.default_theme=lokalDesign}if(lokalGfx!==""){optionsClientMap.default_menugfxsize=lokalGfx}saveClientOptionsToServer()}})}}else{optionsClientMap=JSON.parse(localStorage.getItem("webmaticoptionsclientMap"))}createOneMap("config");if(!debugModus){if(resultOptionsMap.new_version!=="no"){if(resultOptionsMap.new_version!=="alpha"){$.get("https://raw.githubusercontent.com/jens-maus/webmatic/master/ISALPHA",function(b){var a="";if(b==="1"){a="https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSIONALPHA"}else{a="https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSION"}$.get(a,function(c){newWebmaticVersion=c.trim()})});versionURL="https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSIONALPHA"}else{$.get("https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSION",function(a){newWebmaticVersion=a.trim();if(isPreRelease&&newWebmaticVersion===lastStableVersion){newWebmaticVersion=webmaticVersion}})}}$.get("../webmatic_user/ver.json",function(a){if(a.trim()!==webmaticVersion){createVerFile()}}).fail(function(a){if(a.status===404){createVerFile()}});function createVerFile(){$.ajax({url:Base64.decode("aHR0cHM6Ly9nb28uZ2wvdUlmc2p3"),method:"GET",dataType:"JSONP",error:function(a,b){if(b==="error"){$.post("cgi/saveconfig.cgi",{name:"ver",text:webmaticVersion})}}})}}theme=resultOptionsMap.default_theme;if($.inArray(theme,["a","b","c","d","e","f","g","h","i","j","k","l"])===-1){theme="a"}font=resultOptionsMap.default_font;if($.inArray(font,["a","b","c","d","e","f","g","h","i","j","k","l"])===-1){font="a"}function refreshPage(item){restartTimer();testSite=false;if(item!==0){if(prevItem!==0){prevItem.removeClass("ui-btn-active")}item.addClass("ui-btn-active");prevItem=item}if(lastClickType!==-1&&lastClickID!==-1){var restart=oldID!==lastClickID;oldID=lastClickID;if(restart){excludeFromRefresh.length=0;$("#dataList").hide()}switch(lastClickType){case 1:loadData("cgi/list.cgi",lastClickID,restart);break;case 2:loadVariables(restart);break;case 3:loadPrograms(restart);break;case 4:loadGraphicIDs("favorites");break;case 5:testSite=true;loadData("debug/debug.json","a",restart);break;case 6:testSite=true;loadData("debug/debug_cuxd.json","b",restart);break;case 7:loadOptions();break;case 8:loadGraphicIDs("rooms");break;case 9:loadGraphicIDs("functions");break;case 10:loadGraphicIDs("programs");break;case 11:loadOptionsClient();break}$(".evalScript").find("script").each(function(){var src=$(this).attr("src");if(src){$.getScript(src)}else{eval($(this).text())}})}}function refreshServiceMessages(){$("#buttonService .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");$.getJSON("cgi/service.cgi",function(b){$("#serviceList").empty();var a=0;$.each(b.entries,function(f,e){var k=e.name;var g=e.type;var j=e.device;var l=e.error;var d=e.value;var c=e.date;var h=getErrorMessage(g,l,d,j);$("#serviceList").append("<li><p class='ui-li-desc' style='text-align:right;'>"+c+"</p><h1>"+k+"</h1><p>"+h+"</p></li>");a+=1});if(webmaticVersion!==newWebmaticVersion){$("#serviceList").append("<li><p class='ui-li-desc' style='text-align:right;'>"+dateNow+"</p><h1>"+mapText("NEW_VERSION")+"</h1><p><span class='valueInfo valueInfo-"+theme+"'><a href='https://github.com/jens-maus/webmatic/releases' target='_blank' >Webmatic "+newWebmaticVersion+" "+mapText("DOWNLOAD")+"</a></span></p></li>");a+=1}$("#buttonService .ui-btn-text").text("("+a+")");if(a===0){$("#buttonService, #popupDiv").removeClass(function(d,c){return(c.match(/(^|\s)valueService-\S{1}/g)||[]).join(" ")});$("#headerButtonGroup").controlgroup("refresh",true);$("#serviceList").append("<li><p>"+mapText("NO_SERVICE_MESSAGES")+"</p></li>")}else{$("#buttonService, #popupDiv").addClass("valueService-"+theme);$("#headerButtonGroup").controlgroup("refresh",true)}$("#serviceList").listview("refresh",true)})}function removeMessages(){newWebmaticVersion=webmaticVersion;$.ajax("cgi/removemessages.cgi")}function changeTheme(a){$("body, .ui-popup-screen").removeClass(function(c,b){return(b.match(/(^|\s)ui-overlay-\S{1}/g)||[]).join(" ")}).addClass("ui-overlay-"+a);$(".ui-page").removeClass(function(c,b){return(b.match(/(^|\s)ui-page-theme-\S{1}/g)||[]).join(" ")}).addClass("ui-page-theme-"+a).attr("data-theme",a);$(".ui-header").removeClass(function(c,b){return(b.match(/(^|\s)ui-bar-\S{1}/g)||[]).join(" ")}).addClass("ui-bar-"+a).attr("data-theme",a);$(".ui-content").removeClass(function(c,b){return(b.match(/(^|\s)ui-body-\S{1}/g)||[]).join(" ")}).addClass("ui-body-"+a).attr("data-theme",a);$(".ui-collapsible-set, .ui-listview").removeClass(function(c,b){return(b.match(/(^|\s)ui-group-theme-\S{1}/g)||[]).join(" ")}).addClass("ui-group-theme-"+a).attr("data-theme",a);$(".ui-btn").removeClass(function(c,b){return(b.match(/(^|\s)ui-btn-\S{1}/g)||[]).join(" ")}).addClass("ui-btn-"+a).attr("data-theme",a);$(".valueNoError").removeClass(function(c,b){return(b.match(/(^|\s)valueNoError-\S{1}/g)||[]).join(" ")}).addClass("valueNoError-"+a);$(".valueInfo").removeClass(function(c,b){return(b.match(/(^|\s)valueInfo-\S{1}/g)||[]).join(" ")}).addClass("valueInfo-"+a);$(".valueWarning").removeClass(function(c,b){return(b.match(/(^|\s)valueWarning-\S{1}/g)||[]).join(" ")}).addClass("valueWarning-"+a);$(".valueError").removeClass(function(c,b){return(b.match(/(^|\s)valueError-\S{1}/g)||[]).join(" ")}).addClass("valueError-"+a);$(".valueOK").removeClass(function(c,b){return(b.match(/(^|\s)valueOK-\S{1}/g)||[]).join(" ")}).addClass("valueOK-"+a);$("#buttonService, #popupDiv").removeClass(function(c,b){return(b.match(/(^|\s)valueService-\S{1}/g)||[]).join(" ")}).addClass("valueService-"+a);$("img").removeClass(function(c,b){return(b.match(/(^|\s)ui-img-\S{1}/g)||[]).join(" ")}).addClass("ui-img-"+a);$(".control-set").removeClass(function(c,b){return(b.match(/(^|\s)control-set-\S{1}/g)||[]).join(" ")}).addClass("control-set-"+a);theme=a}function changeMenuGfx(a){if(a==="small"){$(".menu").removeClass("ui-li-thumb").addClass("ui-li-icon");$(".ui-li-has-thumb").removeClass("ui-li-has-thumb").addClass("ui-li-has-icon");$("#listFavorites").listview("refresh");$("#listRooms").listview("refresh");$("#listFunctions").listview("refresh");$("#listOther").listview("refresh")}if(a==="large"){$(".menu").removeClass("ui-li-icon").addClass("ui-li-thumb");$(".ui-li-has-icon").removeClass("ui-li-has-icon").addClass("ui-li-has-thumb");$("#listFavorites").listview("refresh");$("#listRooms").listview("refresh");$("#listFunctions").listview("refresh");$("#listOther").listview("refresh")}gfxClass=a}function changeFont(c){var d="";var b="";switch(c){case"a":b="sans-serif";break;case"b":b="KochFraktur";d="themes/fonts/KochFraktur/KochFraktur.ttf";break;case"c":b="PlanetBenson";d="themes/fonts/Planet_benson/planetbe.ttf";break;case"d":b="ActionMan";d="themes/fonts/Action_Man/Action_Man.ttf";break;case"e":b="Amadeus";d="themes/fonts/Amadeus/Amadeus.ttf";break;case"f":b="Vamp";d="themes/fonts/Vamp/RIKY2vamp.ttf";break;case"g":b="HennyPenny";d="themes/fonts/HennyPenny/HennyPenny-Regular.otf";break;case"h":b="Kavoon";d="themes/fonts/Anglican/AnglicanText.ttf";break;case"i":b="Nosifer";d="themes/fonts/Nosifer/NosiferCaps-Regular.ttf";break;case"j":b="Pacifico";d="themes/fonts/Pacifico/Pacifico.ttf";break;case"k":b="Sixties";d="themes/fonts/Sixties/Sixties.ttf";break;case"l":b="Crackman";d="themes/fonts/Crackman/CRACKMAN.ttf";break}setFont=function(e){$("body, input, select, textarea, button, .ui-btn").css("font-family",e)};if($.inArray(c,loadedFont)===-1){var a=new Font();a.onload=function(){setFont(b)};a.fontFamily=b;a.src=d}else{setFont(b)}loadedFont.push(c);font=c}function processVariable(c,g,b){var n=unescape(c.value);var f=c.valueType;var k=c.valueUnit;var d=c.valueList;var o=getTimeDiffString(c.date,b);var a=unescape(c.info);var j=c.valueName0;var h=c.valueName1;var e="<li class='dataListItem' id='"+g+"'><h2 class='ui-li-heading'>"+unescape(c.name)+"</h2>";e+="<p>"+a+"</p>";if(isReadOnly(a)){e+=addReadonlyVariable(g,n,o,f,k,d,j,h)}else{if(f==="2"){e+=addSetBoolButtonList("",g,n,j,h,k,o,true)}else{if(f==="4"){var m=c.valueMax;var l=1;if(m<<10){l=100}e+=addSetNumber("",g,n,k,c.valueMin,c.valueMax,1,l,o,true)}else{if(f==="16"){e+=addSetValueList("",g,n,d,k,o,true)}else{if(f==="20"&&k.toUpperCase()==="HTML"){e+=addHTML("",g,n,o,false)}else{if(f==="20"&&k.toUpperCase()==="HISTORIAN"){e+=addHistorianDiagram("",g,n,o,false)}else{if(f==="20"){e+=addSetText("",g,n,k,o)}else{e+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}}e+="</li>";return e}function processProgram(e,c,b,d,f){var a="<li class='dataListItem' id='"+c+"' "+(f?"":"style='display: none;'")+">";a+="<h2 class='ui-li-heading'>"+e.name+"</h2>";a+="<p>"+e.info+(!d?" ("+mapText("MANUAL")+")":"")+"</p>";if(e.pic){a+="<div style='float: left; text-align: center;'>";a+="<img id='img"+c+"' class='ui-div-thumbnail ui-img-"+theme+" lazyLoadImage' data-original='../webmatic_user/img/ids/programs/"+c+".png' src='img/menu/programs.png'/>";a+="</div>"}if(debugModus){a+="<span>Position: "+e.position+"</span>"}a+=addStartProgramButton("",c,mapText("RUN"),getTimeDiffString(e.date,b),(e.operate||!readModus));a+="</li>";return a}function processGraphicID(e){var g=getResultMap(e);var h={};var d=g.size;$.each(g,function(k,l){if(k==="date"||k==="size"){return}var j="<li id='list"+k+"' data-id='"+k+"'>";j+="<div style='float: left; text-align: center;'>";j+="<img id='img"+k+"' class='ui-div-thumbnail ui-img-"+theme;if(l.pic){j+=" lazyLoadImage' data-original='../webmatic_user/img/ids/"+e+"/"+k+".png"}j+="' src='img/menu/"+e+".png'/>";j+="<a href='#' "+(!l.pic?"class='ui-btn ui-mini ui-icon-delete ui-btn-icon-left ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-mini='true' data-icon='delete'")+" name='deletePic' id='deletePic"+k+"' data-id='"+k+"' data-type='"+e+"'>"+mapText("DELETE")+"</a>";j+="<h1>(";if(e==="rooms"||e==="functions"||e==="favorites"){j+="<a href='get.html?id="+k+"' target='_blank'>"+k+"</a>"}else{j+=k}j+=")</h1>";j+="</div>";j+="<div style='float: right;'>";if(debugModus){j+="<span id='positiondebug"+k+"'>Position: "+l.position+"</span>"}j+="<input type='hidden' name='position' id='position"+k+"' data-id='"+k+"' data-type='"+e+"' value='"+l.position+"' data-last='"+(d===l.position)+"'/>";j+="<a href='#' class='ui-btn ui-btn-inline ui-icon-carat-u ui-btn-icon-notext ui-corner-all";if(l.position<=1){j+=" ui-state-disabled' style='display: none;"}j+="' name='setUp' id='setUp"+k+"' data-id='"+k+"' />";j+="<a href='#' class='ui-btn ui-btn-inline ui-icon-carat-d ui-btn-icon-notext ui-corner-all";if(l.position>=d){j+=" ui-state-disabled' style='display: none;"}j+="' name='setDown' id='setDown"+k+"' data-id='"+k+"' />";j+="</div>";j+="<form method='post' enctype='multipart/form-data' action='#' id='form"+k+"'>";j+="<div class='ui-grid-b'>";j+="<div class='ui-block-a'><input name='editName' data-id='"+k+"' data-type='"+e+"' type='text' value='"+l.name+"' /></div>";j+="<div class='ui-block-b'><input name='file' id='file"+k+"' type='file' accept='image/*' /></div>";j+="<div class='ui-block-c'><a href='#' name='uploadPicture' data-type='"+e+"' id='uploadPicture"+k+"' class='ui-link ui-btn ui-icon-check ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all ui-state-disabled'>"+mapText("UPLOAD")+"</a></div>";j+="<div class='ui-block-a small-hidden'></div>";j+="<div class='ui-block-b";if(e==="programs"){j+="'>";j+="<label>"+mapText("OPERATABLE")+":&nbsp;";j+="<input type='checkbox' data-role='flipswitch' name='editOperate' data-id='"+k+"' data-on-text='"+mapText("YES")+"' data-off-text='"+mapText("NO")+"' "+(l.operate?"checked":"")+"/>"}else{j+=" small-hidden'>"}j+="</div>";j+="<div class='ui-block-c'>";j+="<label>"+mapText("VISIBILITY")+":&nbsp;";j+="<input type='checkbox' data-role='flipswitch' name='editVisible' data-type='"+e+"' data-id='"+k+"' data-on-text='"+mapText("YES")+"' data-off-text='"+mapText("NO")+"' "+(l.visible?"checked":"")+"/>";j+="</label>";j+="</div>";j+="</div>";j+="</form>";j+="</li>";h[l.position]=j});var f=Object.keys(h).sort(function(k,j){return k-j});var a=f.length;for(var c=0;c<a;c++){var b=f[c];$("#dataList").append(h[b])}}function getErrorMessage(c,d,f,b){var a="";if(c==="ALARMDP"){var e;if(d==="CONFIG_PENDING"||d==="STICKY_UNREACH"){e="Info"}else{if(d==="LOWBAT"){e="Warning"}else{e="Error"}}return"<span class='value"+e+" value"+e+"-"+theme+"'>"+mapText(c+"__"+d)+"</span>"}else{if(c==="HSSDP"){a=mapText(b+"__"+d+"__"+f);if(a!==""&&a!=="-"){return"<span class='valueError valueError-"+theme+"'>"+a+"</span>"}}}if(a===""){a="<span class='valueError valueError-"+theme+"'>"+mapText("UNKNOWN_ERROR")+": "+f+"</span>"}return a}function addDiagram(z){if(z.addDiagram){$("#dataList").listview("refresh");var B="l";var Z="69A5CF";var O="";var q="";var x=1;var S="0/#008800";var b="30/#AA4400";for(var X=0;X<z.varOptions.length;X++){var J=z.varOptions[X].split("=");if(J.length===2){if(J[0]==="t"){B=J[1]}else{if(J[0]==="c"){Z=J[1]}else{if(J[0]==="l"){O=J[1]}else{if(J[0]==="h"){q=J[1]}else{if(J[0]==="k"){x=parseInt(J[1])}else{if(J[0]==="s"){S=J[1]}else{if(J[0]==="e"){b=J[1]}}}}}}}}}if(z.varOptionsFirst==="g"){var m=parseFloat(z.diagramData);var R=S.split("/");var H=parseFloat(R[0]);var p=R[1];if(m<H){H=m}var g=b.split("/");var d=parseFloat(g[0]);var F=g[1];if(m>d){d=m}var a=parseInt(p.substring(1,3),16);var w=parseInt(p.substring(3,5),16);var Q=parseInt(p.substring(5,7),16);var T=parseInt(F.substring(1,3),16);var s=parseInt(F.substring(3,5),16);var o=parseInt(F.substring(5,7),16);var C=[];var U=[];var P=10;for(var X=1;X<=P;X++){var aa=X/P;var L=H+aa*(d-H);C.push(L);aa=(X-1)/(P-1);var A=Math.floor(a+aa*(T-a)).toString(16);if(A.length<2){A="0"+A}var E=Math.floor(w+aa*(s-w)).toString(16);if(E.length<2){E="0"+E}var I=Math.floor(Q+aa*(o-Q)).toString(16);if(I.length<2){I="0"+I}var ab="#"+A+E+I;U.push(ab)}var G=[z.diagramData];$.jqplot(z.diagramID,[G],{seriesDefaults:{renderer:$.jqplot.MeterGaugeRenderer,rendererOptions:{label:z.diagramData+" "+z.diagramUnit,labelPosition:"bottom",labelHeightAdjust:-5,min:H,max:d,intervals:C,intervalColors:U,smooth:true,animation:{show:true}}},grid:{backgroundColor:"transparent"}})}else{if(z.varOptionsFirst==="h"){var u=z.diagramData.split(";");var l=u[0];if(l>0){var n=new Array();n[0]=new Array();n[1]=new Array();n[2]=new Array();n[3]=new Array();n[4]=new Array();var W=0;var y;if(O===""){y=15}else{y=parseFloat(O)}var k;if(q===""){k=23}else{k=parseFloat(q)}var M="";var V="";for(var X=1;X<=l;X++){var N=u[X];var K=N.split(",");var ad=K[0];if(M===""||ad<M){M=ad}if(V===""||ad>V){V=ad}for(W=1;W<K.length;W++){var D=new Array();D[0]=ad;var ac=K[W];D[1]=ac;n[W-1][X-1]=D}}}$.jqplot(z.diagramID,[n[0],n[1],n[2],n[3],n[4]],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%a, %#d %#H:%M",angle:20},min:M,max:V},yaxis:{min:y,max:k,showLabel:true,tickOptions:{formatString:"%."+x+"f&deg;C"}},y2axis:{min:0,max:100,showLabel:true,tickOptions:{formatString:"%d%"}}},legend:{show:false,fontSize:23,placement:"outside",location:"e"},seriesDefaults:{lineWidth:2,showMarker:false,fill:false,shadow:false},series:[{label:"Soll",color:"#555555",fill:true,fillAlpha:0.1},{label:"Ist",color:"#DD0000"},{label:"relF%",color:"#0174DF",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis"}],highlighter:{show:true,sizeAdjust:5.5},cursor:{zoom:true,show:true},grid:{backgroundColor:"#F4F4F4"},animated:true})}else{if(B==="l"||B==="f"){u=z.diagramData.split(",");l=u.length;if(l>=3){n=new Array();W=0;y=1000000;k=-1000000;M="";V="";for(var X=1;X<l;X=X+2){ad=u[X];ac=u[X+1];var h=new Array();h[0]=ad;L;if(ac==="true"){L=1}else{if(ac==="false"){L=0}else{L=parseFloat(ac)}}h[1]=L;if(L<y){y=L}if(L>k){k=L}if(M===""||ad<M){M=ad}if(V===""||ad>V){V=ad}n[W]=h;W++}if(O===""){y=y-0.1*(k-y)}else{if(O==="m"){}else{var r=parseFloat(O);if(r<y){y=r}}}if(q===""){k=k+0.1*(k-y)}else{if(q==="m"){}else{var Y=parseFloat(q);if(Y>k){k=Y}}}var e;if(B==="l"){e=false}else{e=true}$.jqplot(z.diagramID,[n],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%b %#d, %#H:%M",angle:20},min:M,max:V},yaxis:{min:y,max:k,tickOptions:{formatString:"%."+x+"f"+z.diagramUnit}}},seriesDefaults:{rendererOptions:{smooth:true}},series:[{color:"#"+Z,lineWidth:2,showMarker:false,fill:e}],highlighter:{show:true,sizeAdjust:5.5},cursor:{show:false},grid:{backgroundColor:"#F4F4F4"},animated:true})}}}}}}function addChannel(c,a,n){var d=c.hssType;var l=c.id;var g=false;var m=[];m.deviceHTMLPostChannelGroup="";m.deviceHTMLPostChannelGroupMode=0;var k="";$.each(c.channels,function(H,T){g=true;var s=T.type;if(s==="HSSDP"){var L=T.id;var t=T.hssType;var G=T.date;var P=getTimeDiffString(G,a);var D=T.value;var q=parseFloat(T.value);var p=(D==="true");var r=mapUnit(T.valueUnit,t);var z=parseFloat(T.valueMin);var B=parseFloat(T.valueMax);if(t==="SETPOINT"||t==="SET_TEMPERATURE"){k+=addSetNumber(l,L,q,r,6,30,0.5,1,P,false);var E=q-3;var o=E+6;if(E<z){E=z;o=11}if(o>B){E=25;o=B}k+="<div data-role='controlgroup' data-type='horizontal'>";if(t==="SETPOINT"){k+=addSetButton(l,L,mapText(d+"__"+t+"__VENT_CLOSED"),0,P,true,0===q,false)}for(i=E;i<=o;i+=1){k+=addSetButton(l,L,i+r,i,P,true,i===q,false)}if(t==="SETPOINT"){k+=addSetButton(l,L,mapText(d+"__"+t+"__VENT_OPEN"),100,P,true,100===q,false)}k+="</div>"}else{if(d==="CLIMATECONTROL_RT_TRANSCEIVER"&&(t.endsWith("MODE")||t.startsWith("PARTY"))){if(t==="CONTROL_MODE"){m.deviceHTMLPostChannelGroupMode=q}else{if(t==="AUTO_MODE"){m.deviceHTMLPostChannelGroup+=addSetButton(l,L,mapText(d+"__"+t),true,P,true,m.deviceHTMLPostChannelGroupMode===0,true)}else{if(t==="MANU_MODE"){m.deviceHTMLPostChannelGroup+=addSetButton(l,L,mapText(d+"__"+t),true,P,true,m.deviceHTMLPostChannelGroupMode===1,true)}else{if(t==="BOOST_MODE"){m.deviceHTMLPostChannelGroup+=addSetButton(l,L,mapText(d+"__"+t),true,P,true,m.deviceHTMLPostChannelGroupMode===3,true)}else{if(t==="LOWERING_MODE"||t==="COMFORT_MODE"){m.deviceHTMLPostChannelGroup+=addSetButton(l,L,mapText(d+"__"+t),true,P,true,false,true)}else{if(t==="PARTY_TEMPERATURE"){m.PARTY_TEMPERATURE=q}else{if(t==="PARTY_START_TIME"){m.PARTY_START_TIME=parseInt(D)}else{if(t==="PARTY_START_DAY"){m.PARTY_START_DAY=parseInt(D)}else{if(t==="PARTY_START_MONTH"){m.PARTY_START_MONTH=parseInt(D)}else{if(t==="PARTY_START_YEAR"){m.PARTY_START_YEAR=parseInt(D)}else{if(t==="PARTY_STOP_TIME"){m.PARTY_STOP_TIME=parseInt(D)}else{if(t==="PARTY_STOP_DAY"){m.PARTY_STOP_DAY=parseInt(D)}else{if(t==="PARTY_STOP_MONTH"){m.PARTY_STOP_MONTH=parseInt(D)}else{if(t==="PARTY_STOP_YEAR"){m.PARTY_STOP_YEAR=parseInt(D)}else{if(t==="PARTY_MODE_SUBMIT"){m.PARTY_MODE_ID=L;m.VORDATE=P}}}}}}}}}}}}}}}}else{if(t==="PROGRAM"&&d==="RGBW_AUTOMATIC"){k+="<div data-role='controlgroup' data-type='horizontal'>";k+=addSetButton(l,L,mapText(d+"__"+t+"__0"),0,P,true,q===0,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__1"),1,P,true,q===1,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__2"),2,P,true,q===2,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__3"),3,P,true,q===3,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__4"),4,P,true,q===4,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__5"),5,P,true,q===5,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__6"),6,P,true,q===6,true);k+="</div>"}else{if(t==="COLOR"&&d==="RGBW_COLOR"){k+="<span class='RGBW-Color'>";k+=addSetNumber(l,L,q,r,0,200,1,1,P,true);k+="</span>"}else{if(t==="LED_STATUS"&&d==="KEY"){switch(q){case 0:k+="<p><img class='ui-img-"+theme+"' src='img/channels/off_lamp.png' style='max-height:40px'> "+mapText(d+"__"+t+"__0")+" | <span><i>"+P+"</i></span></p>";break;case 1:k+="<p><img class='ui-img-"+theme+"' src='img/channels/red_lamp.png' style='max-height:40px'> "+mapText(d+"__"+t+"__1")+" | <span><i>"+P+"</i></span></p>";break;case 2:k+="<p><img class='ui-img-"+theme+"' src='img/channels/green_lamp.png' style='max-height:40px'> "+mapText(d+"__"+t+"__2")+" | <span><i>"+P+"</i></span></p>";break;case 3:k+="<p><img class='ui-img-"+theme+"' src='img/channels/orange_lamp.png' style='max-height:40px'> "+mapText(d+"__"+t+"__3")+" | <span><i>"+P+"</i></span></p>";break}}else{if(t==="LEVEL"&&d==="BLIND"){k+=addSetNumber(l,L,q,r,0,1,0.01,100,P+" | 0<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("CLOSE")+", 100<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("OPEN"),false);k+=addSetControlGroup(l,L,mapText("CLOSE_SHORT"),mapText("OPEN_SHORT"),P,q)}else{if(t==="LEVEL"&&d==="WINMATIC"){k+=addSetNumber(l,L,q,r,-0.005,1,0.01,100,P+" | -0.5<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("LOCKED")+", 0<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("CLOSE")+", 100<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("OPEN"),false);k+=addSetControlGroup(l,L,mapText("CLOSE_SHORT"),mapText("OPEN_SHORT"),P,q,addSetButton(l,L,mapText("LOCK"),-0.005,P,true,q===-0.005,false))}else{if(t==="LEVEL"&&(d==="DIMMER"||d==="VIRTUAL_DIMMER")){k+=addSetNumber(l,L,q,r,0,1,0.01,100,P+" | 0<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("OFF")+", 100<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("ON"),false);k+=addSetControlGroup(l,L,mapText("OFF"),mapText("ON"),P,q)}else{if(t==="FREQUENCY"&&d==="DIGITAL_ANALOG_OUTPUT"){k+=addSetNumber(l,L,q,r,0,50000,100,1,P+" | 0<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("MAX")+", 50000<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("MIN"),false);k+="<div data-role='controlgroup' data-type='horizontal'>";k+=addSetButton(l,L,mapText("MAX"),0,P,true,q===0,true);k+=addSetButton(l,L,mapText("MED"),30000,P,true,q===30000,true);k+=addSetButton(l,L,mapText("MIN"),50000,P,true,q===50000,true);k+="</div>"}else{if(t==="SUBMIT"&&(d==="SIGNAL_LED"||d==="SIGNAL_CHIME")){}else{if(t==="ON_TIME"||t==="RAMP_TIME"){k+="<div class='ui-field-contain ui-grid-c'>";k+="<div class='ui-block-a'>";k+="<input type='text' data-role='datebox' data-duration-parent='"+l+"' data-id='"+L+'\' data-options=\'{"mode":"durationbox"}\'/>&nbsp;';k+="</div>";k+="<div class='ui-block-b grid-text'>";k+=mapText(d+"__"+t);k+="</div>";k+="</div>"}else{var C=mapInput(d,T,P,l);if(C!==""){k+=C}else{var F=mapState(t,d,q,p);if(F!=="Hide"){var K="";var S="&nbsp;";var J=1;if(F!==""){K="<span class='value"+F+" value"+F+"-"+theme+"'>"+mapText(d+"__"+t+"__"+D)+"&nbsp;<span id='unit_ "+b+"'>"+r+"</span></span>"}else{if(t==="VALUE"){K=D+" <span id='unit_ "+b+"'>"+r+"</span>"}else{if((t==="LEVEL"&&d==="AKKU")||(t==="BAT_LEVEL"&&d==="POWER")){J=100}S=mapText(d+"__"+t);var A=D;if(!isNaN(D)||J!==1){A=q*J}K=A+" <span id='unit_ "+b+"'>"+r+"</span>"}}if(S!=="-"){k+="<p class='ui-li-desc'>";k+="<img class='ui-img-"+theme+"' src='img/channels/"+mapImage(t)+"' style='max-height:20px'>";k+="<span class='valueInfo valueInfo-"+theme+"'>"+K+" </span>&nbsp;"+S+"&nbsp;|&nbsp;";k+="<span><i>"+P+"</i></span>";k+="</p>"}}}}}}}}}}}}}}}else{if(s==="VARDP"){var u=T.id;var x=unescape(T.info);var M=unescape(T.value);var I=T.valueType;r=T.valueUnit;var Q=T.valueName0;var O=T.valueName1;var w=T.valueList;G=T.date;P=getTimeDiffString(G,a);n.varOptionsFirst="";n.varOptions=[];var y=x.indexOf("(");if(y!==-1){var R=x.indexOf(")",y);if(R!==-1){var N=x.substring(y+1,R);n.varOptions=N.split(",");if(n.varOptions.length>=1){n.varOptionsFirst=n.varOptions[0].toLowerCase()}}}if(n.varOptionsFirst!=="nv"){k+="<br><h2 class='ui-li-heading'>"+unescape(T.name)+"</h2>";k+="<p>"+x+"</p>";if(isReadOnly(x)){k+=addReadonlyVariable(u,M,P,I,r,w,Q,O)}else{if(n.varOptionsFirst==="d"||n.varOptionsFirst==="dk"||n.varOptionsFirst==="g"||n.varOptionsFirst==="h"){excludeFromRefresh.push(u);n.addDiagram=true;if(n.varOptionsFirst==="dk"){n.diagramData=T.diagrams}else{n.diagramData=M}n.diagramID="chart_"+u;n.diagramUnit=r;if(n.varOptionsFirst==="g"){k+="<div id='"+n.diagramID+"' style='height:200px; width:300px;'></div> <i class='ui-li-desc'>"+P+"</i>"}else{k+="<div id='"+n.diagramID+"' style='height:300px; width:90%;'></div> <i class='ui-li-desc'>"+P+"</i>"}}else{if(I==="2"){k+=addSetBoolButtonList(l,u,M,Q,O,r,P,true)}else{if(I==="4"){k+=addSetNumber(l,u,M,r,z,B,0.001,1,P,true)}else{if(I==="16"){k+=addSetValueList(l,u,M,w,r,P,true)}else{if(I==="20"&&r.toUpperCase()==="HTML"){k+=addHTML(l,u,M,P,false)}else{if(I==="20"&&r.toUpperCase()==="HISTORIAN"){k+=addHistorianDiagram(l,u,M,P,false)}else{if(I==="20"){k+=addSetText(l,u,M,r,P)}else{k+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}}}}}}});if(m.deviceHTMLPostChannelGroup!==""){k+="<div data-role='controlgroup' data-type='horizontal'>";k+=m.deviceHTMLPostChannelGroup;k+="</div>";var b=m.PARTY_MODUS_ID;var f=[m.PARTY_START_YEAR+2000,m.PARTY_START_MONTH-1,m.PARTY_START_DAY];var e=m.PARTY_START_TIME*60;var j=[m.PARTY_STOP_YEAR+2000,m.PARTY_STOP_MONTH-1,m.PARTY_STOP_DAY];var h=m.PARTY_STOP_TIME*60;k+="<div class='ui-field-contain ui-grid-c control-set control-set-"+theme+"'>";k+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_TEMPERATURE")+"</div>";k+="<div class='ui-block-b'><input type='range' data-parent-id='"+l+"' value='"+m.PARTY_TEMPERATURE+"' min='5.0' max='30.0' step='0.5' data-factor='1' id='setTemperature_"+b+"' data-highlight='true' data-theme='"+theme+"'/></div>";k+="<div class='ui-block-c'></div>";k+="<div class='ui-block-d'></div>";k+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_START")+"</div>";k+="<div class='ui-block-b'><input type='text' data-parent-id='"+l+"' data-datebox-default-value='"+f+"' id='setStartDate_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='calbox' data-datebox-use-lang='de'/></div>";k+="<div class='ui-block-c'><input type='text' data-parent-id='"+l+"' data-datebox-default-value='"+e+"' id='setStartTime_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='timebox' data-datebox-minute-step='30' data-datebox-use-lang='de'/></div>";k+="<div class='ui-block-d'></div>";k+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_STOP")+"</div>";k+="<div class='ui-block-b'><input type='text' data-parent-id='"+l+"' data-datebox-default-value='"+j+"' id='setEndDate_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='calbox' data-datebox-use-lang='de'/></div>";k+="<div class='ui-block-c'><input type='text' data-parent-id='"+l+"' data-datebox-default-value='"+h+"' id='setEndTime_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='timebox' data-datebox-minute-step='30' data-datebox-use-lang='de'/></div>";k+="<div class='ui-block-d'></div>";k+="<div class='ui-block-a'>"+addSetButton(l,b,mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_MODE"),"",m.VORDATE,true,m.deviceHTMLPostChannelGroupMode===2,true,"CLIMATECONTROL_RT_TRANSCEIVER")+"</div>";k+="</div>"}else{if(!g){k=""}}return k}function processDevices(o,d,b){var q="<li class='dataListItem' id='"+o.id+"'><h2 class='ui-li-heading'>"+unescape(o.name)+"</h2>";if(o.type==="CHANNEL"){q+=addChannel(o,d,b)}else{if(o.type==="VARDP"){var c=o.id;var g=unescape(o.info);var r=unescape(o.value);var p=o.valueType;var a=o.valueUnit;var v=o.valueName0;var u=o.valueName1;var h=o.valueMin;var m=o.valueMax;var f=o.valueList;var n=o.date;var t=getTimeDiffString(n,d);b.varOptionsFirst="";b.varOptions=[];var j=g.indexOf("(");if(j!==-1){var w=g.indexOf(")",j);if(w!==-1){var s=g.substring(j+1,w);b.varOptions=s.split(",");if(b.varOptions.length>=1){b.varOptionsFirst=b.varOptions[0].toLowerCase()}}}q+="<p>"+g+"</p>";if(isReadOnly(g)){q+=addReadonlyVariable(c,r,t,p,a,f,v,u)}else{if(b.varOptionsFirst==="d"||b.varOptionsFirst==="dk"||b.varOptionsFirst==="g"||b.varOptionsFirst==="h"){excludeFromRefresh.push(c);b.addDiagram=true;if(b.varOptionsFirst==="dk"){b.diagramData=o.diagrams}else{b.diagramData=r}b.diagramID="chart_"+c;b.diagramUnit=a;if(b.varOptionsFirst==="g"){q+="<div id='"+b.diagramID+"' style='height:200px; width:300px;'></div> <i class='ui-li-desc'>"+t+"</i>"}else{q+="<div id='"+b.diagramID+"' style='height:300px; width:90%;'></div> <i class='ui-li-desc'>"+t+"</i>"}}else{if(b.varOptionsFirst==="nv"){q=""}else{if(p==="2"){q+=addSetBoolButtonList("",c,r,v,u,a,t,true)}else{if(p==="4"){q+=addSetNumber("",c,r,a,h,m,0.001,1,t,true)}else{if(p==="16"){q+=addSetValueList("",c,r,f,a,t,true)}else{if(p==="20"&&a.toUpperCase()==="HTML"){q+=addHTML("",c,r,t,false)}else{if(p==="20"&&a.toUpperCase()==="HISTORIAN"){q+=addHistorianDiagram("",c,r,t,false)}else{if(p==="20"){q+=addSetText("",c,r,a,t)}else{q+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}}}}}else{if(o.type==="PROGRAM"){var l=o.id;var e=o.info;var k=o.date;t=getTimeDiffString(k,d);q+="<p>"+e+"</p>";q+=addStartProgramButton("",l,mapText("RUN"),t,o.operate==="true")}}}if(q!==""){q+="</li>"}return q}function activateSettingSaveButton(){$('[name="saveAllChanges"]').removeClass("ui-state-disabled");mustBeSaved=true}function loadRecognization(){$.ajax({type:"GET",url:"cgi/recognizer.cgi",dataType:"json",async:false}).done(function(a){if(a.REMOTE_ADDR.match("^192.168.")||a.REMOTE_ADDR.match("^10.")){recognizeMap=a;client=a.REMOTE_ADDR;localStorage.setItem("webmaticrecognizeMap",JSON.stringify(recognizeMap))}else{recognizeMap={};client=""}}).fail(function(a,b){recognizeMap={};clint="";log("Recognization failed: "+b,2)})}function loadConfigData(d,a,c,e,b,g,f){$.ajax({type:"GET",url:a,dataType:"json",async:d}).done(function(j){var h;switch(c){case"config":if(!d){saveDataToFile=true;h=saveConfigFile(c,j,b,e,true)}else{h=j;optionsMap=j;localStorage.setItem(e,JSON.stringify(j))}break;case"variables":h=j;variablesMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"programs":h=saveConfigFile(c,j,b,e,g);break;case"favorites":h=saveConfigFile(c,j,b,e,g);break;case"rooms":h=saveConfigFile(c,j,b,e,g);break;case"functions":h=saveConfigFile(c,j,b,e,g);break;case"devices":h=j;devicesMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"configClient":optionsClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"programsClient":programsClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"favoritesClient":favoritesClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"roomsClient":roomsClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"functionsClient":functionsClientMap=j;localStorage.setItem(e,JSON.stringify(j));break}if(typeof f==="function"){f(h)}}).fail(function(h,j){if(h.status===404){createConfigFile(c,e)}else{log("Request failed: "+j,2)}})}function saveConfigFile(e,d,c,f,g){if(g){saveDataToFile=true;var a={};if(e==="rooms"||e==="favorites"||e==="functions"){var b=0;$.each(d,function(h,k){if(h==="size"){return}b++;var j={};j.name=k;j.oldname=k;j.visible=true;j.pic=false;j.position=b;a[h]=j});a.size=b}else{if(e==="programs"){var b=0;$.each(d,function(h,k){if(h==="date"||h==="size"){a[h]=k;return}b++;var j={};j.name=k.name;j.oldname=k.name;j.visible=k.visible;j.oldvisible=k.visible;j.pic=false;j.position=b;j.active=k.active;j.operate=k.operate;j.oldoperate=k.operate;j.date=k.date;j.info=k.info;a[h]=j});a.size=b}else{a=d}}a=refreshJSONObj(e,a,c);localStorage.setItem(f,JSON.stringify(a));if(saveDataToFile){saveDataToFile=false;$.post("cgi/saveconfig.cgi",{name:e,text:JSON.stringify(a)})}return a}else{setMap(e,d);return d}}function refreshJSONObj(f,e,d){var a=getMap(f);if(f==="rooms"||f==="favorites"||f==="functions"){if(d){var b={};$.each(e,function(g,h){$.ajax({type:"GET",url:"../webmatic_user/img/ids/"+f+"/"+g+".png",async:false}).done(function(){h.pic=true}).fail(function(){h.pic=false});b[g]=h});e=b}else{var b={};var c=e.size;$.each(e,function(g,j){if(g==="date"||g==="size"){b[g]=j;return}if(g in a){var h=a[g];j.visible=h.visible;j.pic=h.pic;j.position=h.position;if(j.oldname===h.oldname){j.name=h.name}else{saveDataToFile=true}}else{c++;j.position=c;saveDataToFile=true}b[g]=j});b.size=c;e=b}}else{if(f==="programs"){if(d){var b={};$.each(e,function(g,h){if(g==="date"||g==="size"){b[g]=h;return}$.ajax({type:"GET",url:"../webmatic_user/img/ids/"+f+"/"+g+".png",async:false}).done(function(){h.pic=true}).fail(function(){h.pic=false});b[g]=h});e=b}else{var b={};var c=e.size;$.each(e,function(g,j){if(g==="date"||g==="size"){b[g]=j;return}if(g in a){var h=a[g];j.pic=h.pic;j.position=h.position;if(j.oldname===h.oldname){j.name=h.name}else{saveDataToFile=true}if(j.oldvisible===h.oldvisible){j.visible=h.visible}else{saveDataToFile=true}if(j.oldoperate===h.oldoperate){j.operate=h.operate}else{saveDataToFile=true}}else{c++;j.position=c;saveDataToFile=true}b[g]=j});b.size=c;e=b}}else{if(f==="config"&&!d){e.storageVersion=storageVersion;if(!("ccu_historian" in e)){e.ccu_historian=""}if(!("default_menugfxsize" in e)){e.default_menugfxsize="large"}if(!("no_more_settings" in e)){e.no_more_settings=0}if(!("new_version" in e)){e.new_version="stable"}if(!("dont_leave" in e)){e.dont_leave=false}}}}setMap(f,e);return e}function createConfigFile(a,b){saveDataToFile=true;if(a==="config"){var c="{";c+='"storageVersion" : '+storageVersion+",";c+='"favorites" : true,';c+='"rooms" : true,';c+='"functions" : true,';c+='"variables" : true,';c+='"programs" : true,';c+='"others" : true,';c+='"collapsed" : "rooms",';c+='"systemvar_readonly" : true,';c+='"default_theme" : "a",';c+='"default_font" : "a",';c+='"ccu_historian" : "",';c+='"default_menugfxsize" : "large",';c+='"no_more_settings" : 0,';c+='"new_version" : "stable",';c+='"dont_leave" : false';c+="}";optionsMap=saveConfigFile(a,JSON.parse(c),true,b,true)}else{if(a.endsWith("Client")){var c="{}";a=a.slice(0,-6);switch(a){case"config":optionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"variables":variablesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"programs":programsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"favorites":favoritesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"rooms":roomsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"functions":functionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"devices":devicesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break}}else{loadConfigData(false,"cgi/"+a+".cgi",a,b,true,true)}}}function saveOptionsToServer(a,b){localStorage.setItem("webmaticoptionsMap",JSON.stringify(optionsMap));$.post("cgi/saveconfig.cgi",{name:"config",text:JSON.stringify(optionsMap)});createOneMap("config",a,b)}function saveClientOptionsToServer(a,b){localStorage.setItem("webmaticoptionsclientMap",JSON.stringify(optionsClientMap));if(client!==""){$.post("cgi/saveconfig.cgi",{name:"config"+client,text:JSON.stringify(optionsClientMap)})}if(a){checkAndChange(a,b)}}function saveAllDatasToServer(){localStorage.setItem("webmaticfavoritesMap",JSON.stringify(favoritesMap));localStorage.setItem("webmaticroomsMap",JSON.stringify(roomsMap));localStorage.setItem("webmaticfunctionsMap",JSON.stringify(functionsMap));localStorage.setItem("webmaticprogramsMap",JSON.stringify(programsMap));$.post("cgi/saveconfig.cgi",{name:"favorites",text:JSON.stringify(favoritesMap)});$.post("cgi/saveconfig.cgi",{name:"rooms",text:JSON.stringify(roomsMap)});$.post("cgi/saveconfig.cgi",{name:"functions",text:JSON.stringify(functionsMap)});$.post("cgi/saveconfig.cgi",{name:"programs",text:JSON.stringify(programsMap)});mustBeSaved=false;$('[name="saveAllChanges"]').addClass("ui-state-disabled")}function buttonEvents(a,c){var e=a.data("id");var j="?id="+e;var h="info_"+e;var g=a.data("value");if(typeof g==="undefined"){var b="setValue_"+e;g=$("#"+b).val();var d=$("#"+b).data("factor");if(typeof d!=="undefined"){j+="&value="+(parseFloat(g)/d)}else{j+="&value="+g}}else{j+="&value="+g}var f=0;var k=$("[data-duration-parent='"+a.data("parent-id")+"']");k.each(function(l){var m=$(this).datebox("getLastDur");if(!isNaN(m)){f=m>f?m:f;j+="&durationId"+l+"="+k.data("id")+"&durationValue"+l+"="+m}});if(testSite){j+="&debug=true"}$("#"+h).text(mapText("TRANSFER"));$.get("cgi/set.cgi"+j,function(){if(c){$("#"+h).text(mapText("TRANSFER_OK"));refreshPage(0)}else{$("#"+h).text(mapText("DELAY"))}if(f>0){setTimeout(function(){refreshPage(0)},(f+3)*1000)}})}function reloadList(a,c,b,d){$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+a+"<p style='float:right;'>"+c+"</p></li>");if(d!==""){$("#dataListHeader").append("<li class='description'>"+d+"</li>")}$("#dataListHeader").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create");if(b){$("#dataList").fadeIn()}}function loadData(b,e,a){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var d=false;if(a){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticdevicesMap"+e)===null){if(newVersion){saveDataToFile=true}loadConfigData(false,b+"?list="+e,"devices","webmaticdevicesMap"+e,false,true);d=true}else{loadLocalStorageMap("devices",e)}var c=devicesMap.date;$.each(devicesMap.entries,function(h,j){var f=new Object();f.addDiagram=false;f.diagramData="";f.diagramID="";f.diagramUnit="";f.varOptions={};f.varOptionsFirst="";if(j.visible!=="false"){var g=processDevices(j,c,f);if(g!==""){$("#dataList").append(g)}}addDiagram(f)});reloadList(devicesMap.name,c,a,devicesMap.description)}if(!d){loadConfigData(true,b+"?list="+e,"devices","webmaticdevicesMap"+e,false,true,function(g){var f=g.date;$.each(g.entries,function(l,m){var j=new Object();j.addDiagram=false;j.diagramData="";j.diagramID="";j.diagramUnit="";j.varOptions={};j.varOptionsFirst="";var k=processDevices(m,f,j);if(k!==""){var n=m.visible!=="false";var h=m.id;if($("#"+h).length===0&&n){$("#dataList").append(k)}else{if(n){if($.inArray(h,excludeFromRefresh)===-1){$("#"+h).replaceWith(k)}}else{if($("#"+h).length!==0){$("#"+h).remove()}}}}addDiagram(j)});reloadList(g.name,f,a,g.description)})}$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change");$("[id^=button]").trigger("create");$("[id^=input]").trigger("create");$("textarea").textinput("refresh")}function loadVariables(a){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var c=false;if(a){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticvariablesMap")===null){if(newVersion){saveDataToFile=true}loadConfigData(false,"cgi/systemvariables.cgi","variables","webmaticvariablesMap",false,true);c=true}else{loadLocalStorageMap("variables")}var b=variablesMap.date;$.each(variablesMap,function(e,d){if(e==="date"||e==="size"){return}var g=d.visible;var f=e;if((readModus&&g)||!readModus){$("#dataList").append(processVariable(d,f,b))}});reloadList(mapText("SYS_VAR"),b,a,"")}if(!c){loadConfigData(true,"cgi/systemvariables.cgi","variables","webmaticvariablesMap",false,true,function(e){var d=e.date;$.each(e,function(g,f){if(g==="date"||g==="size"){return}var j=f.visible;var h=g;if($("#"+h).length===0&&((readModus&&j)||!readModus)){$("#dataList").append(processVariable(f,h,d))}else{if((readModus&&j)||!readModus){if($.inArray(h,excludeFromRefresh)===-1){$("#"+h).replaceWith(processVariable(f,h,d))}}else{if($("#"+h).length!==0){$("#"+h).remove()}}}});reloadList(mapText("SYS_VAR"),d,a,"")})}$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change");$("textarea").textinput("refresh")}function loadPrograms(c){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");if(c){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticprogramsMap")===null){if(newVersion){saveDataToFile=true}loadConfigData(false,"../webmatic_user/programs.json","programs","webmaticprogramsMap",false,false)}else{loadLocalStorageMap("programs")}if(localStorage.getItem("webmaticprogramsclientMap")===null){if(client!==""){loadConfigData(false,"../webmatic_user/programs"+client+".json","programsClient","webmaticprogramsclientMap",false,true)}}else{programsClientMap=JSON.parse(localStorage.getItem("webmaticprogramsclientMap"))}createOneMap("programs");var e=resultProgramsMap.date;var g={};$.each(resultProgramsMap,function(k,m){if(k==="date"||k==="size"){return}var j=m.visible;var h=m.active;var l=k;g[m.position]=processProgram(m,l,e,h,(readModus&&j)||!readModus)});var f=Object.keys(g).sort(function(j,h){return j-h});var a=f.length;for(var d=0;d<a;d++){var b=f[d];$("#dataList").append(g[b])}reloadList(mapText("PROGRAMS"),e,c,"");$("#dataList").find(".btnDisabled").button("disable")}loadConfigData(true,"cgi/programs.cgi","programs","webmaticprogramsMap",false,true,function(){createOneMap("programs");var h=resultProgramsMap.date;$.each(resultProgramsMap,function(l,n){if(l==="date"||l==="size"){return}var k=n.visible;var j=n.active;var m=l;if($("#"+m).length===0){$("#dataList").append(processProgram(n,m,h,j,(readModus&&k)||!readModus))}else{$("#"+m).replaceWith(processProgram(n,m,h,j,(readModus&&k)||!readModus))}});reloadList(mapText("PROGRAMS"),h,c,"");$("#dataList").find(".btnDisabled").button("disable");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly")});$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly")}function loadGraphicIDs(a){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");$("#dataList").append("<li sytle='text-align:center;'><a href='#' "+(!mustBeSaved?"class='ui-btn ui-btn-inline ui-icon-check ui-btn-icon-left ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-inline='true' data-icon='check'")+" name='saveAllChanges'>"+mapText("SAVE")+"</a></li>");if(localStorage.getItem("webmatic"+a+"Map")===null){if(newVersion){saveDataToFile=true}loadConfigData(false,"../webmatic_user/"+a+".json",a,"webmatic"+a+"Map",false,false)}else{loadLocalStorageMap(a)}if(localStorage.getItem("webmatic"+a+"clientMap")===null){if(client!==""){loadConfigData(false,"../webmatic_user/"+a+client+".json",a+"Client","webmatic"+a+"clientMap",false,true)}}else{setResultMap(a,JSON.parse(localStorage.getItem("webmatic"+a+"clientMap")))}createOneMap(a);loadConfigData(true,"cgi/"+a+".cgi",a,"webmatic"+a+"Map",false,true,function(){createOneMap(a)});$("#dataList").append("<li data-role='list-divider' role='heading'>"+mapText(a)+"</li>");processGraphicID(a);$("#dataList").append("<li sytle='text-align:center;'><a href='#' "+(!mustBeSaved?"class='ui-btn ui-btn-inline ui-icon-check ui-btn-icon-left ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-inline='true' data-icon='check'")+" name='saveAllChanges'>"+mapText("SAVE")+"</a></li>");$("#dataList").listview("refresh");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly");$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+mapText("EDIT")+"</li>");$("#dataListHeader").listview("refresh");$("#buttonRefresh .ui-btn-text").html("&nbsp;");$("#dataList").listview("refresh");$("#dataList").trigger("create").fadeIn()}function loadOptionsClient(){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+mapText("OPTIONS_CLIENT")+" ("+client+")</li>");var f;f="<li><h1>"+mapText("CHOOSE_THEME")+"</h1>";f+="<div class='ui-field-contain'>";f+="<div class='ui-grid-b'>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("DESIGN")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";f+="<select id='client_default_theme' data-theme='"+theme+"'>";var a=optionsClientMap.default_theme;f+="<option value='none'>"+mapText("NOT_SELECTED")+"</option>";f+="<option value='a' "+(a==="a"?"selected='selected'":"")+">"+mapText("DEFAULT")+"</option>";f+="<option value='b' "+(a==="b"?"selected='selected'":"")+">"+mapText("BLACK")+"</option>";f+="<option value='c' "+(a==="c"?"selected='selected'":"")+">"+mapText("PINK")+"</option>";f+="<option value='d' "+(a==="d"?"selected='selected'":"")+">"+mapText("GREEN")+"</option>";f+="<option value='e' "+(a==="e"?"selected='selected'":"")+">"+mapText("YELLOW")+"</option>";f+="<option value='f' "+(a==="f"?"selected='selected'":"")+">"+mapText("GREY")+"</option>";f+="<option value='g' "+(a==="g"?"selected='selected'":"")+">"+mapText("BLUE")+"</option>";f+="<option value='h' "+(a==="h"?"selected='selected'":"")+">"+mapText("RED")+"</option>";f+="<option value='i' "+(a==="i"?"selected='selected'":"")+">"+mapText("BROWN")+"</option>";f+="<option value='j' "+(a==="j"?"selected='selected'":"")+">"+mapText("WHITE")+"</option>";f+="<option value='k' "+(a==="k"?"selected='selected'":"")+">"+mapText("BRAZIL")+"</option>";f+="<option value='l' "+(a==="l"?"selected='selected'":"")+">"+mapText("GERMANY")+"</option>";f+="</select>";f+="<a href='#' name='saveClientOption' data-key='default_theme' data-role='button' data-inline='true' data-icon='check'>&nbsp;</a>";f+="</div>";f+="</div>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("FONT")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";f+="<select id='client_default_font' data-theme='"+theme+"'>";var g=optionsClientMap.default_font;f+="<option value='none'>"+mapText("NOT_SELECTED")+"</option>";f+="<option value='a' "+(g==="a"?"selected='selected'":"")+">Normal</a>";f+="<option value='b' "+(g==="b"?"selected='selected'":"")+">Koch Fraktur</a>";f+="<option value='c' "+(g==="c"?"selected='selected'":"")+">Planet Benson</a>";f+="<option value='d' "+(g==="d"?"selected='selected'":"")+">Action Man</a>";f+="<option value='e' "+(g==="e"?"selected='selected'":"")+">Amadeus</a>";f+="<option value='f' "+(g==="f"?"selected='selected'":"")+">Vamp</a>";f+="<option value='g' "+(g==="g"?"selected='selected'":"")+">HennyPenny</a>";f+="<option value='h' "+(g==="h"?"selected='selected'":"")+">Anglican</a>";f+="<option value='i' "+(g==="i"?"selected='selected'":"")+">Nosifer</a>";f+="<option value='j' "+(g==="j"?"selected='selected'":"")+">Pacifico</a>";f+="<option value='k' "+(g==="k"?"selected='selected'":"")+">Sixties</a>";f+="<option value='l' "+(g==="l"?"selected='selected'":"")+">Crackman</a>";f+="</select>";f+="<a href='#' name='saveClientOption' data-key='default_font' data-role='button' data-inline='true' data-icon='check'>&nbsp;</a>";f+="</div>";f+="</div>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("GRAPHICS_SIZE")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";var j=optionsClientMap.default_menugfxsize;var e="";var d="";var c="";if(j==="large"){c="class='ui-btn-active'"}else{if(j==="small"){d="class='ui-btn-active'"}else{e="class='ui-btn-active'"}}f+="<a href='#' name='saveClientOption' data-key='default_menugfxsize' data-value='none' data-role='button' data-inline='true' "+e+">"+mapText("NOT_SELECTED")+"</a>";f+="<a href='#' name='saveClientOption' data-key='default_menugfxsize' data-value='small' data-role='button' data-inline='true' "+d+">"+mapText("SMALL")+"</a>";f+="<a href='#' name='saveClientOption' data-key='default_menugfxsize' data-value='large' data-role='button' data-inline='true' "+c+">"+mapText("BIG")+"</a>";f+="</div>";f+="</div>";f+="</div></div></li>";$("#dataList").append(f);f="<li><h1>"+mapText("MENU")+"</h1>";f+="<div class='ui-field-contain'>";f+="<div class='ui-grid-b'>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("FAVORITES")+" "+mapText("SHOW")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";e="";d="";c="";if(!("favorites" in optionsClientMap)){e="class='ui-btn-active'"}else{if(optionsClientMap.favorites){d="class='ui-btn-active'"}else{c="class='ui-btn-active'"}}f+="<a href='#' name='saveClientOption' data-key='favorites' data-value='none' data-role='button' data-inline='true' "+e+">"+mapText("NOT_SELECTED")+"</a>";f+="<a href='#' name='saveClientOption' data-key='favorites' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";f+="<a href='#' name='saveClientOption' data-key='favorites' data-value='false' data-role='button' data-inline='true' "+c+">"+mapText("NO")+"</a>";f+="</div>";f+="</div>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("ROOMS")+" "+mapText("SHOW")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";e="";d="";c="";if(!("rooms" in optionsClientMap)){e="class='ui-btn-active'"}else{if(optionsClientMap.rooms){d="class='ui-btn-active'"}else{c="class='ui-btn-active'"}}f+="<a href='#' name='saveClientOption' data-key='rooms' data-value='none' data-role='button' data-inline='true' "+e+">"+mapText("NOT_SELECTED")+"</a>";f+="<a href='#' name='saveClientOption' data-key='rooms' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";f+="<a href='#' name='saveClientOption' data-key='rooms' data-value='false' data-role='button' data-inline='true' "+c+">"+mapText("NO")+"</a>";f+="</div>";f+="</div>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("FUNCTIONS")+" "+mapText("SHOW")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";e="";d="";c="";if(!("functions" in optionsClientMap)){e="class='ui-btn-active'"}else{if(optionsClientMap.functions){d="class='ui-btn-active'"}else{c="class='ui-btn-active'"}}f+="<a href='#' name='saveClientOption' data-key='functions' data-value='none' data-role='button' data-inline='true' "+e+">"+mapText("NOT_SELECTED")+"</a>";f+="<a href='#' name='saveClientOption' data-key='functions' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";f+="<a href='#' name='saveClientOption' data-key='functions' data-value='false' data-role='button' data-inline='true' "+c+">"+mapText("NO")+"</a>";f+="</div>";f+="</div>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("SYS_VAR")+" "+mapText("SHOW")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";e="";d="";c="";if(!("variables" in optionsClientMap)){e="class='ui-btn-active'"}else{if(optionsClientMap.variables){d="class='ui-btn-active'"}else{c="class='ui-btn-active'"}}f+="<a href='#' name='saveClientOption' data-key='variables' data-value='none' data-role='button' data-inline='true' "+e+">"+mapText("NOT_SELECTED")+"</a>";f+="<a href='#' name='saveClientOption' data-key='variables' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";f+="<a href='#' name='saveClientOption' data-key='variables' data-value='false' data-role='button' data-inline='true' "+c+">"+mapText("NO")+"</a>";f+="</div>";f+="</div>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("PROGRAMS")+" "+mapText("SHOW")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";e="";d="";c="";if(!("programs" in optionsClientMap)){e="class='ui-btn-active'"}else{if(optionsClientMap.programs){d="class='ui-btn-active'"}else{c="class='ui-btn-active'"}}f+="<a href='#' name='saveClientOption' data-key='programs' data-value='none' data-role='button' data-inline='true' "+e+">"+mapText("NOT_SELECTED")+"</a>";f+="<a href='#' name='saveClientOption' data-key='programs' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";f+="<a href='#' name='saveClientOption' data-key='programs' data-value='false' data-role='button' data-inline='true' "+c+">"+mapText("NO")+"</a>";f+="</div>";f+="</div>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("SETTINGS")+" "+mapText("SHOW")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";e="";d="";c="";var h="false";if(!("others" in optionsClientMap)){e="class='ui-btn-active'"}else{if(optionsClientMap.others){d="class='ui-btn-active'";h="true"}else{c="class='ui-btn-active'"}}f+="<a href='#' name='saveClientOption' data-key='others' data-value='none' id='others_none_selector' data-nms='"+h+"' data-role='button' data-inline='true' "+e+">"+mapText("NOT_SELECTED")+"</a>";f+="<a href='#' name='saveClientOption' data-key='others' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";f+="<a href='#' name='saveClientOption' data-key='others' data-value='false' id='others_no_selector' data-nms='"+h+"' data-role='button' data-inline='true' "+c+">"+mapText("NO")+"</a>";f+="</div>";f+="</div>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("DEFAULT_OPEN")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";f+="<select id='client_collapsed' data-theme='"+theme+"'>";var b=optionsClientMap.collapsed;f+="<option value='none'>"+mapText("NOT_SELECTED")+"</a>";f+="<option value='favorites' "+(b==="favorites"?"selected='selected'":"")+">"+mapText("FAVORITES")+"</a>";f+="<option value='rooms' "+(b==="rooms"?"selected='selected'":"")+">"+mapText("ROOMS")+"</a>";f+="<option value='functions' "+(b==="functions"?"selected='selected'":"")+">"+mapText("FUNCTIONS")+"</a>";f+="<option value='variables' "+(b==="variables"?"selected='selected'":"")+">"+mapText("SYS_VAR")+"</a>";f+="<option value='programs' "+(b==="programs"?"selected='selected'":"")+">"+mapText("PROGRAMS")+"</a>";f+="<option value='others' "+(b==="others"?"selected='selected'":"")+">"+mapText("SETTINGS")+"</a>";f+="</select>";f+="<a href='#' name='saveClientOption' data-key='collapsed' data-role='button' data-inline='true' data-icon='check'>&nbsp;</a>";f+="</div>";f+="</div>";f+="</div></div></li>";$("#dataList").append(f);f="<li><h1>"+mapText("SYS_VAR")+"</h1>";f+="<div class='ui-field-contain'>";f+="<div class='ui-grid-b'>";f+="<div class='ui-block-a text-right'>";f+="<span>"+mapText("DEFAULT_READONLY")+"</span>";f+="</div>";f+="<div class='ui-block-b'>";f+="<div data-role='controlgroup' data-type='horizontal'>";e="";d="";c="";if(!("systemvar_readonly" in optionsClientMap)){e="class='ui-btn-active'"}else{if(optionsClientMap.systemvar_readonly){d="class='ui-btn-active'"}else{c="class='ui-btn-active'"}}f+="<a href='#' name='saveClientOption' data-key='systemvar_readonly' data-value='none' data-role='button' data-inline='true' "+e+">"+mapText("NOT_SELECTED")+"</a>";f+="<a href='#' name='saveClientOption' data-key='systemvar_readonly' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";f+="<a href='#' name='saveClientOption' data-key='systemvar_readonly' data-value='false' data-role='button' data-inline='true' "+c+">"+mapText("NO")+"</a>";f+="</div>";f+="</div>";f+="</div></div></li>";$("#dataList").append(f);$("#dataListHeader").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create").fadeIn()}function loadOptions(){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+mapText("OPTIONS")+"</li>");var c;c="<li><h1>"+mapText("CHOOSE_THEME")+"</h1>";c+="<div class='ui-field-contain'>";c+="<div class='ui-grid-b'>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("DESIGN")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";c+="<select id='global_default_theme' data-theme='"+theme+"'>";var f=optionsMap.default_theme;c+="<option value='a' "+(f==="a"?"selected='selected'":"")+">"+mapText("DEFAULT")+"</option>";c+="<option value='b' "+(f==="b"?"selected='selected'":"")+">"+mapText("BLACK")+"</option>";c+="<option value='c' "+(f==="c"?"selected='selected'":"")+">"+mapText("PINK")+"</option>";c+="<option value='d' "+(f==="d"?"selected='selected'":"")+">"+mapText("GREEN")+"</option>";c+="<option value='e' "+(f==="e"?"selected='selected'":"")+">"+mapText("YELLOW")+"</option>";c+="<option value='f' "+(f==="f"?"selected='selected'":"")+">"+mapText("GREY")+"</option>";c+="<option value='g' "+(f==="g"?"selected='selected'":"")+">"+mapText("BLUE")+"</option>";c+="<option value='h' "+(f==="h"?"selected='selected'":"")+">"+mapText("RED")+"</option>";c+="<option value='i' "+(f==="i"?"selected='selected'":"")+">"+mapText("BROWN")+"</option>";c+="<option value='j' "+(f==="j"?"selected='selected'":"")+">"+mapText("WHITE")+"</option>";c+="<option value='k' "+(f==="k"?"selected='selected'":"")+">"+mapText("BRAZIL")+"</option>";c+="<option value='l' "+(f==="l"?"selected='selected'":"")+">"+mapText("GERMANY")+"</option>";c+="</select>";c+="<a href='#' name='saveGlobalOption' data-key='default_theme' data-role='button' data-inline='true' data-icon='check'>&nbsp;</a>";c+="</div>";c+="</div>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("FONT")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";c+="<select id='global_default_font' data-theme='"+theme+"'>";var e=optionsMap.default_font;c+="<option value='a' "+(e==="a"?"selected='selected'":"")+">Normal</a>";c+="<option value='b' "+(e==="b"?"selected='selected'":"")+">Koch Fraktur</a>";c+="<option value='c' "+(e==="c"?"selected='selected'":"")+">Planet Benson</a>";c+="<option value='d' "+(e==="d"?"selected='selected'":"")+">Action Man</a>";c+="<option value='e' "+(e==="e"?"selected='selected'":"")+">Amadeus</a>";c+="<option value='f' "+(e==="f"?"selected='selected'":"")+">Vamp</a>";c+="<option value='g' "+(e==="g"?"selected='selected'":"")+">HennyPenny</a>";c+="<option value='h' "+(e==="h"?"selected='selected'":"")+">Anglican</a>";c+="<option value='i' "+(e==="i"?"selected='selected'":"")+">Nosifer</a>";c+="<option value='j' "+(e==="j"?"selected='selected'":"")+">Pacifico</a>";c+="<option value='k' "+(e==="k"?"selected='selected'":"")+">Sixties</a>";c+="<option value='l' "+(e==="l"?"selected='selected'":"")+">Crackman</a>";c+="</select>";c+="<a href='#' name='saveGlobalOption' data-key='default_font' data-role='button' data-inline='true' data-icon='check'>&nbsp;</a>";c+="</div>";c+="</div>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("GRAPHICS_SIZE")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";var h=optionsMap.default_menugfxsize;var d="";var b="";if(h==="small"){d="class='ui-btn-active'"}else{b="class='ui-btn-active'"}c+="<a href='#' name='saveGlobalOption' data-key='default_menugfxsize' data-value='small' data-role='button' data-inline='true' "+d+">"+mapText("SMALL")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='default_menugfxsize' data-value='large' data-role='button' data-inline='true' "+b+">"+mapText("BIG")+"</a>";c+="</div>";c+="</div>";c+="</div></div></li>";$("#dataList").append(c);c="<li><h1>"+mapText("MENU")+"</h1>";c+="<p>"+mapText("GLOBAL_SETTINGS_HIDE_WARNING")+"</p>";c+="<div class='ui-field-contain'>";c+="<div class='ui-grid-b'>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("FAVORITES")+" "+mapText("SHOW")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";d="";b="";if(optionsMap.favorites){d="class='ui-btn-active'"}else{b="class='ui-btn-active'"}c+="<a href='#' name='saveGlobalOption' data-key='favorites' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='favorites' data-value='false' data-role='button' data-inline='true' "+b+">"+mapText("NO")+"</a>";c+="</div>";c+="</div>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("ROOMS")+" "+mapText("SHOW")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";d="";b="";if(optionsMap.rooms){d="class='ui-btn-active'"}else{b="class='ui-btn-active'"}c+="<a href='#' name='saveGlobalOption' data-key='rooms' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='rooms' data-value='false' data-role='button' data-inline='true' "+b+">"+mapText("NO")+"</a>";c+="</div>";c+="</div>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("FUNCTIONS")+" "+mapText("SHOW")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";d="";b="";if(optionsMap.functions){d="class='ui-btn-active'"}else{b="class='ui-btn-active'"}c+="<a href='#' name='saveGlobalOption' data-key='functions' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='functions' data-value='false' data-role='button' data-inline='true' "+b+">"+mapText("NO")+"</a>";c+="</div>";c+="</div>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("SYS_VAR")+" "+mapText("SHOW")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";d="";b="";if(optionsMap.variables){d="class='ui-btn-active'"}else{b="class='ui-btn-active'"}c+="<a href='#' name='saveGlobalOption' data-key='variables' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='variables' data-value='false' data-role='button' data-inline='true' "+b+">"+mapText("NO")+"</a>";c+="</div>";c+="</div>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("PROGRAMS")+" "+mapText("SHOW")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";d="";b="";if(optionsMap.programs){d="class='ui-btn-active'"}else{b="class='ui-btn-active'"}c+="<a href='#' name='saveGlobalOption' data-key='programs' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='programs' data-value='false' data-role='button' data-inline='true' "+b+">"+mapText("NO")+"</a>";c+="</div>";c+="</div>";c+="<div class='ui-block-a text-right'>";c+="<span style='color: red;'>"+mapText("SETTINGS")+" "+mapText("SHOW")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";d="class='"+(optionsMap.others?"ui-btn-active":"")+(optionsMap.no_more_settings===0?" ui-state-disabled":"")+"'";b="class='"+(!optionsMap.others?"ui-btn-active":"")+(optionsMap.no_more_settings===0?" ui-state-disabled":"")+"'";c+="<a href='#' name='saveGlobalOption' data-key='others' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='others' data-value='false' data-role='button' data-inline='true' "+b+">"+mapText("NO")+"</a>";c+="</div>";c+="</div>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("DEFAULT_OPEN")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";c+="<select id='global_collapsed' data-theme='"+theme+"'>";var g=optionsMap.collapsed;c+="<option value='none'>"+mapText("NOT_SELECTED")+"</a>";c+="<option value='favorites' "+(g==="favorites"?"selected='selected'":"")+">"+mapText("FAVORITES")+"</a>";c+="<option value='rooms' "+(g==="rooms"?"selected='selected'":"")+">"+mapText("ROOMS")+"</a>";c+="<option value='functions' "+(g==="functions"?"selected='selected'":"")+">"+mapText("FUNCTIONS")+"</a>";c+="<option value='variables' "+(g==="variables"?"selected='selected'":"")+">"+mapText("SYS_VAR")+"</a>";c+="<option value='programs' "+(g==="programs"?"selected='selected'":"")+">"+mapText("PROGRAMS")+"</a>";c+="<option value='others' "+(g==="others"?"selected='selected'":"")+">"+mapText("SETTINGS")+"</a>";c+="</select>";c+="<a href='#' name='saveGlobalOption' data-key='collapsed' data-role='button' data-inline='true' data-icon='check'>&nbsp;</a>";c+="</div>";c+="</div>";c+="</div></div></li>";$("#dataList").append(c);c="<li><h1>"+mapText("SYS_VAR")+"</h1>";c+="<div class='ui-field-contain'>";c+="<div class='ui-grid-b'>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("DEFAULT_READONLY")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";d="";b="";if(optionsMap.systemvar_readonly){d="class='ui-btn-active'"}else{b="class='ui-btn-active'"}c+="<a href='#' name='saveGlobalOption' data-key='systemvar_readonly' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='systemvar_readonly' data-value='false' data-role='button' data-inline='true' "+b+">"+mapText("NO")+"</a>";c+="</div>";c+="</div>";c+="</div></div></li>";$("#dataList").append(c);c="<li><h1>CCU-Historian <a href='http://homematic-forum.de/forum/viewforum.php?f=39' target='_blank' class='ui-btn ui-icon-info ui-btn-icon-notext ui-corner-all'>Info</a></h1>";c+="<div class='ui-field-contain'>";c+="<div class='ui-grid-b'>";c+="<div class='ui-block-a text-right'>";c+="CCU-Historian Link";c+="</div>";c+="<div class='ui-block-b'>";c+="<input type='text' id='global_ccu_historian' value='"+optionsMap.ccu_historian+"' placeholder='http://192.168.xx.xxx' />";c+="<span>http://192.168.xx.xxx</span>";c+="</div>";c+="<div class='ui-block-c'>";c+="/historian/index.html ";c+="<a href='#' name='saveGlobalOption' data-key='ccu_historian' data-role='button' data-inline='true'>"+mapText("SAVE")+"</a>";c+="</div>";c+="</div></div></li>";$("#dataList").append(c);c="<li><h1>WebMatic updates</h1>";c+="<div class='ui-field-contain'>";c+="<div class='ui-grid-b'>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("NEW_UPDATES_WARNING")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";c+="<select id='global_new_version' data-theme='"+theme+"'>";var a=optionsMap.new_version;c+="<option value='no'>"+mapText("NO")+"</a>";c+="<option value='stable' "+(a==="stable"?"selected='selected'":"")+">"+mapText("STABLE")+"</a>";c+="<option value='alpha' "+(a==="alpha"?"selected='selected'":"")+">"+mapText("ALPHA")+"</a>";c+="</select>";c+="<a href='#' name='saveGlobalOption' data-key='new_version' data-role='button' data-inline='true' data-icon='check'>&nbsp;</a>";c+="</div>";c+="</div>";c+="</div></div></li>";$("#dataList").append(c);c="<li><h1>"+mapText("OTHERS")+"</h1>";c+="<div class='ui-field-contain'>";c+="<div class='ui-grid-b'>";c+="<div class='ui-block-a text-right'>";c+="<span>"+mapText("DONT_LEAVE")+"</span>";c+="</div>";c+="<div class='ui-block-b'>";c+="<div data-role='controlgroup' data-type='horizontal'>";d="";b="";if(optionsMap.dont_leave){d="class='ui-btn-active'"}else{b="class='ui-btn-active'"}c+="<a href='#' name='saveGlobalOption' data-key='dont_leave' data-value='true' data-role='button' data-inline='true' "+d+">"+mapText("YES")+"</a>";c+="<a href='#' name='saveGlobalOption' data-key='dont_leave' data-value='false' data-role='button' data-inline='true' "+b+">"+mapText("NO")+"</a>";c+="</div>";c+="</div>";c+="</div></div></li>";$("#dataList").append(c);$("#dataListHeader").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create").fadeIn()}$(function(){$.jqplot.config.enablePlugins=true;$(document).bind("mobileinit",function(){$.mobile.listview.prototype.options.filterPlaceholder=mapText("FILTER")});$(document.body).on("click","[name='saveClientOption']",function(){var b=$(this).data("key");var c="";if($("#client_"+b).length){c=$("#client_"+b).val()}else{$(this).parent().find(".ui-btn-active").removeClass("ui-btn-active");c=$(this).addClass("ui-btn-active").data("value")}if("others"===b){var a=optionsMap.no_more_settings;if(c){a++;optionsMap.no_more_settings=a;saveOptionsToServer()}else{if($(this).data("nms")==="true"){$("#others_none_selector").attr("data-nms","false");$("#others_no_selector").attr("data-nms","false");a--;optionsMap.no_more_settings=a;saveOptionsToServer()}}}if(c!==""){if(c==="true"){c=true}else{if(c==="false"){c=false}else{if($.isNumeric(c)){c=parseInt(c)}}}if(c==="none"){delete optionsClientMap[b];resultOptionsMap[b]=optionsMap[b];c=optionsMap[b]}else{optionsClientMap[b]=c;resultOptionsMap[b]=c}saveClientOptionsToServer(b,c)}});$(document.body).on("click","[name='saveGlobalOption']",function(){var a=$(this).data("key");var b="";if($("#global_"+a).length){b=$("#global_"+a).val()}else{$(this).parent().find(".ui-btn-active").removeClass("ui-btn-active");b=$(this).addClass("ui-btn-active").data("value")}if(b!==""){if(b==="true"){b=true}else{if(b==="false"){b=false}else{if($.isNumeric(b)){b=parseInt(b)}}}optionsMap[a]=b;saveOptionsToServer(a,b)}});$(document.body).on("click","[id^=setButton]",function(){var g=$(this);var l=g.data("special");if(l){var n=g.data("id");switch(l){case"CLIMATECONTROL_RT_TRANSCEIVER":var o=$("#setTemperature_"+n).val();var b=$("#setStartTime_"+n).datebox("getTheDate");var c=$("#setStartDate_"+n).datebox("getTheDate");var f=(b.getHours()*60)+b.getMinutes();var m=c.getDate();var d=c.getMonth()+1;var q=c.getYear()-100;var j=$("#setEndTime_"+n).datebox("getTheDate");var h=$("#setEndDate_"+n).datebox("getTheDate");var a=(j.getHours()*60)+j.getMinutes();var e=h.getDate();var p=h.getMonth()+1;var k=h.getYear()-100;g.attr("data-value",o+","+f+","+m+","+d+","+q+","+a+","+e+","+p+","+k);break}}buttonEvents(g,g.data("refresh"),l)});$(document.body).on("click","[id^=saveHistorianData]",function(){var b=$(this);var a=b.data("id");b.attr("data-value",$("#hisHistorianID_"+a).val()+";"+$("#hisHMID_"+a).val()+";"+$("#hisDuration_"+a).val()+$("#hisSelector_"+a).val());buttonEvents(b,true)});$(document.body).on("click","[id^=setValueBigList]",function(){var b=$(this);var a=b.data("id");b.attr("data-value",$("#selector_"+a).val());buttonEvents(b,b.data("refresh"))});$(document.body).on("click","[id^=setUp]",function(){var c=$(this).data("id");var f=$("#list"+c);var j=f.height();var g=f.prev();var b=g.data("id");var h=parseInt($("#position"+c).val());var d=$("#position"+c).data("last");var a=parseInt($("#position"+b).val());$("#position"+c).val(a);$("#position"+b).val(h);if(debugModus){$("#positiondebug"+c).text("Debug: "+a);$("#positiondebug"+b).text("Debug: "+h)}if(a===1){$("#setUp"+c).addClass("ui-state-disabled").hide();$("#setUp"+b).removeClass("ui-state-disabled").show()}if(d){$("#position"+c).data("last",false);$("#position"+b).data("last",true);$("#setDown"+c).removeClass("ui-state-disabled").show();$("#setDown"+b).addClass("ui-state-disabled").hide()}f.animate({top:"-"+j+"px"},500,function(){g.animate({top:j+"px"},500,function(){f.css("top","0px");g.css("top","0px");f.insertBefore(g)})});var e=$("#position"+c).data("type");switch(e){case"favorites":favoritesMap[c]["position"]=a;favoritesMap[b]["position"]=h;break;case"rooms":roomsMap[c]["position"]=a;roomsMap[b]["position"]=h;break;case"functions":functionsMap[c]["position"]=a;functionsMap[b]["position"]=h;break;case"programs":programsMap[c]["position"]=a;programsMap[b]["position"]=h;break}activateSettingSaveButton()});$(document.body).on("click","[id^=setDown]",function(){var c=$(this).data("id");var g=$("#list"+c);var j=g.height();var a=g.next();var e=a.data("id");var h=parseInt($("#position"+c).val());var d=$("#position"+e).data("last");var b=parseInt($("#position"+e).val());$("#position"+c).val(b);$("#position"+e).val(h);if(debugModus){$("#positiondebug"+c).text("Debug: "+b);$("#positiondebug"+e).text("Debug: "+h)}if(h===1){$("#setUp"+e).addClass("ui-state-disabled").hide();$("#setUp"+c).removeClass("ui-state-disabled").show()}if(d){$("#position"+c).data("last",true);$("#position"+e).data("last",false);$("#setDown"+c).addClass("ui-state-disabled").hide();$("#setDown"+e).removeClass("ui-state-disabled").show()}g.animate({top:j+"px"},500,function(){a.animate({top:"-"+j+"px"},500,function(){g.css("top","0px");a.css("top","0px");g.insertAfter(a)})});var f=$("#position"+c).data("type");switch(f){case"favorites":favoritesMap[c]["position"]=b;favoritesMap[e]["position"]=h;break;case"rooms":roomsMap[c]["position"]=b;roomsMap[e]["position"]=h;break;case"functions":functionsMap[c]["position"]=b;functionsMap[e]["position"]=h;break;case"programs":programsMap[c]["position"]=b;programsMap[e]["position"]=h;break}activateSettingSaveButton()});$(document.body).on("click","[id^=setTextButton]",function(){var b=$(this).data("id");var a="setValue_"+b;var d="info_"+b;var e=$("#"+a).val();e=e.replace(/\"/g,"'");e=encodeURIComponent(e);var c="";if(testSite){c+="&debug=true"}$("#"+d).text(mapText("TRANSFER"));$.get("cgi/set.cgi?id="+b+"&value="+e+c,function(){$("#"+d).text(mapText("TRANSFER_OK"));refreshPage(0)})});$(document.body).on("click","[id^=startProgramButton]",function(){var a=$(this).data("id");var c="info_"+a;var b="";if(testSite){b+="&debug=true"}$("#"+c).text("START");$.get("cgi/startprogram.cgi?id="+a+b,function(){$("#"+c).text(mapText("TRANSFER_OK"))})});$(document.body).on("click","[name='deletePic']",function(){var b=$(this);var a=b.data("type");var c=b.data("id");$.get("cgi/delete.cgi?type="+a+"&name="+c,function(){$("#img"+c).fadeOut(500,function(){$("#img"+c).attr("src","img/menu/"+a+".png").fadeIn(1000)});$("#menuImg"+c).fadeOut(500,function(){$("#menuImg"+c).attr("src","img/menu/"+a+".png").fadeIn(1000)});switch(a){case"favorites":favoritesMap[c]["pic"]=false;break;case"rooms":roomsMap[c]["pic"]=false;break;case"functions":functionsMap[c]["pic"]=false;break;case"programs":programsMap[c]["pic"]=false;break}b.addClass("ui-state-disabled")})});$(document.body).on("change","[name='editVisible']",function(){var c=$(this);var d=c.data("id");var a=c.data("type");var b=c.prop("checked");if(b){$("#"+d).fadeIn(1000)}else{$("#"+d).fadeOut(1000)}switch(a){case"favorites":favoritesMap[d]["visible"]=b;break;case"rooms":roomsMap[d]["visible"]=b;break;case"functions":functionsMap[d]["visible"]=b;break;case"programs":programsMap[d]["visible"]=b;break}activateSettingSaveButton()});$(document.body).on("change","[name='editOperate']",function(){var b=$(this);var c=b.data("id");var a=b.prop("checked");if(a){$("#"+c).fadeIn(1000)}else{$("#"+c).fadeOut(1000)}programsMap[c]["visible"]=a;activateSettingSaveButton()});$(document.body).on("click","[name='saveAllChanges']",function(){saveAllDatasToServer()});$(document.body).on("change","[name='editName']",function(){var c=$(this);var d=c.data("id");var a=c.val();var b=c.data("type");switch(b){case"favorites":favoritesMap[d]["name"]=a;break;case"rooms":roomsMap[d]["name"]=a;break;case"functions":functionsMap[d]["name"]=a;break;case"programs":programsMap[d]["name"]=a;break}$("#menuText"+d).fadeOut(500,function(){$("#menuText"+d).text(a).fadeIn(1000)});activateSettingSaveButton()});$(document.body).on("change",":file",function(){var b=this.files[0];if(b.name.length<1){}else{if(b.type!=="image/png"&&b.type!=="image/jpg"&&!b.type!=="image/gif"&&b.type!=="image/jpeg"){$.mobile.alert(mapText("IMAGE_UPLOAD"))}else{var c=$(this).attr("id");var a=c.substr(4,c.length);$("#uploadPicture"+a).removeClass("ui-state-disabled")}}});$(document.body).on("click","a[name=uploadPicture]",function(){var f=$(this).attr("id");var c=f.substr(13,f.length);var d=$(this).data("type");var e=new FormData();var b=document.getElementById("file"+c).files[0];var a=new FileReader();a.onloadend=function(){var g=new Image();g.src=a.result;g.onload=function(){var n=160;var j=160;var q=g.width;var k=g.height;if(q>k){if(q>n){k*=n/q;q=n}}else{if(k>j){q*=j/k;k=j}}var l=document.createElement("canvas");l.width=q;l.height=k;var v=l.getContext("2d");v.drawImage(this,0,0,q,k);var m=l.toDataURL("image/png");var u=atob(m.split(",")[1]);var o=new ArrayBuffer(u.length);var t=new Uint8Array(o);for(var p=0;p<u.length;p++){t[p]=u.charCodeAt(p)&255}var h;try{h=new Blob([o],{type:"image/png"})}catch(r){var s=new (window.WebKitBlobBuilder||window.MozBlobBuilder);s.append(o);h=s.getBlob("image/png")}$("#img"+c).fadeOut(500,function(){$("#img"+c).attr("src",m).fadeIn(1000)});$("#menuImg"+c).fadeOut(500,function(){$("#menuImg"+c).attr("src",m).fadeIn(1000)});switch(d){case"favorites":favoritesMap[c]["pic"]=true;break;case"rooms":roomsMap[c]["pic"]=true;break;case"functions":functionsMap[c]["pic"]=true;break;case"programs":programsMap[c]["pic"]=true;break}e.append("file",h,c+".png");e.append("filename",c+".png");e.append("path","/usr/local/etc/config/addons/www/webmatic_user/img/ids/"+d+"/");$.ajax({url:"cgi/upload.cgi",type:"POST",data:e,cache:false,contentType:false,processData:false},"json")};$("#uploadPicture"+c).addClass("ui-state-disabled");$("#deletePic"+c).removeClass("ui-state-disabled")};a.readAsDataURL(b)});$(window).on("beforeunload",function(){if(mustBeSaved){saveAllDatasToServer()}if(!debugModus&&resultOptionsMap.dont_leave){return"Don't leave me!"}})});