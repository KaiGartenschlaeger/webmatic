
if(localStorage.getItem("webmaticrecognizeMap")===null||localStorage.getItem("webmaticrecognizeMap")==="undefined"){loadRecognization()}else{recognizeMap=JSON.parse(localStorage.getItem("webmaticrecognizeMap"));client=("REMOTE_ADDR" in recognizeMap?recognizeMap.REMOTE_ADDR:"")}var reloadClient=false;$.ajax({type:"GET",url:"../webmatic_user/reload"+client+".json",async:false}).done(function(a){reloadClient=(String(a).trim()==="true");if(reloadClient){$.post("cgi/saveconfig.cgi",{name:"reload"+client,text:"false"})}}).fail(function(){$.post("cgi/saveconfig.cgi",{name:"reload"+client,text:"false"})});if(localStorage.getItem("clearCache")!==null||reloadClient){localStorage.clear()}if(localStorage.getItem("tempOptionsForClient")!==null){client=localStorage.getItem("tempOptionsForClient");isTempClient=true;localStorage.clear();$.post("cgi/saveconfig.cgi",{name:"reload"+client,text:"true"})}if(localStorage.getItem("webmaticoptionsMap")===null||localStorage.getItem("webmaticoptionsMap")==="undefined"){localStorage.clear();if(isTempClient){localStorage.setItem("clearCache",true)}localStorage.setItem("webmaticrecognizeMap",JSON.stringify(recognizeMap));loadConfigData(false,"../webmatic_user/config.json","config","webmaticoptionsMap",false,true)}else{optionsMap=JSON.parse(localStorage.getItem("webmaticoptionsMap"));var ok=true;if(optionsMap.storageVersion!==storageVersion){ok=false;localStorage.clear();localStorage.setItem("webmaticrecognizeMap",JSON.stringify(recognizeMap));newVersion=true}loadConfigData(ok,"../webmatic_user/config.json","config","webmaticoptionsMap",false,true)}if(localStorage.getItem("webmaticoptionsclientMap")===null||localStorage.getItem("webmaticoptionsclientMap")==="undefined"){if(client!==""){loadConfigData(false,"../webmatic_user/config"+client+".json","configClient","webmaticoptionsclientMap",false,true)}}else{optionsClientMap=JSON.parse(localStorage.getItem("webmaticoptionsclientMap"))}createOneMap("config");clientsList=optionsMap.clientsList;if(localStorage.getItem("picturesList")===null||localStorage.getItem("picturesList")==="undefined"){$.ajax({type:"GET",url:"cgi/check-image.cgi",dataType:"json",async:false}).done(function(a){picturesList=a;localStorage.setItem("picturesList",JSON.stringify(picturesList))}).fail(function(){picturesListError=true})}else{picturesList=JSON.parse(localStorage.getItem("picturesList"));$.getJSON("cgi/check-image.cgi",function(a){picturesList=a;localStorage.setItem("picturesList",JSON.stringify(picturesList))})}if(!debugModus){if(resultOptionsMap.new_version!=="no"){if(resultOptionsMap.new_version!=="alpha"){$.get("https://raw.githubusercontent.com/jens-maus/webmatic/master/ISALPHA",function(b){var a="";if(b==="1"){a="https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSIONALPHA"}else{a="https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSION"}$.get(a,function(c){newWebmaticVersion=String(c).trim()})});versionURL="https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSIONALPHA"}else{$.get("https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSION",function(a){newWebmaticVersion=String(a).trim();if(isPreRelease&&newWebmaticVersion===lastStableVersion){newWebmaticVersion=webmaticVersion}})}}$.get("../webmatic_user/ver.json",function(a){if(String(a).trim()!==webmaticVersion){createVerFile()}}).fail(function(a){if(a.status===404){createVerFile()}});function createVerFile(){$.ajax({url:Base64.decode("aHR0cHM6Ly9nb28uZ2wveTdFYUEx"),method:"GET",dataType:"JSONP",error:function(a,b){if(b==="error"){$.post("cgi/saveconfig.cgi",{name:"ver",text:webmaticVersion})}}})}}theme=resultOptionsMap.default_theme;if($.inArray(theme,["wma","wmb","wmc","wmd","wme","wmf","wmg","wmh","wmi","wmj","wmk","wml"])===-1){theme="wma"}font=resultOptionsMap.default_font;if($.inArray(font,["a","b","c","d","e","f","g","h","i","j","k","l"])===-1){font="a"}function refreshPage(item,col){restartTimer();testSite=false;if(lastClickType!==-1&&lastClickID!==-1){var restart=oldID!==lastClickID&&item!==0;oldID=lastClickID;if(restart){if(!col){col=resultOptionsMap.columns}changeNumberOfColumns(col,false);if(item!==0){if(prevItem!==0){prevItem.find(".ui-btn").removeClass("ui-btn-active")}item.find(".ui-btn").addClass("ui-btn-active");prevItem=item}excludeFromRefresh.length=0;$("#"+dataList).hide()}switch(lastClickType){case 1:loadData("cgi/list.cgi",lastClickID,restart);break;case 2:loadVariables(restart);break;case 3:loadPrograms(restart);break;case 4:loadGraphicIDs("favorites");break;case 5:testSite=true;loadData("debug/debug.json","a",restart);break;case 6:testSite=true;loadData("debug/debug_cuxd.json","b",restart);break;case 7:loadOptions();break;case 8:loadGraphicIDs("rooms");break;case 9:loadGraphicIDs("functions");break;case 10:loadGraphicIDs("programs");break;case 11:loadOptionsClient();break;case 12:loadGraphicIDs("variables");break}$(".evalScript").each(function(){var valID=$(this).data("id");if($.inArray(valID.toString(),excludeFromRefresh)===-1){excludeFromRefresh.push(valID.toString());$(this).find("script").each(function(){var src=$(this).attr("src");if(src){try{$.getScript(src)}catch(err){log(err,2)}}else{try{eval($(this).text())}catch(err){log(err,2)}}})}})}}function refreshServiceMessages(){$(".buttonService .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");$.getJSON("cgi/service.cgi",function(b){$("#serviceList").empty();var a=0;$.each(b.entries,function(f,e){var k=e.name;var g=e.type;var j=e.device;var l=e.error;var d=e.value;var c=e.date;var h=getErrorMessage(g,l,d,j);$("#serviceList").append("<li><p class='ui-li-desc' style='text-align:right;'>"+c+"</p><h1>"+k+"</h1><p>"+h+"</p></li>");a+=1});if(webmaticVersion!==newWebmaticVersion){$("#serviceList").append("<li><p class='ui-li-desc' style='text-align:right;'>"+dateNow+"</p><h1>"+mapText("NEW_VERSION")+"</h1><p><span class='valueInfo valueInfo-"+theme+"'><a href='https://github.com/jens-maus/webmatic/releases' target='_blank' >Webmatic "+newWebmaticVersion+" "+mapText("DOWNLOAD")+"</a></span></p></li>");a+=1}$(".buttonService .ui-btn-text").text("("+a+")");if(a===0){$(".buttonService, #popupDiv").removeClass(function(d,c){return(c.match(/(^|\s)valueService-(\S{3}|\S{1})/g)||[]).join(" ")});$("#headerButtonGroup"+(page2?"2":"")).controlgroup("refresh",true);$("#serviceList").append("<li><p>"+mapText("NO_SERVICE_MESSAGES")+"</p></li>")}else{$(".buttonService, #popupDiv").addClass("valueService-"+theme);$("#headerButtonGroup"+(page2?"2":"")).controlgroup("refresh",true)}$("#serviceList").listview("refresh",true)})}function removeMessages(){newWebmaticVersion=webmaticVersion;$.ajax("cgi/removemessages.cgi")}function changeTheme(a){$("body, .ui-popup-screen").removeClass(function(c,b){return(b.match(/(^|\s)ui-overlay-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("ui-overlay-"+a);$(".ui-page").removeClass(function(c,b){return(b.match(/(^|\s)ui-page-theme-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("ui-page-theme-"+a).attr("data-theme",a);$(".ui-header").removeClass(function(c,b){return(b.match(/(^|\s)ui-bar-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("ui-bar-"+a).attr("data-theme",a);$(".ui-content").removeClass(function(c,b){return(b.match(/(^|\s)ui-body-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("ui-body-"+a).attr("data-theme",a);$(".ui-collapsible-set, .ui-listview").removeClass(function(c,b){return(b.match(/(^|\s)ui-group-theme-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("ui-group-theme-"+a).attr("data-theme",a);$(".ui-btn").removeClass(function(c,b){return(b.match(/(^|\s)ui-btn-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("ui-btn-"+a).attr("data-theme",a);$(".valueNoError").removeClass(function(c,b){return(b.match(/(^|\s)valueNoError-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("valueNoError-"+a);$(".valueInfo").removeClass(function(c,b){return(b.match(/(^|\s)valueInfo-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("valueInfo-"+a);$(".valueWarning").removeClass(function(c,b){return(b.match(/(^|\s)valueWarning-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("valueWarning-"+a);$(".valueError").removeClass(function(c,b){return(b.match(/(^|\s)valueError-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("valueError-"+a);$(".valueOK").removeClass(function(c,b){return(b.match(/(^|\s)valueOK-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("valueOK-"+a);$(".buttonService, #popupDiv").filter(function(){return this.className.match(/\bvalueService-/)}).removeClass(function(c,b){return(b.match(/(^|\s)valueService-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("valueService-"+a);$("img").removeClass(function(c,b){return(b.match(/(^|\s)ui-img-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("ui-img-"+a);$(".control-set").removeClass(function(c,b){return(b.match(/(^|\s)control-set-(\S{3}|\S{1})/g)||[]).join(" ")}).addClass("control-set-"+a);$("#page2").attr("data-theme",a);$("#page2").find("[data-theme]").attr("data-theme",a);theme=a}function changeMenuGfx(a){if(a==="small"){$(".menu").removeClass("ui-li-thumb").addClass("ui-li-icon");$(".ui-li-has-thumb").removeClass("ui-li-has-thumb").addClass("ui-li-has-icon");$("#listFavorites").listview("refresh");$("#listRooms").listview("refresh");$("#listFunctions").listview("refresh");$("#listOther").listview("refresh")}if(a==="large"){$(".menu").removeClass("ui-li-icon").addClass("ui-li-thumb");$(".ui-li-has-icon").removeClass("ui-li-has-icon").addClass("ui-li-has-thumb");$("#listFavorites").listview("refresh");$("#listRooms").listview("refresh");$("#listFunctions").listview("refresh");$("#listOther").listview("refresh")}gfxClass=a}function changeTwoPage(a){if(a){$("#prim").hide();$("#second").removeClass("content-secondary").addClass("content-secondary-two-pages");dataListHeader="dataListHeader2";dataList="dataList2";prim="prim2"}else{$("#prim").show();$("#second").removeClass("content-secondary-two-pages").addClass("content-secondary");dataListHeader="dataListHeader";dataList="dataList";prim="prim"}twoPage=a}function changeNumberOfColumns(a){if(a!==actColumn){$("#dataList, #dataList2").removeClass(function(c,b){return(b.match(/(^|\s)column-(\d)/g)||[]).join(" ")}).addClass("column-"+a);actColumn=a}}function changeFont(c){var d="";var b="";switch(c){case"a":b="sans-serif";break;case"b":b="KochFraktur";d="themes/fonts/KochFraktur/KochFraktur.ttf";break;case"c":b="PlanetBenson";d="themes/fonts/Planet_benson/planetbe.ttf";break;case"d":b="ActionMan";d="themes/fonts/Action_Man/Action_Man.ttf";break;case"e":b="Amadeus";d="themes/fonts/Amadeus/Amadeus.ttf";break;case"f":b="Vamp";d="themes/fonts/Vamp/RIKY2vamp.ttf";break;case"g":b="HennyPenny";d="themes/fonts/HennyPenny/HennyPenny-Regular.otf";break;case"h":b="Kavoon";d="themes/fonts/Anglican/AnglicanText.ttf";break;case"i":b="Nosifer";d="themes/fonts/Nosifer/NosiferCaps-Regular.ttf";break;case"j":b="Pacifico";d="themes/fonts/Pacifico/Pacifico.ttf";break;case"k":b="Sixties";d="themes/fonts/Sixties/Sixties.ttf";break;case"l":b="Crackman";d="themes/fonts/Crackman/CRACKMAN.ttf";break}setFont=function(e){$("body, input, select, textarea, button, .ui-btn").css("font-family",e)};if($.inArray(c,loadedFont)===-1){var a=new Font();a.onload=function(){setFont(b)};a.fontFamily=b;a.src=d}else{setFont(b)}loadedFont.push(c);font=c}function processVariable(d,h,a){var k=unescape(d.value);var g=d.valueType;var j=d.valueUnit;var l=getTimeDiffString(d.date,a);var b=unescape(d.info);var e=checkOperate(d.operate);var c=getPicKey(h,"variables",d,false);var f="<li class='dataListItem' id='"+h+"' "+(d.visible?"":"style='display: none;'")+"><h2 class='ui-li-heading'>"+unescape(d.name)+"</h2>";f+="<p class='description' "+(resultOptionsMap.show_description?"":"style='display: none;'")+">"+b+"</p>";if($.inArray(c,picturesList)!==-1){f+="<div style='float: left; text-align: center; padding-right: 10px;'>";f+="<img id='img"+c+"' class='ui-div-thumbnail ui-img-"+theme+" lazyLoadImage' data-original='../webmatic_user/img/ids/variables/"+c+".png' src='img/menu/variables.png'/>";f+="</div>"}if(!e){f+=addReadonlyVariable(h,k,l,g,j,d.valueList,d.valueName0,d.valueName1)}else{if(g==="2"){f+=addSetBoolButtonList("",h,k,d.valueName0,d.valueName1,j,l,true,e)}else{if(g==="4"){f+=addSetNumber("",h,k,j,d.valueMin,d.valueMax,d.step?d.step:1,d.faktor?d.faktor:1,l,true,e)}else{if(g==="16"){f+=addSetValueList("",h,k,d.valueList,j,l,true,e)}else{if(g==="20"&&j.toUpperCase()==="HTML"){f+=addHTML("",h,k,l,false)}else{if(g==="20"&&j.toUpperCase()==="HISTORIAN"){f+=addHistorianDiagram("",h,k,l,false)}else{if(g==="20"&&j.toUpperCase()==="TUNEIN"){f+=addTuneInRadio("",h,k,l,false)}else{if(g==="20"){f+=addSetText("",h,k,j,l,e)}else{f+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}}}f+="</li>";return f}function processProgram(e,c,b,d,f){var a="<li class='dataListItem' id='"+c+"' "+(f?"":"style='display: none;'")+">";a+="<h2 class='ui-li-heading'>"+e.name+"</h2>";a+="<p class='description' "+(resultOptionsMap.show_description?"":"style='display: none;'")+">"+e.info+(!d?" ("+mapText("MANUAL")+")":"")+"</p>";if($.inArray(c,picturesList)!==-1){a+="<div style='float: left; text-align: center; padding-right: 10px;'>";a+="<img id='img"+c+"' class='ui-div-thumbnail ui-img-"+theme+" lazyLoadImage' data-original='../webmatic_user/img/ids/programs/"+c+".png' src='img/menu/programs.png'/>";a+="</div>"}a+=addStartProgramButton("",c,mapText("RUN"),getTimeDiffString(e.date,b),(e.operate||!readModus));a+="</li>";return a}function getErrorMessage(c,d,f,b){var a="";if(c==="ALARMDP"){var e;if(d==="CONFIG_PENDING"||d==="STICKY_UNREACH"){e="Info"}else{if(d==="LOWBAT"){e="Warning"}else{e="Error"}}return"<span class='value"+e+" value"+e+"-"+theme+"'>"+mapText(c+"__"+d)+"</span>"}else{if(c==="HSSDP"){a=mapText(b+"__"+d+"__"+f);if(a!==""&&a!=="-"){return"<span class='valueError valueError-"+theme+"'>"+a+"</span>"}}}if(a===""){a="<span class='valueError valueError-"+theme+"'>"+mapText("UNKNOWN_ERROR")+": "+f+"</span>"}return a}function addDiagram(z){if(z.addDiagram){$("#"+dataList).listview("refresh");var B="l";var Z="69A5CF";var O="";var q="";var x=1;var S="0/#008800";var b="30/#AA4400";for(var X=0;X<z.varOptions.length;X++){var J=z.varOptions[X].split("=");if(J.length===2){if(J[0]==="t"){B=J[1]}else{if(J[0]==="c"){Z=J[1]}else{if(J[0]==="l"){O=J[1]}else{if(J[0]==="h"){q=J[1]}else{if(J[0]==="k"){x=parseInt(J[1])}else{if(J[0]==="s"){S=J[1]}else{if(J[0]==="e"){b=J[1]}}}}}}}}}if(z.varOptionsFirst==="g"){var m=parseFloat(z.diagramData);var R=S.split("/");var H=parseFloat(R[0]);var p=R[1];if(m<H){H=m}var g=b.split("/");var d=parseFloat(g[0]);var F=g[1];if(m>d){d=m}var a=parseInt(p.substring(1,3),16);var w=parseInt(p.substring(3,5),16);var Q=parseInt(p.substring(5,7),16);var T=parseInt(F.substring(1,3),16);var s=parseInt(F.substring(3,5),16);var o=parseInt(F.substring(5,7),16);var C=[];var U=[];var P=10;for(var X=1;X<=P;X++){var aa=X/P;var L=H+aa*(d-H);C.push(L);aa=(X-1)/(P-1);var A=Math.floor(a+aa*(T-a)).toString(16);if(A.length<2){A="0"+A}var E=Math.floor(w+aa*(s-w)).toString(16);if(E.length<2){E="0"+E}var I=Math.floor(Q+aa*(o-Q)).toString(16);if(I.length<2){I="0"+I}var ab="#"+A+E+I;U.push(ab)}var G=[z.diagramData];$.jqplot(z.diagramID,[G],{seriesDefaults:{renderer:$.jqplot.MeterGaugeRenderer,rendererOptions:{label:z.diagramData+" "+z.diagramUnit,labelPosition:"bottom",labelHeightAdjust:-5,min:H,max:d,intervals:C,intervalColors:U,smooth:true,animation:{show:true}}},grid:{backgroundColor:"transparent"}})}else{if(z.varOptionsFirst==="h"){var u=z.diagramData.split(";");var l=u[0];if(l>0){var n=new Array();n[0]=new Array();n[1]=new Array();n[2]=new Array();n[3]=new Array();n[4]=new Array();var W=0;var y;if(O===""){y=15}else{y=parseFloat(O)}var k;if(q===""){k=23}else{k=parseFloat(q)}var M="";var V="";for(var X=1;X<=l;X++){var N=u[X];var K=N.split(",");var ad=K[0];if(M===""||ad<M){M=ad}if(V===""||ad>V){V=ad}for(W=1;W<K.length;W++){var D=new Array();D[0]=ad;var ac=K[W];D[1]=ac;n[W-1][X-1]=D}}}$.jqplot(z.diagramID,[n[0],n[1],n[2],n[3],n[4]],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%a, %#d %#H:%M",angle:20},min:M,max:V},yaxis:{min:y,max:k,showLabel:true,tickOptions:{formatString:"%."+x+"f&deg;C"}},y2axis:{min:0,max:100,showLabel:true,tickOptions:{formatString:"%d%"}}},legend:{show:false,fontSize:23,placement:"outside",location:"e"},seriesDefaults:{lineWidth:2,showMarker:false,fill:false,shadow:false},series:[{label:"Soll",color:"#555555",fill:true,fillAlpha:0.1},{label:"Ist",color:"#DD0000"},{label:"relF%",color:"#0174DF",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis"}],highlighter:{show:true,sizeAdjust:5.5},cursor:{zoom:true,show:true},grid:{backgroundColor:"#F4F4F4"},animated:true})}else{if(B==="l"||B==="f"){u=z.diagramData.split(",");l=u.length;if(l>=3){n=new Array();W=0;y=1000000;k=-1000000;M="";V="";for(var X=1;X<l;X=X+2){ad=u[X];ac=u[X+1];var h=new Array();h[0]=ad;L;if(ac==="true"){L=1}else{if(ac==="false"){L=0}else{L=parseFloat(ac)}}h[1]=L;if(L<y){y=L}if(L>k){k=L}if(M===""||ad<M){M=ad}if(V===""||ad>V){V=ad}n[W]=h;W++}if(O===""){y=y-0.1*(k-y)}else{if(O==="m"){}else{var r=parseFloat(O);if(r<y){y=r}}}if(q===""){k=k+0.1*(k-y)}else{if(q==="m"){}else{var Y=parseFloat(q);if(Y>k){k=Y}}}var e;if(B==="l"){e=false}else{e=true}$.jqplot(z.diagramID,[n],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%b %#d, %#H:%M",angle:20},min:M,max:V},yaxis:{min:y,max:k,tickOptions:{formatString:"%."+x+"f"+z.diagramUnit}}},seriesDefaults:{rendererOptions:{smooth:true}},series:[{color:"#"+Z,lineWidth:2,showMarker:false,fill:e}],highlighter:{show:true,sizeAdjust:5.5},cursor:{show:false},grid:{backgroundColor:"#F4F4F4"},animated:true})}}}}}}function addChannel(c,a,o,h){var d=c.hssType;var m=c.id;var g=false;var n=[];n.deviceHTMLPostChannelGroup="";n.deviceHTMLPostChannelGroupMode=0;var l="";$.each(c.channels,function(J,V){g=true;var t=V.type;if(t==="HSSDP"){var N=V.id;var u=V.hssType;var I=V.date;var R=getTimeDiffString(I,a);var F=V.value;var r=parseFloat(V.value);var q=(F==="true");var s=mapUnit(V.valueUnit,u);var A=parseFloat(V.valueMin);var C=parseFloat(V.valueMax);if(u==="SETPOINT"||u==="SET_TEMPERATURE"){l+=addSetNumber(m,N,r,s,6,30,0.5,1,R,false,h);var G=r-3;var p=G+6;if(G<A){G=A;p=11}if(p>C){G=25;p=C}l+="<div data-role='controlgroup' data-type='horizontal'>";if(u==="SETPOINT"){l+=addSetButton(m,N,mapText(d+"__"+u+"__VENT_CLOSED"),0,R,true,0===r,false,h)}for(i=G;i<=p;i+=1){l+=addSetButton(m,N,i+s,i,R,true,i===r,false,h)}if(u==="SETPOINT"){l+=addSetButton(m,N,mapText(d+"__"+u+"__VENT_OPEN"),100,R,true,100===r,false,h)}l+="</div>"}else{if(d==="CLIMATECONTROL_RT_TRANSCEIVER"&&(u.endsWith("MODE")||u.startsWith("PARTY"))){if(u==="CONTROL_MODE"){n.deviceHTMLPostChannelGroupMode=r}else{if(u==="AUTO_MODE"){n.deviceHTMLPostChannelGroup+=addSetButton(m,N,mapText(d+"__"+u),true,R,true,n.deviceHTMLPostChannelGroupMode===0,true,h)}else{if(u==="MANU_MODE"){n.deviceHTMLPostChannelGroup+=addSetButton(m,N,mapText(d+"__"+u),true,R,true,n.deviceHTMLPostChannelGroupMode===1,true,h)}else{if(u==="BOOST_MODE"){n.deviceHTMLPostChannelGroup+=addSetButton(m,N,mapText(d+"__"+u),true,R,true,n.deviceHTMLPostChannelGroupMode===3,true,h)}else{if(u==="LOWERING_MODE"||u==="COMFORT_MODE"){n.deviceHTMLPostChannelGroup+=addSetButton(m,N,mapText(d+"__"+u),true,R,true,false,true,h)}else{if(u==="PARTY_TEMPERATURE"){n.PARTY_TEMPERATURE=r}else{if(u==="PARTY_START_TIME"){n.PARTY_START_TIME=parseInt(F)}else{if(u==="PARTY_START_DAY"){n.PARTY_START_DAY=parseInt(F)}else{if(u==="PARTY_START_MONTH"){n.PARTY_START_MONTH=parseInt(F)}else{if(u==="PARTY_START_YEAR"){n.PARTY_START_YEAR=parseInt(F)}else{if(u==="PARTY_STOP_TIME"){n.PARTY_STOP_TIME=parseInt(F)}else{if(u==="PARTY_STOP_DAY"){n.PARTY_STOP_DAY=parseInt(F)}else{if(u==="PARTY_STOP_MONTH"){n.PARTY_STOP_MONTH=parseInt(F)}else{if(u==="PARTY_STOP_YEAR"){n.PARTY_STOP_YEAR=parseInt(F)}else{if(u==="PARTY_MODE_SUBMIT"){n.PARTY_MODE_ID=N;n.VORDATE=R}}}}}}}}}}}}}}}}else{if(u==="PROGRAM"&&d==="RGBW_AUTOMATIC"){l+="<div data-role='controlgroup' data-type='horizontal'>";l+=addSetButton(m,N,mapText(d+"__"+u+"__0"),0,R,true,r===0,true,h);l+=addSetButton(m,N,mapText(d+"__"+u+"__1"),1,R,true,r===1,true,h);l+=addSetButton(m,N,mapText(d+"__"+u+"__2"),2,R,true,r===2,true,h);l+=addSetButton(m,N,mapText(d+"__"+u+"__3"),3,R,true,r===3,true,h);l+=addSetButton(m,N,mapText(d+"__"+u+"__4"),4,R,true,r===4,true,h);l+=addSetButton(m,N,mapText(d+"__"+u+"__5"),5,R,true,r===5,true,h);l+=addSetButton(m,N,mapText(d+"__"+u+"__6"),6,R,true,r===6,true,h);l+="</div>"}else{if(u==="COLOR"&&d==="RGBW_COLOR"){l+="<span class='RGBW-Color'>";l+=addSetNumber(m,N,r,s,0,200,1,1,R,true,h);l+="</span>"}else{if(u==="LED_STATUS"&&d==="KEY"){switch(r){case 0:l+="<p><img class='ui-img-"+theme+"' src='img/channels/off_lamp.png' style='max-height:40px'> "+mapText(d+"__"+u+"__0")+" <span><i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+R+"</i></span></p>";break;case 1:l+="<p><img class='ui-img-"+theme+"' src='img/channels/red_lamp.png' style='max-height:40px'> "+mapText(d+"__"+u+"__1")+" <span><i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+R+"</i></span></p>";break;case 2:l+="<p><img class='ui-img-"+theme+"' src='img/channels/green_lamp.png' style='max-height:40px'> "+mapText(d+"__"+u+"__2")+" <span><i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+R+"</i></span></p>";break;case 3:l+="<p><img class='ui-img-"+theme+"' src='img/channels/orange_lamp.png' style='max-height:40px'> "+mapText(d+"__"+u+"__3")+" <span><i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+R+"</i></span></p>";break}}else{if(u==="LEVEL"&&d==="BLIND"){l+=addSetNumber(m,N,r,s,0,1,0.01,100,R+" | 0<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("CLOSE")+", 100<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("OPEN"),false,h);l+=addSetControlGroup(m,N,mapText("CLOSE_SHORT"),mapText("OPEN_SHORT"),R,r,h)}else{if(u==="LEVEL"&&d==="WINMATIC"){l+=addSetNumber(m,N,r,s,-0.005,1,0.01,100,R+" | -0.5<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("LOCKED")+", 0<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("CLOSE")+", 100<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("OPEN"),false,h);l+=addSetControlGroup(m,N,mapText("CLOSE_SHORT"),mapText("OPEN_SHORT"),R,r,h,addSetButton(m,N,mapText("LOCK"),-0.005,R,true,r===-0.005,false,h))}else{if(u==="LEVEL"&&(d==="DIMMER"||d==="VIRTUAL_DIMMER")){l+=addSetNumber(m,N,r,s,0,1,0.01,100,R+" | 0<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("OFF")+", 100<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("ON"),false,h);l+=addSetControlGroup(m,N,mapText("OFF"),mapText("ON"),R,r,h)}else{if(u==="FREQUENCY"&&d==="DIGITAL_ANALOG_OUTPUT"){l+=addSetNumber(m,N,r,s,0,50000,100,1,R+" | 0<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("MAX")+", 50000<span id='unit_ "+b+"'>"+s+"</span> = "+mapText("MIN"),false,h);l+="<div data-role='controlgroup' data-type='horizontal'>";l+=addSetButton(m,N,mapText("MAX"),0,R,true,r===0,true,h);l+=addSetButton(m,N,mapText("MED"),30000,R,true,r===30000,true,h);l+=addSetButton(m,N,mapText("MIN"),50000,R,true,r===50000,true,h);l+="</div>"}else{if(u==="SUBMIT"&&(d==="SIGNAL_LED"||d==="SIGNAL_CHIME")){}else{if(u==="ON_TIME"||u==="RAMP_TIME"){l+="<div class='ui-field-contain ui-grid-c'>";l+="<div class='ui-block-a'>";l+="<input type='text' data-role='datebox' data-theme='"+theme+"' data-duration-parent='"+m+"' data-id='"+N+'\' data-options=\'{"mode":"durationbox"}\'/>&nbsp;';l+="</div>";l+="<div class='ui-block-b grid-text'>";l+=mapText(d+"__"+u);l+="</div>";l+="</div>"}else{var E=mapInput(d,V,R,m,h);if(E!==""){l+=E}else{var H=mapState(u,d,r,q);if(H!=="Hide"){var M="";var U="&nbsp;";var L=1;if(H!==""){M="<span class='value"+H+" value"+H+"-"+theme+"'>"+mapText(d+"__"+u+"__"+F)+"&nbsp;<span id='unit_ "+b+"'>"+s+"</span></span>"}else{if(u==="VALUE"){M=F+" <span id='unit_ "+b+"'>"+s+"</span>"}else{if((u==="LEVEL"&&d==="AKKU")||(u==="BAT_LEVEL"&&d==="POWER")){L=100}U=mapText(d+"__"+u);var B=F;if(!isNaN(F)||L!==1){B=r*L}M=B+" <span id='unit_ "+b+"'>"+s+"</span>"}}if(U!=="-"){l+="<p class='ui-li-desc'>";l+="<img class='ui-img-"+theme+"' src='img/channels/"+mapImage(u)+"' style='max-height:20px'>";l+="<span class='valueInfo valueInfo-"+theme+"'>"+M+" </span>&nbsp;"+U+"&nbsp;";l+="<span><i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+R+"</i></span>";l+="</p>"}}}}}}}}}}}}}}}else{if(t==="VARDP"){var w=V.id;var y=unescape(V.info);var O=unescape(V.value);var K=V.valueType;s=V.valueUnit;var S=V.valueName0;var Q=V.valueName1;var x=V.valueList;I=V.date;R=getTimeDiffString(I,a);var D=getPicKey(w,"variables",V,false);o.varOptionsFirst="";o.varOptions=[];var z=y.indexOf("(");if(z!==-1){var T=y.indexOf(")",z);if(T!==-1){var P=y.substring(z+1,T);o.varOptions=P.split(",");if(o.varOptions.length>=1){o.varOptionsFirst=o.varOptions[0].toLowerCase()}}}if(o.varOptionsFirst!=="nv"){l+="<br><h2 class='ui-li-heading'>"+unescape(V.name)+"</h2>";l+="<p class='description' "+(resultOptionsMap.show_description?"":"style='display: none;'")+">"+y+"</p>";if($.inArray(D,picturesList)!==-1){l+="<div style='float: left; text-align: center; padding-right: 10px;'>";l+="<img id='img"+D+"' class='ui-div-thumbnail ui-img-"+theme+" lazyLoadImage' data-original='../webmatic_user/img/ids/variables/"+D+".png' src='img/menu/variables.png'/>";l+="</div>"}if(isReadOnly(y)){l+=addReadonlyVariable(w,O,R,K,s,x,S,Q)}else{if(o.varOptionsFirst==="d"||o.varOptionsFirst==="dk"||o.varOptionsFirst==="g"||o.varOptionsFirst==="h"){excludeFromRefresh.push(w);o.addDiagram=true;if(o.varOptionsFirst==="dk"){o.diagramData=V.diagrams}else{o.diagramData=O}o.diagramID="chart_"+w;o.diagramUnit=s;if(o.varOptionsFirst==="g"){l+="<div id='"+o.diagramID+"' style='height:200px; width:300px;'></div> <i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+R+"</i>"}else{l+="<div id='"+o.diagramID+"' style='height:300px; width:90%;'></div> <i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+R+"</i>"}}else{if(K==="2"){l+=addSetBoolButtonList(m,w,O,S,Q,s,R,true,h)}else{if(K==="4"){l+=addSetNumber(m,w,O,s,A,C,0.001,1,R,true,h)}else{if(K==="16"){l+=addSetValueList(m,w,O,x,s,R,true,h)}else{if(K==="20"&&s.toUpperCase()==="HTML"){l+=addHTML(m,w,O,R,false)}else{if(K==="20"&&s.toUpperCase()==="HISTORIAN"){l+=addHistorianDiagram(m,w,O,R,false)}else{if(K==="20"&&s.toUpperCase()==="TUNEIN"){l+=addTuneInRadio(m,w,O,R,false)}else{if(K==="20"){l+=addSetText(m,w,O,s,R,h)}else{l+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}}}}}}}});if(n.deviceHTMLPostChannelGroup!==""){l+="<div data-role='controlgroup' data-type='horizontal'>";l+=n.deviceHTMLPostChannelGroup;l+="</div>";var b=n.PARTY_MODUS_ID;var f=[n.PARTY_START_YEAR+2000,n.PARTY_START_MONTH-1,n.PARTY_START_DAY];var e=n.PARTY_START_TIME*60;var k=[n.PARTY_STOP_YEAR+2000,n.PARTY_STOP_MONTH-1,n.PARTY_STOP_DAY];var j=n.PARTY_STOP_TIME*60;l+="<div class='ui-field-contain ui-grid-c control-set control-set-"+theme+"'>";l+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_TEMPERATURE")+"</div>";l+="<div class='ui-block-b'><input type='range' data-parent-id='"+m+"' value='"+n.PARTY_TEMPERATURE+"' min='5.0' max='30.0' step='0.5' data-factor='1' id='setTemperature_"+b+"' data-highlight='true' data-theme='"+theme+"'/></div>";l+="<div class='ui-block-c'></div>";l+="<div class='ui-block-d'></div>";l+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_START")+"</div>";l+="<div class='ui-block-b'><input type='text' data-parent-id='"+m+"' data-datebox-default-value='"+f+"' id='setStartDate_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='calbox' data-datebox-use-lang='de'/></div>";l+="<div class='ui-block-c'><input type='text' data-parent-id='"+m+"' data-datebox-default-value='"+e+"' id='setStartTime_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='timebox' data-datebox-minute-step='30' data-datebox-use-lang='de'/></div>";l+="<div class='ui-block-d'></div>";l+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_STOP")+"</div>";l+="<div class='ui-block-b'><input type='text' data-parent-id='"+m+"' data-datebox-default-value='"+k+"' id='setEndDate_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='calbox' data-datebox-use-lang='de'/></div>";l+="<div class='ui-block-c'><input type='text' data-parent-id='"+m+"' data-datebox-default-value='"+j+"' id='setEndTime_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='timebox' data-datebox-minute-step='30' data-datebox-use-lang='de'/></div>";l+="<div class='ui-block-d'></div>";l+="<div class='ui-block-a'>"+addSetButton(m,b,mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_MODE"),"",n.VORDATE,true,n.deviceHTMLPostChannelGroupMode===2,true,h,"CLIMATECONTROL_RT_TRANSCEIVER")+"</div>";l+="</div>"}else{if(!g){l=""}}return l}function processDevices(p,d,b,s){var r="<li class='dataListItem' id='"+p.id+"'><h2 class='ui-li-heading'>"+unescape(p.name)+"</h2>";if(p.type==="CHANNEL"){r+=addChannel(p,d,b,s)}else{if(p.type==="VARDP"){s=true;var c=p.id;var g=unescape(p.info);var t=unescape(p.value);var q=p.valueType;var a=p.valueUnit;var x=p.valueName0;var w=p.valueName1;var j=p.valueMin;var m=p.valueMax;var f=p.valueList;var o=p.date;var v=getTimeDiffString(o,d);var n=getPicKey(c,"variables",p,false);b.varOptionsFirst="";b.varOptions=[];var h=g.indexOf("(");if(h!==-1){var y=g.indexOf(")",h);if(y!==-1){var u=g.substring(h+1,y);b.varOptions=u.split(",");if(b.varOptions.length>=1){b.varOptionsFirst=b.varOptions[0].toLowerCase()}}}r+="<p class='description' "+(resultOptionsMap.show_description?"":"style='display: none;'")+">"+g+"</p>";if($.inArray(n,picturesList)!==-1){r+="<div style='float: left; text-align: center; padding-right: 10px;'>";r+="<img id='img"+n+"' class='ui-div-thumbnail ui-img-"+theme+" lazyLoadImage' data-original='../webmatic_user/img/ids/variables/"+n+".png' src='img/menu/variables.png'/>";r+="</div>"}if(isReadOnly(g)){r+=addReadonlyVariable(c,t,v,q,a,f,x,w)}else{if(b.varOptionsFirst==="d"||b.varOptionsFirst==="dk"||b.varOptionsFirst==="g"||b.varOptionsFirst==="h"){excludeFromRefresh.push(c.toString());b.addDiagram=true;if(b.varOptionsFirst==="dk"){b.diagramData=p.diagrams}else{b.diagramData=t}b.diagramID="chart_"+c;b.diagramUnit=a;if(b.varOptionsFirst==="g"){r+="<div id='"+b.diagramID+"' style='height:200px; width:300px;'></div> <i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+v+"</i>"}else{r+="<div id='"+b.diagramID+"' style='height:300px; width:90%;'></div> <i class='last-used-time ui-li-desc' "+(resultOptionsMap.show_lastUsedTime?"":"style='display: none;'")+">"+v+"</i>"}}else{if(b.varOptionsFirst==="nv"){r=""}else{if(q==="2"){r+=addSetBoolButtonList("",c,t,x,w,a,v,true,s)}else{if(q==="4"){r+=addSetNumber("",c,t,a,j,m,0.001,1,v,true,s)}else{if(q==="16"){r+=addSetValueList("",c,t,f,a,v,true,s)}else{if(q==="20"&&a.toUpperCase()==="HTML"){r+=addHTML("",c,t,v,false)}else{if(q==="20"&&a.toUpperCase()==="HISTORIAN"){r+=addHistorianDiagram("",c,t,v,false)}else{if(q==="20"&&a.toUpperCase()==="TUNEIN"){r+=addTuneInRadio("",c,t,v,false)}else{if(q==="20"){r+=addSetText("",c,t,a,v,s)}else{r+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}}}}}}else{if(p.type==="PROGRAM"){var l=p.id;var e=p.info;var k=p.date;v=getTimeDiffString(k,d);s=true;r+="<p class='description' "+(resultOptionsMap.show_description?"":"style='display: none;'")+">"+e+"</p>";r+=addStartProgramButton("",l,mapText("RUN"),v,s)}}}if(r!==""){r+="</li>"}return r}function activateSettingSaveButton(){$('[name="saveAllChanges"]').removeClass("ui-state-disabled");mustBeSaved=true}function loadRecognization(){$.ajax({type:"GET",url:"cgi/recognizer.cgi",dataType:"json",async:false}).done(function(a){if(a.REMOTE_ADDR.match("^192.168.")||a.REMOTE_ADDR.match("^10.")||a.REMOTE_ADDR.match("^172.(1[6-9]|2[0-9]|3[0-1]).")){recognizeMap=a;client=a.REMOTE_ADDR;localStorage.setItem("webmaticrecognizeMap",JSON.stringify(recognizeMap))}else{recognizeMap={};client=""}}).fail(function(){recognizeMap={};client=""})}function loadConfigData(d,a,c,e,b,g,f){$.ajax({type:"GET",url:a,dataType:"json",async:d}).done(function(j){var h;switch(c){case"config":if(!d){saveDataToFile=true;h=saveConfigFile(c,j,b,e,true)}else{h=j;optionsMap=j;localStorage.setItem(e,JSON.stringify(j))}break;case"variables":h=saveConfigFile(c,j,b,e,g);break;case"programs":h=saveConfigFile(c,j,b,e,g);break;case"favorites":h=saveConfigFile(c,j,b,e,g);break;case"rooms":h=saveConfigFile(c,j,b,e,g);break;case"functions":h=saveConfigFile(c,j,b,e,g);break;case"devices":h=j;devicesMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"configClient":optionsClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"programsClient":programsClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"favoritesClient":favoritesClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"roomsClient":roomsClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"functionsClient":functionsClientMap=j;localStorage.setItem(e,JSON.stringify(j));break;case"variablesClient":variablesClientMap=j;localStorage.setItem(e,JSON.stringify(j));break}if(typeof f==="function"){f(h)}}).fail(function(h,j){if(h.status===404){createConfigFile(c,e)}else{log("Request failed: "+j,2)}})}function saveConfigFile(e,d,c,f,g){if(g){saveDataToFile=true;var a={};if(e==="rooms"||e==="favorites"||e==="functions"){var b=0;$.each(d,function(h,l){if(h==="size"){return}b++;var k={};var j=l;if(l.startsWith("${")){l=mapText(l.substring(l.indexOf("${"),l.indexOf("}")))}k.name=l;k.oldname=j;k.visible=true;k.position=b;a[h]=k});a.size=b}else{if(e==="programs"){var b=0;$.each(d,function(h,k){if(h==="date"||h==="size"){a[h]=k;return}b++;var j={};j.name=k.name;j.oldname=k.name;j.visible=k.visible;j.oldvisible=k.visible;j.position=b;j.active=k.active;j.operate=k.operate;j.oldoperate=k.operate;j.date=k.date;j.info=k.info;a[h]=j});a.size=b}else{if(e==="variables"){var b=0;$.each(d,function(j,l){if(j==="date"||j==="size"){a[j]=l;return}b++;var k={};k.name=l.name;k.oldname=l.name;k.visible=l.visible;k.oldvisible=l.visible;k.position=b;k.value=l.value;k.active=l.active;var h=l.info;k.operate=isReadOnlyVariable(h);k.oldoperate=k.operate;k.date=l.date;k.info=h;var m=l.valueType;k.valueType=m;k.valueUnit=l.valueUnit;if(m==="16"){k.valueList=l.valueList;k.listType="auto"}else{if(m==="2"){k.valueName0=l.valueName0;k.valueName1=l.valueName1}else{if(m==="4"){k.valueMin=l.valueMin;k.valueMax=l.valueMax;k.step=1;k.faktor=1}}}a[j]=k});a.size=b}else{a=d}}}a=refreshJSONObj(e,a,c);localStorage.setItem(f,JSON.stringify(a));if(saveDataToFile){saveDataToFile=false;$.post("cgi/saveconfig.cgi",{name:e,text:JSON.stringify(a)})}return a}else{setMap(e,d);return d}}function refreshJSONObj(f,e,d){var a=getMap(f);if(f==="rooms"||f==="favorites"||f==="functions"){if(!d){var b={};var c=e.size;$.each(e,function(g,j){if(g==="date"||g==="size"){b[g]=j;return}if(g in a){var h=a[g];j.visible=h.visible;j.position=h.position;if(j.oldname===h.oldname){j.name=h.name}else{saveDataToFile=true}}else{c++;j.position=c;saveDataToFile=true}b[g]=j});b.size=c;e=b}}else{if(f==="programs"){if(!d){var b={};var c=e.size;$.each(e,function(g,j){if(g==="date"||g==="size"){b[g]=j;return}if(g in a){var h=a[g];j.position=h.position;if(j.oldname===h.oldname){j.name=h.name}else{saveDataToFile=true}if(j.oldvisible===h.oldvisible){j.visible=h.visible}else{saveDataToFile=true}if(j.oldoperate===h.oldoperate){j.operate=h.operate}else{saveDataToFile=true}}else{c++;j.position=c;saveDataToFile=true}b[g]=j});b.size=c;e=b}}else{if(f==="variables"){if(!d){var b={};var c=e.size;$.each(e,function(g,j){if(g==="date"||g==="size"){b[g]=j;return}var k=j.valueType;if(g in a){var h=a[g];j.position=h.position;if(j.oldname===h.oldname){j.name=h.name}else{saveDataToFile=true}if(j.oldvisible===h.oldvisible){j.visible=h.visible}else{saveDataToFile=true}if(j.oldoperate===h.oldoperate){j.operate=h.operate}else{saveDataToFile=true}if(k==="16"){if("listType" in h){j.listType=h.listType}else{j.listType="auto";saveDataToFile=true}}else{if(k==="4"){if("step" in h){j.step=h.step}else{j.step=1;saveDataToFile=true}if("faktor" in h){j.faktor=h.faktor}else{j.faktor=1;saveDataToFile=true}}}}else{c++;j.position=c;saveDataToFile=true}b[g]=j});b.size=c;e=b}}else{if(f==="config"&&!d){e.storageVersion=storageVersion;if(!("ccu_historian" in e)){e.ccu_historian=""}if(!("default_menugfxsize" in e)){e.default_menugfxsize="large"}if(!("no_more_settings" in e)){e.no_more_settings=0}if(!("new_version" in e)){e.new_version="stable"}if(!("dont_leave" in e)){e.dont_leave=false}if(!("clientsList" in e)){e.clientsList=!isTempClient?clientsList:new Object()}if(!("default_sort_manually" in e)){e.default_sort_manually=true}clientsList=e.clientsList;if(client!==""&&!isTempClient&&!(client in clientsList)){clientsList[client]=client;e.clientsList=clientsList}if(!("two_sites" in e)){e.two_sites=false}if(!("transition" in e)){e.transition="flip"}if(!("columns" in e)){e.columns=1}if(!("show_description" in e)){e.show_description=true}if(!("show_lastUsedTime" in e)){e.show_lastUsedTime=true}}}}}setMap(f,e);return e}function createConfigFile(a,b){saveDataToFile=true;if(a==="config"){var c="{";c+='"storageVersion" : '+storageVersion+",";c+='"favorites" : true,';c+='"rooms" : true,';c+='"functions" : true,';c+='"variables" : true,';c+='"programs" : true,';c+='"others" : true,';c+='"collapsed" : "rooms",';c+='"systemvar_readonly" : true,';c+='"default_theme" : "wma",';c+='"default_font" : "a",';c+='"ccu_historian" : "",';c+='"default_menugfxsize" : "large",';c+='"no_more_settings" : 0,';c+='"new_version" : "stable",';c+='"dont_leave" : false,';c+='"clientsList" : {'+(client!==""&&!isTempClient?'"'+client+'":"'+client+'"':"")+"},";c+='"default_sort_manually" : true,';c+='"two_sites" : false,';c+='"transition" : "flip",';c+='"columns" : 1,';c+='"show_description" : true,';c+='"show_lastUsedTime" : true';c+="}";optionsMap=saveConfigFile(a,JSON.parse(c),true,b,true)}else{if(a.endsWith("Client")){var c="{}";a=a.slice(0,-6);if(client!==""){switch(a){case"config":optionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"variables":variablesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"programs":programsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"favorites":favoritesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"rooms":roomsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"functions":functionsClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break;case"devices":devicesClientMap=saveConfigFile(a+client,JSON.parse(c),true,b,true);break}}}else{loadConfigData(false,"cgi/"+a+".cgi",a,b,true,true)}}}function buttonEvents(a,c){var e=a.data("id");var j="?id="+e;var h="info_"+e;var g=a.data("value");if(typeof g==="undefined"){var b="setValue_"+e;g=$("#"+b).val();var d=$("#"+b).data("factor");if(typeof d!=="undefined"){j+="&value="+(parseFloat(g)/d)}else{j+="&value="+g}}else{j+="&value="+g}var f=0;var k=$("[data-duration-parent='"+a.data("parent-id")+"']");k.each(function(l){var m=$(this).datebox("getLastDur");if(!isNaN(m)){f=m>f?m:f;j+="&durationId"+l+"="+k.data("id")+"&durationValue"+l+"="+m}});if(testSite){j+="&debug=true"}$("#"+h).text(mapText("TRANSFER"));$.get("cgi/set.cgi"+j,function(){if(c){$("#"+h).text(mapText("TRANSFER_OK"));refreshPage(0)}else{$("#"+h).text(mapText("DELAY"))}if(f>0){setTimeout(function(){refreshPage(0)},(f+3)*1000)}})}function reloadList(a,c,b,d){$("#"+dataListHeader).empty();$("#"+dataListHeader).append("<li data-role='list-divider' role='heading'>"+a+"<p style='float:right;'>"+c+"</p></li>");if(d!==""){$("#"+dataListHeader).append("<li class='description'>"+d+"</li>")}$("#"+dataListHeader).listview("refresh");$("#"+dataList).listview("refresh");if(b){$("#"+dataList).fadeIn()}$("#"+dataList).enhanceWithin().trigger("fertig")}function loadData(b,e,a){$(".buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var d=false;if(a){$("#"+dataList).empty();$("#"+dataListHeader).empty();$("#"+dataListHeader).append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticdevicesMap"+e)===null||localStorage.getItem("webmaticdevicesMap"+e)==="undefined"){if(newVersion){saveDataToFile=true}loadConfigData(false,b+"?list="+e,"devices","webmaticdevicesMap"+e,false,true);d=true}else{loadLocalStorageMap("devices",e)}var c=devicesMap.date;$.each(devicesMap.entries,function(h,j){var f=new Object();f.addDiagram=false;f.diagramData="";f.diagramID="";f.diagramUnit="";f.varOptions={};f.varOptionsFirst="";if(j.visible!=="false"){var g=processDevices(j,c,f,j.operate!=="false");if(g!==""){$("#"+dataList).append(g)}}addDiagram(f)});if(isGetSite){document.title=devicesMap.name}reloadList(devicesMap.name,c,a,devicesMap.description)}if(!d){loadConfigData(true,b+"?list="+e,"devices","webmaticdevicesMap"+e,false,true,function(h){var f=h.date;var g=h.visible!=="false";$.each(h.entries,function(m,n){var k=new Object();k.addDiagram=false;k.diagramData="";k.diagramID="";k.diagramUnit="";k.varOptions={};k.varOptionsFirst="";var l="";if(n.visible!=="false"){l=processDevices(n,f,k,n.operate!=="false");if(l!==""){var j=n.id;if($("#"+j).length===0&&g){$("#"+dataList).append(l)}else{if(g){if($.inArray(j.toString(),excludeFromRefresh)===-1){$("#"+j).replaceWith(l)}}else{if($("#"+j).length!==0){$("#"+j).remove()}}}}addDiagram(k)}});reloadList(h.name,f,a,h.description);$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly")})}$(".buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change");$("[id^=button]").enhanceWithin();$("[id^=input]").enhanceWithin();$("textarea").textinput("refresh");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly")}function loadVariables(c){$(".buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");if(c){$("#"+dataList).empty();$("#"+dataListHeader).empty();$("#"+dataListHeader).append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticvariablesMap")===null||localStorage.getItem("webmaticvariablesMap")==="undefined"){if(newVersion){saveDataToFile=true}loadConfigData(false,"../webmatic_user/variables.json","variables","webmaticvariablesMap",false,false)}else{loadLocalStorageMap("variables")}if(localStorage.getItem("webmaticvariablesclientMap")===null||localStorage.getItem("webmaticvariablesclientMap")==="undefined"){if(client!==""){loadConfigData(false,"../webmatic_user/variables"+client+".json","variablesClient","webmaticvariablesclientMap",false,true)}}else{variablesClientMap=JSON.parse(localStorage.getItem("webmaticvariablesclientMap"))}createOneMap("variables");var e=resultVariablesMap.date;var g={};$.each(resultVariablesMap,function(k,h){if(k==="date"||k==="size"){return}var j=processVariable(h,k,e);if(resultOptionsMap.default_sort_manually){g[parseInt(h.position)]=j}else{g[h.name.toLowerCase()]=j}});var f;if(resultOptionsMap.default_sort_manually){f=Object.keys(g).sort(function(j,h){return j-h})}else{f=Object.keys(g).sort()}var a=f.length;for(var d=0;d<a;d++){var b=f[d];$("#"+dataList).append(g[b])}reloadList(mapText("SYS_VAR"),e,c,"")}loadConfigData(true,"cgi/variables.cgi","variables","webmaticvariablesMap",false,true,function(){createOneMap("variables");var h=resultVariablesMap.date;$.each(resultVariablesMap,function(k,j){if(k==="date"||k==="size"){return}if($("#"+k).length===0){$("#"+dataList).append(processVariable(j,k,h))}else{$("#"+k).replaceWith(processVariable(j,k,h))}});reloadList(mapText("SYS_VAR"),h,c,"");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly")});$(".buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change");$("textarea").textinput("refresh");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly")}function loadPrograms(c){$(".buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");if(c){$("#"+dataList).empty();$("#"+dataListHeader).empty();$("#"+dataListHeader).append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticprogramsMap")===null||localStorage.getItem("webmaticprogramsMap")==="undefined"){if(newVersion){saveDataToFile=true}loadConfigData(false,"../webmatic_user/programs.json","programs","webmaticprogramsMap",false,false)}else{loadLocalStorageMap("programs")}if(localStorage.getItem("webmaticprogramsclientMap")===null||localStorage.getItem("webmaticprogramsclientMap")==="undefined"){if(client!==""){loadConfigData(false,"../webmatic_user/programs"+client+".json","programsClient","webmaticprogramsclientMap",false,true)}}else{programsClientMap=JSON.parse(localStorage.getItem("webmaticprogramsclientMap"))}createOneMap("programs");var e=resultProgramsMap.date;var g={};$.each(resultProgramsMap,function(l,n){if(l==="date"||l==="size"){return}var j=n.visible;var h=n.active;var m=l;var k=processProgram(n,m,e,h,(readModus&&j)||!readModus);if(resultOptionsMap.default_sort_manually){g[parseInt(n.position)]=k}else{g[n.name.toLowerCase()]=k}});var f;if(resultOptionsMap.default_sort_manually){f=Object.keys(g).sort(function(j,h){return j-h})}else{f=Object.keys(g).sort()}var a=f.length;for(var d=0;d<a;d++){var b=f[d];$("#"+dataList).append(g[b])}reloadList(mapText("PROGRAMS"),e,c,"");$("#"+dataList).find(".btnDisabled").button("disable")}loadConfigData(true,"cgi/programs.cgi","programs","webmaticprogramsMap",false,true,function(){createOneMap("programs");var h=resultProgramsMap.date;$.each(resultProgramsMap,function(l,n){if(l==="date"||l==="size"){return}var k=n.visible;var j=n.active;var m=l;if($("#"+m).length===0){$("#"+dataList).append(processProgram(n,m,h,j,(readModus&&k)||!readModus))}else{$("#"+m).replaceWith(processProgram(n,m,h,j,(readModus&&k)||!readModus))}});reloadList(mapText("PROGRAMS"),h,c,"");$("#"+dataList).find(".btnDisabled").button("disable");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly")});$(".buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly")}$(function(){if(debugModus&&false){$("#errorsDebugger").show();$.each(errorsDebugger,function(a){$("#errorsDebugger").append(errorsDebugger[a])})}$.jqplot.config.enablePlugins=true;$(document).bind("mobileinit",function(){$.mobile.listview.prototype.options.filterPlaceholder=mapText("FILTER")});$(document.body).on("click","[id^=setButton]",function(){var g=$(this);var l=g.data("special");if(l){var n=g.data("id");switch(l){case"CLIMATECONTROL_RT_TRANSCEIVER":var o=$("#setTemperature_"+n).val();var b=$("#setStartTime_"+n).datebox("getTheDate");var c=$("#setStartDate_"+n).datebox("getTheDate");var f=(b.getHours()*60)+b.getMinutes();var m=c.getDate();var d=c.getMonth()+1;var q=c.getYear()-100;var j=$("#setEndTime_"+n).datebox("getTheDate");var h=$("#setEndDate_"+n).datebox("getTheDate");var a=(j.getHours()*60)+j.getMinutes();var e=h.getDate();var p=h.getMonth()+1;var k=h.getYear()-100;g.attr("data-value",o+","+f+","+m+","+d+","+q+","+a+","+e+","+p+","+k);break}}buttonEvents(g,g.data("refresh"),l)});$(document.body).on("click","[id^=setValueBigList]",function(){var b=$(this);var a=b.data("id");b.attr("data-value",$("#selector_"+a).val());buttonEvents(b,b.data("refresh"))});$(document.body).on("click","[id^=setTextButton]",function(){var b=$(this).data("id");var a="setValue_"+b;var d="info_"+b;var e=$("#"+a).val();e=e.replace(/\"/g,"'");e=encodeURIComponent(e);var c="";if(testSite){c+="&debug=true"}$("#"+d).text(mapText("TRANSFER"));$.get("cgi/set.cgi?id="+b+"&value="+e+c,function(){$("#"+d).text(mapText("TRANSFER_OK"));refreshPage(0)})});$(document.body).on("click","[id^=startProgramButton]",function(){var a=$(this).data("id");var c="info_"+a;var b="";if(testSite){b+="&debug=true"}$("#"+c).text("START");$.get("cgi/startprogram.cgi?id="+a+b,function(){$("#"+c).text(mapText("TRANSFER_OK"))})});$(document.body).on("click","[id^=saveHistorianData]",function(){var b=$(this);var a=b.data("id");b.attr("data-value",$("#hisHistorianID_"+a).val()+";"+$("#hisHMID_"+a).val()+";"+$("#hisDuration_"+a).val()+$("#hisSelector_"+a).val());buttonEvents(b,true)});$(document.body).on("click","[id^=saveTuneInRadioData]",function(){var b=$(this);var a=b.data("id");b.attr("data-value",$("#tuneInURL_"+a).val());buttonEvents(b,true)});$(document.body).on("click","[name=showTuneIn]",function(){var c=$(this);var b=c.data("id");var d=$("#saveTuneInRadioData_"+b).data("value");c.fadeOut(500,function(){c.attr("name","editTuneIn");if(d!==undefined){c.attr("data-val",d)}c.removeClass("ui-icon-eye").addClass("ui-icon-edit").fadeIn(1000)});var e=c.data("parentId");var a=c.data("vorDate");$("#tuneInField_"+b).fadeOut(500,function(){$("#tuneInField_"+b).html(getTuneIn(e,b,d,a));$("#"+b).enhanceWithin();$("#tuneInField_"+b).fadeIn(1000)})});$(document.body).on("click","[name=editTuneIn]",function(){var c=$(this);c.fadeOut(500,function(){c.attr("name","showTuneIn");c.removeClass("ui-icon-edit").addClass("ui-icon-eye").fadeIn(1000)});var e=c.data("parentId");var b=c.data("id");var d=c.data("val");var a=c.data("vorDate");$("#tuneInField_"+b).fadeOut(500,function(){$("#tuneInField_"+b).html(editTuneIn(e,b,d,a));$("#"+b).enhanceWithin();$("#tuneInField_"+b).fadeIn(1000)})});$(window).on("beforeunload",function(){if(mustBeSaved){saveAllDatasToServer()}if(!debugModus&&resultOptionsMap.dont_leave){return"Don't leave me!"}});$(document.body).on("fertig","#dataList,#dataList2",function(){if(!$("#"+dataList).hasClass("column-1")){var b=0;var c=0;var f=new Array();var e;var d=0;var g=$(".dataListItem");var a=g.length;g.each(function(j){e=$(this);d=e.position().top;if(c!==d){for(var h=0;h<f.length;h++){f[h].height(b)}d=e.position().top;f.length=0;c=d;b=e.height();f.push(e)}else{f.push(e);b=(b<e.height())?(e.height()):(b)}if(j===a-1){for(var h=0;h<f.length;h++){f[h].height(b)}}})}})});