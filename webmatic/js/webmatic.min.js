var oldType=-1,lastClickType=-1,lastClickID=-1,readModus=false,prevItem=0,programsMap={},functionsMap={},roomsMap={},favoritesMap={},variablesMap={},optionsMap={},theme,refreshTimer=setInterval(function(){CheckRefreshPage()},1e3),lastTime=-1;if(localStorage.getItem("webmaticOptionsMap")===null)$.ajax({type:"GET",url:"../webmatic_user/config.json",dataType:"json",success:function(a){optionsMap=a;localStorage.setItem("webmaticOptionsMap",JSON.stringify(a))},async:false});else optionsMap=JSON.parse(localStorage.getItem("webmaticOptionsMap"));if(localStorage.getItem("optionsMenuGfxTheme")===null){theme=optionsMap.getItem("default_theme");localStorage.setItem("optionsMenuGfxTheme",theme)}else theme=localStorage.getItem("optionsMenuGfxTheme");if(theme=="undefined"||$.inArray(theme,["a","b","c","d","e","f","g","h","i","j","k","l"])==-1)theme="a";function CheckRefreshPage(){var b=new Date,a=b.getTime();if(lastTime!=-1){if(a-lastTime>6e4){lastClickType!=4&&lastClickType!=7&&RefreshPage(0,true);RefreshServiceMessages();lastTime=a}}else lastTime=a}function RestartTimer(){var a=new Date;lastTime=a.getTime()}function RefreshPage(a,d){RestartTimer();if(a!=0){if(prevItem!=0){prevItem.removeClass("ui-btn-down-"+theme);prevItem.addClass("ui-btn-up-"+theme);prevItem.attr("data-theme",theme)}a.removeClass("ui-btn-up-"+theme);a.addClass("ui-btn-down-"+theme);a.attr("data-theme",theme);prevItem=a}if(lastClickType!=-1&&lastClickID!=-1){var b=-1;if(d)b=$(window).scrollTop();var c=oldType!=lastClickType;oldType=lastClickType;switch(lastClickType){case 1:loadData("cgi/list.cgi?list="+lastClickID,b);break;case 2:loadVariables(c);break;case 3:loadPrograms(c);break;case 4:loadGraphicIDs();break;case 5:loadData("debug/debug.json",b);break;case 6:loadData("debug/debug_cuxd.json",b);break;case 7:loadOptions()}$("#prim").find("script").each(function(){var a=$(this).attr("src");if(a)$.getScript(a);else eval($(this).text())})}}function RefreshServiceMessages(){$("#buttonService .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");$.getJSON("cgi/service.cgi",function(b){$("#serviceList").empty();var a=0;$.each(b.entries,function(j,b){var h=b.name,i=b.type,d=b.device,e=b.error,f=b.value,g=b.date,c=GetErrorMessage(i,e,f,d);$("#serviceList").append("<li><p class='ui-li-desc' style='text-align:right;'>"+g+"</p><h1>"+h+"</h1><p>"+c+"</p></li>");a+=1});$("#buttonService .ui-btn-text").text("("+a+")");if(a==0){$("#buttonService, #popupDiv").removeClass(function(b,a){return(a.match(/(^|\s)valueService-\S{1}/g)||[]).join(" ")});$("#headerButtonGroup").controlgroup("refresh",true);$("#serviceList").append("<li><p>Keine Servicemeldungen vorhanden.</p></li>")}else{$("#buttonService, #popupDiv").addClass("valueService-"+theme);$("#headerButtonGroup").controlgroup("refresh",true)}$("#serviceList").listview().listview("refresh",true)})}function RemoveMessages(){$.getJSON("cgi/removemessages.cgi",function(){})}function changeTheme(a){$("body, .ui-popup-screen").removeClass(function(b,a){return(a.match(/(^|\s)ui-overlay-\S{1}/g)||[]).join(" ")}).addClass("ui-overlay-"+a);$(".ui-page").removeClass(function(b,a){return(a.match(/(^|\s)ui-page-theme-\S{1}/g)||[]).join(" ")}).addClass("ui-page-theme-"+a).attr("data-theme",a);$(".ui-header").removeClass(function(b,a){return(a.match(/(^|\s)ui-bar-\S{1}/g)||[]).join(" ")}).addClass("ui-bar-"+a).attr("data-theme",a);$(".ui-content").removeClass(function(b,a){return(a.match(/(^|\s)ui-body-\S{1}/g)||[]).join(" ")}).addClass("ui-body-"+a).attr("data-theme",a);$(".ui-collapsible-set, .ui-listview").removeClass(function(b,a){return(a.match(/(^|\s)ui-group-theme-\S{1}/g)||[]).join(" ")}).addClass("ui-group-theme-"+a).attr("data-theme",a);$(".ui-btn").removeClass(function(b,a){return(a.match(/(^|\s)ui-btn-\S{1}/g)||[]).join(" ")}).addClass("ui-btn-"+a).attr("data-theme",a);$(".valueNoError").removeClass(function(b,a){return(a.match(/(^|\s)valueNoError-\S{1}/g)||[]).join(" ")}).addClass("valueNoError-"+a);$(".valueInfo").removeClass(function(b,a){return(a.match(/(^|\s)valueInfo-\S{1}/g)||[]).join(" ")}).addClass("valueInfo-"+a);$(".valueWarning").removeClass(function(b,a){return(a.match(/(^|\s)valueWarning-\S{1}/g)||[]).join(" ")}).addClass("valueWarning-"+a);$(".valueError").removeClass(function(b,a){return(a.match(/(^|\s)valueError-\S{1}/g)||[]).join(" ")}).addClass("valueError-"+a);$(".valueOK").removeClass(function(b,a){return(a.match(/(^|\s)valueOK-\S{1}/g)||[]).join(" ")}).addClass("valueOK-"+a);$("#buttonService, #popupDiv").removeClass(function(b,a){return(a.match(/(^|\s)valueService-\S{1}/g)||[]).join(" ")}).addClass("valueService-"+a);$("img").removeClass(function(b,a){return(a.match(/(^|\s)ui-img-\S{1}/g)||[]).join(" ")}).addClass("ui-img-"+a);theme=a;localStorage.setItem("optionsMenuGfxTheme",theme)}function AddSetButton(b,e,d,h,c,f,g){var a="";if(!c)a+="<p class='ui-li-desc'>";if(f)a+="<a href='#' data-value='"+d+"' data-role='button' data-inline='true' data-theme='"+theme+"'>"+e+"</a>";else a+="<a href='#' id='setButton_"+b+"' data-id='"+b+"' data-refresh='"+g+"' data-value='"+d+"' data-role='button' data-inline='true'>"+e+"</a>";if(!c)a+="<i>"+h+"</i> <span id='info_"+b+"' class='valueOK valueOK-"+theme+"'></span></p>";return a}function AddStartProgramButton(a,e,d,c){var b="<p class='ui-li-desc'><a href='#' "+(!c?"class='ui-link ui-btn ui-icon-gear ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-inline='true' data-icon='gear'")+" id='startProgramButton_"+a+"' data-id='"+a+"'>"+e+"</a></div>";b+="<i>"+d+"</i> <span id='info_"+a+"' class='valueOK valueOK-"+theme+"'></span></p>";return b}function AddSetNumber(c,h,j,e,d,i,a,g,f){var b="<div data-role='fieldcontain'>";b+="<input type='range' value='"+h*a+"' min='"+e*a+"' max='"+d*a+"' step='"+i*a+"' data-factor='"+a+"' id='setValue_"+c+"' data-id='"+c+"' data-highlight='true' data-theme='"+theme+"'/>";b+=" ("+e*a+" - "+d*a+" "+j+") ";b+="<a href='#' id='setNumberButton_"+c+"' data-id='"+c+"' data-refresh='"+f+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";b+="<i class='ui-li-desc'>"+g+"</i> <span id='info_"+c+"' class='valueOK valueOK-"+theme+"'></span>";b+="</div>";return b}function AddSetBoolButtonList(c,d,h,i,f,g,e){var a="<div data-role='fieldcontain'>";a+="<div data-role='controlgroup' data-type='horizontal'>";var b="";if(d=="false"||d=="")b="class='ui-btn-active'";else b="id='setButton_"+c+"' data-id='"+c+"' data-refresh='"+e+"'";a+="<a href='#' "+b+" data-value='false' data-role='button' data-inline='true' data-theme='"+theme+"'>"+h+"</a>";if(d=="true")b="class='ui-btn-active'";else b="id='setButton_"+c+"' data-id='"+c+"' data-refresh='"+e+"'";a+="<a href='#' "+b+" data-value='true' data-role='button' data-inline='true' data-theme='"+theme+"'>"+i+"</a>";a+="</div>";a+="</div>";a+=" "+f+" ";a+="<i class='ui-li-desc'>"+g+"</i> <span id='info_"+c+"' class='valueOK valueOK-"+theme+"'></span>";return a}function AddSetBoolComboBox(b,e,c,d,f,g){var a="<div data-role='fieldcontain'>";a+="<select id='setValue_"+b+"' data-id='"+b+"' data-native-menu='false' data-inline='true'>";if(e=="true")a+="<option value='false'>"+c+"</option><option selected value='true'>"+d+"</option>";else a+="<option selected value='false'>"+c+"</option><option value='true'>"+d+"</option>";a+="</select>";a+=" "+f+" <a href='#' id='setBoolButton_"+b+"' data-id='"+b+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";a+="<i class='ui-li-desc'>"+g+"</i> <span id='info_"+b+"' class='valueOK valueOK-"+theme+"'></span>";a+="</div>";return a}function AddSetBoolSwitch(b,e,c,d,f,g){var a="<div data-role='fieldcontain'>";a+="<div class='longerFlip'><select id='setValue_"+b+"' data-id='"+b+"' data-role='slider'>";if(e=="true")a+="<option value='false'>"+c+"</option><option selected value='true'>"+d+"</option>";else a+="<option selected value='false'>"+c+"</option><option value='true'>"+d+"</option>";a+="</select></div>";a+=" "+f+" <a href='#' id='setBoolButton_"+b+"' data-id='"+b+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";a+="<i class='ui-li-desc'>"+g+"</i> <span id='info_"+b+"' class='valueOK valueOK-"+theme+"'></span>";a+="</div>";return a}function AddSetValueList(d,f,h,i,j,g){var a="<div data-role='fieldcontain'>";a+="<div data-role='controlgroup' data-type='horizontal'>";for(var e=parseInt(f),c=h.split(";"),b=0;b<c.length;b++)if(e==b)a+="<a href='#' data-value='"+b+"' data-role='button' data-inline='true' class='ui-btn-active' data-theme='"+theme+"'>"+c[b]+"</a>";else a+="<a href='#' id='setButton_"+d+"' data-id='"+d+"' data-refresh='"+g+"' data-value='"+b+"' data-role='button' data-inline='true'>"+c[b]+"</a>";a+="</div>";a+="</div>";a+=" "+i+" ";a+="<i class='ui-li-desc'>"+j+"</i> <span id='info_"+d+"' class='valueOK valueOK-"+theme+"'></span>";return a}function AddSetText(a,c,d,e){var b="<div data-role='fieldcontain'>";c=c.replace(/\"/g,"&quot;");if(c.length>40)b+="<textarea id='setValue_"+a+"' data-id='"+a+"' style='width:20em; display:inline-block;'>"+c+"</textarea>";else b+="<input type='text' id='setValue_"+a+"' data-id='"+a+"' value=\""+c+"\" style='width:20em; display:inline-block;'/>";b+=" "+d+" <a href='#' id='setTextButton_"+a+"' data-id='"+a+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";b+="<i class='ui-li-desc'>"+e+"</i> <span id='info_"+a+"' class='valueOK valueOK-"+theme+"'></span>";b+="</div>";return b}function AddHTML(b,d,e,c){var a="<div data-role='fieldcontain' class='"+(c?"":"ui-grid-a")+"'>";a+="<div class='"+(c?"":"ui-block-a")+"'>"+d+"</div>";if(!c){a+="<div class='ui-block-b'><textarea id='setValue_"+b+"' data-id='"+b+"' style='width:20em; display:inline-block;'>"+d+"</textarea>";a+="<a href='#' id='setTextButton_"+b+"' data-id='"+b+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";a+="<i class='ui-li-desc'>"+e+"</i> <span id='info_"+b+"' class='valueOK valueOK-"+theme+"'></span>";a+="</div>";a+="</div>"}return a}function AddReadonlyVariable(h,b,e,c,d,g,i,j){var a="";if(c=="2")if(b=="true")a=j;else a=i;else if(c=="4")a=parseFloat(b);else if(c=="16"){var f=g.split(";");a=f[parseInt(b)]}else a=b;return c=="20"&&d=="html"?AddHTML(h,b,e,true):"<p><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+a+" "+d+" </span></p><i class='ui-li-desc'>"+e+"</i>"}function processVariable(a,c,l){var d=unescape(a.value),e=a.valueType,f=a.valueUnit,i=a.valueList,g=GetTimeDiffString(a.date,l),h=unescape(a.info),j=a.valueName0,k=a.valueName1,b="<li class='dataListItem' id='"+c+"'><h2 class='ui-li-heading'>"+unescape(a.name)+"</h2>";b+="<p>"+h+"</p>";if(isReadOnly(h))b+=AddReadonlyVariable(c,d,g,e,f,i,j,k);else if(e=="2")b+=AddSetBoolButtonList(c,d,j,k,f,g,true);else if(e=="4")b+=AddSetNumber(c,d,f,a.valueMin,a.valueMax,.001,1,g,true);else if(e=="16")b+=AddSetValueList(c,d,i,f,g,true);else if(e=="20"&&f=="html")b+=AddHTML(c,d,g,false);else if(e=="20")b+=AddSetText(c,d,f,g);else b+="Unbekannter Variablentyp!";b+="</li>";return b}function processProgram(a,c,d){var b="<li class='dataListItem' id='"+c+"'><h2 class='ui-li-heading'>"+a.name+"</h2><p>"+a.info+"</p>";b+=AddStartProgramButton(c,"Ausf&uuml;hren",GetTimeDiffString(a.date,d),a.operate=="true");b+="</li>";return b}function processGraphicID(a,b){$.each(b,function(c,d){var b="<li>";b+="<img id='img"+c+"' class='lazyLoadImage ui-li-thumbnail ui-img-"+theme+"' data-original='../webmatic_user/img/ids/"+a+"/"+c+".png' src='img/menu/"+a+".png'/>";b+="<form method='post' enctype='multipart/form-data' action='#' id='form"+c+"'>";b+="<div class='ui-grid-b'>";b+="<div class='ui-block-a'><h1>"+d+" ("+c+")</h1></div>";b+="<div class='ui-block-b'><input name='file' id='file"+c+"' type='file' accept='image/*' /></div>";b+="<div class='ui-block-c'><a href='#' name='uploadPicture' data-type='"+a+"' id='uploadPicture"+c+"' class='ui-link ui-btn ui-icon-check ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all ui-state-disabled'>Speichern</a></div>";b+="</div>";b+="</form>";b+="</li>";$("#dataList").append(b)})}function GetDateFromString(a){var b=a.substring(0,2),e=a.substring(3,5)-1,g=a.substring(6,10),c=a.substring(11,13),d=a.substring(14,16),f=a.substring(17,19);return new Date(g,e,b,c,d,f)}function isReadOnly(d){if(!readModus)return false;var a="",c=[],b=d.indexOf("(");if(b!=-1){var e=d.indexOf(")",b);if(e!=-1){var f=d.substring(b+1,e);c=f.split(",");if(c.length>=1)a=c[0].toLowerCase()}}return optionsMap.systemvar_readonly&&readModus?a!="w":a=="r"}function GetTimeDiffString(d,c){var a=(GetDateFromString(c)-GetDateFromString(d))/1e3;if(a<60)return"Vor "+Math.floor(a+.5)+" Sekunde/n";else if(a<60*60)return"Vor "+Math.floor(a/60+.5)+" Minute/n";else if(a<60*60*24)return"Vor "+Math.floor(a/(60*60)+.5)+" Stunde/n";else if(a<60*60*24*30.5)return"Vor "+Math.floor(a/(60*60*24)+.5)+" Tag/en";else if(a<60*60*24*30.5*12)return"Vor "+Math.floor(a/(60*60*24*30.5)+.5)+" Monat/en";else{var b=Math.floor(a/(60*60*24*30.5*12)+.5);return b>40?"Noch nicht ver&auml;ndert":"Vor "+b+" Jahr/en"}}function GetErrorMessage(f,c,b,d){var e=false,a="";if(f=="ALARMDP"){if(c=="CONFIG_PENDING")return"<span class='valueInfo valueInfo-"+theme+"'>Konfigurationsdaten werden &uuml;bertragen</span>";if(c=="LOWBAT")return"<span class='valueWarning valueWarning-"+theme+"'>Batteriestand niedrig</span>";if(c=="STICKY_UNREACH")return"<span class='valueInfo valueInfo-"+theme+"'>Kommunikation war gest&ouml;rt</span>";if(c=="UNREACH")return"<span class='valueError valueError-"+theme+"'>Kommunikation zur Zeit gest&ouml;rt</span>"}else if(f=="HSSDP"){if(c=="LOWBAT")a="Batterie leer";else if(c=="ERROR"){if(d=="CLIMATECONTROL_VENT_DRIVE"){if(b==1)a="Ventilantrieb schwerg&auml;ngig oder blockiert";else if(b==2)a="Ventilantrieb nicht montiert oder Stellbereich zu gro&szlig;";else if(b==3)a="Stellbereich zu klein";else if(b==4)a="St&iuml;rungsposition angefahren, Batterien nahezu entladen"}else if(d=="DIMMER"||d=="VIRTUAL_DIMMER"){if(b>=1)a="Lastfehler"}else if(d=="KEYMATIC"){if(b==1)a="Einkuppeln fehlgeschlagen";else if(b==2)a="Motorlauf abgebrochen"}else if(d=="WINMATIC"){if(b==1)a="Fehler Drehantrieb";else if(b==2)a="Fehler Kippantrieb"}else if(d=="ROTARY_HANDLE_SENSOR"||d=="SHUTTER_CONTACT"||d=="MOTION_DETECTOR")if(b>=1)a="Sabotage ausgel&ouml;st"}else if(c=="STATE"){if(d=="SMOKE_DETECTOR_TEAM"){if(b=="true")a="Rauch erkannt"}else if(d=="SENSOR_FOR_CARBON_DIOXIDE"){if(b==1)a="CO<sub>2</sub> Konzentration erh&ouml;ht";if(b>=2)a="CO<sub>2</sub> Konzentration stark erh&ouml;ht"}else if(d=="WATERDETECTIONSENSOR"){if(b==1)a="Feucht";if(b==2)a="Nass"}}else if(c=="ERROR_REDUCED")if(b)a="Reduzierte Leistung";else e=true;else if(c=="ERROR_OVERLOAD")if(b)a="Strom-&Uuml;berlastung";else e=true;else if(c=="ERROR_OVERHEAT")if(b)a="&Uuml;berhitzung";else e=true;else if(c=="ERROR_POWER")if(!b)a="Netzspannung fehlerhaft";else e=true;else if(c=="ERROR_SABOTAGE")if(!b)a="Sabotage ausgel&ouml;st";else e=true;else if(c=="ERROR_BATTERY")if(!b)a="Batterie fehlerhaft";else e=true;if(a!="")a="<span class='valueError valueError-"+theme+"'>"+a+"</span>"}if(a==""&&!e)a="<span class='valueError valueError-"+theme+"'>Unbekannter Fehler: "+b+"</span>";return a}function reloadList(b,a){$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+b+"<p style='float:right;'>"+a+"</p></li>").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create")}function ScrollToContentHeader(){$("html, body").animate({scrollTop:$("#prim").offset().top-60},200)}function ScrollToPosition(a){$("html, body").animate({scrollTop:a},200)}function loadData(b,a){a==-1&&ScrollToContentHeader();$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>Lade...</li>");$("#dataListHeader").listview("refresh");$("#buttonRefresh .ui-btn-text").html("<img src='img/misc/wait16.gif' class='ui-img-"+theme+"' width=12px height=12px>");$.getJSON(b,function(c){var b=c.date;$.each(c.entries,function(d,e){if(e.visible!="false"){var a="<li class='dataListItem' id='"+e.id+"'><h2 class='ui-li-heading'>"+unescape(e.name)+"</h2>",P=false,o="",p="",F="",l={},f="";if(e.type=="CHANNEL"){var c=e.hssType,X=false;$.each(e.channels,function(Q,k){X=true;var I=k.type;if(I=="HSSDP"){var i=k.id,h=k.hssType,C=k.date,e=GetTimeDiffString(C,b),q=k.value,g=parseFloat(k.value),K=q=="true",n=k.valueUnit;if(typeof n=="undefined")n="";else if(n=="100%")n="%";if(h=="STATE"){var w="",v="",m="",t=false,j="valFloat: "+g+", valString: "+q;if(c=="SHUTTER_CONTACT")if(q=="true")j="<span class='valueError valueError-"+theme+"'>Offen</span>";else j="<span class='valueOK valueOK-"+theme+"'>Geschlossen</span>";else if(c=="SMOKE_DETECTOR_TEAM")if(q=="true")j="<span class='valueError valueError-"+theme+"'>Rauch erkannt</span>";else j="<span class='valueOK valueOK-"+theme+"'>Kein Rauch erkannt</span>";else if(c=="SENSOR_FOR_CARBON_DIOXIDE"){if(g==0)j="<span class='valueOK valueOK-"+theme+"'>CO<sub>2</sub> Konzentration normal</span>";if(g==1)j="<span class='valueWarning valueWarning-"+theme+"'>CO<sub>2</sub> Konzentration erh&ouml;ht</span>";if(g>=2)j="<span class='valueError valueError-"+theme+"'>CO<sub>2</sub> Konzentration stark erh&ouml;ht</span>"}else if(c=="TILT_SENSOR")if(q=="true")j="<span class='valueWarning valueWarning-"+theme+"'>Offen</span>";else j="<span class='valueOK valueOK-"+theme+"'>Geschlossen</span>";else if(c=="WATERDETECTIONSENSOR"){if(g==0)j="<span class='valueOK valueOK-"+theme+"'>Trocken</span>";if(g==1)j="<span class='valueWarning valueWarning-"+theme+"'>Feucht</span>";if(g==2)j="<span class='valueError valueError-"+theme+"'>Nass</span>"}else if(c=="ROTARY_HANDLE_SENSOR"){if(g==0)j="<span class='valueOK valueOK-"+theme+"'>Geschlossen</span>";if(g==1)j="<span class='valueWarning valueWarning-"+theme+"'>Gekippt</span>";if(g==2)j="<span class='valueError valueError-"+theme+"'>Offen</span>"}else if(c=="KEYMATIC"){t=true;w="Auf";v="Zu"}else if(c=="SWITCH"){t=true;w="Ein";v="Aus"}else if(c=="ALARMACTUATOR"){t=true;w="Ein";v="Aus"}else if(c=="DIGITAL_OUTPUT"){t=true;w="Ein";v="Aus"}else if(c=="DIGITAL_ANALOG_OUTPUT"){t=true;w="Ein";v="Aus"}else if(c=="DIGITAL_INPUT")if(g=="true")j="Ein";else j="Aus";else if(g=="true")j="Aus";else j="Ein";if(t)a+=AddSetBoolButtonList(k.id,q,v,w,"",e,true);else a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+j+" </span><span><i>"+e+"</i></span></p>"}else if(h=="VALUE")a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+q+" "+n+" </span> <span><i>"+e+"</i></span></p>";else if(h=="SENSOR"&&c=="SENSOR"){if(q=="true")j="<span class='valueError valueError-"+theme+"'>Offen</span>";else j="<span class='valueOK valueOK-"+theme+"'>Geschlossen</span>";a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+j+" </span><span><i>"+e+"</i></span></p>"}else if(h=="PRESS_SHORT")a+=AddSetButton(k.id,"Kurzer Tastendruck",true,e,false,false,true);else if(h=="PRESS_LONG")a+=AddSetButton(k.id,"Langer Tastendruck",true,e,false,false,true);else if(h=="SETPOINT"){a+=AddSetNumber(i,g,n,6,30,.5,1,e,false);var y=g-3,A=y+6;if(y<6){y=6;A=11}if(A>30){y=25;A=30}a+="<div data-role='controlgroup' data-type='horizontal'>";for(d=y;d<=A;d+=1)a+=AddSetButton(i,d+n,d,e,true,d==g,false);a+="</div>"}else if(h=="RAINING"){var D="";if(q=="true")D="Regen";else D="Kein Regen";a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+D+"</span> | <span><i>"+e+"</i></span></p>"}else if(h=="MOTION"){if(q=="true")m="<span class='valueWarning valueWarning-"+theme+"'>Bewegung </span>";else m="<span class='valueOK valueOK-"+theme+"'>Keine Bewegung </span>";a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+m+"<span><i>"+e+"</i></span></p>"}else if(h=="LEVEL"&&c=="BLIND"){a+=AddSetNumber(i,g,n,0,1,.01,100,e+" | 0% = Geschlossen, 100% = Offen",false);a+="<div data-role='controlgroup' data-type='horizontal'>";a+=AddSetButton(i,"Zu",0,e,true,g==0,false);a+=AddSetButton(i,"20%",.2,e,true,g==.2,false);a+=AddSetButton(i,"40%",.4,e,true,g==.4,false);a+=AddSetButton(i,"60%",.6,e,true,g==.6,false);a+=AddSetButton(i,"80%",.8,e,true,g==.8,false);a+=AddSetButton(i,"Auf",1,e,true,g==1,false);a+="</div>"}else if(h=="STOP"&&c=="BLIND")a+=AddSetButton(i,"Stop",true,e,false,false,false);else if(h=="OPEN"&&c=="KEYMATIC")a+=AddSetButton(i,"&Ouml;ffnen",true,e,false,false,true);else if(h=="LEVEL"&&c=="WINMATIC"){a+=AddSetNumber(i,g,n,-.005,1,.01,100,e+" | -0.5 = Verriegelt, 0% = Geschlossen, 100% = Offen",false);a+="<div data-role='controlgroup' data-type='horizontal'>";a+=AddSetButton(i,"Verriegeln",-.005,e,true,g==-.005,false);a+=AddSetButton(i,"Zu",0,e,true,g==0,false);a+=AddSetButton(i,"20%",.2,e,true,g==.2,false);a+=AddSetButton(i,"40%",.4,e,true,g==.4,false);a+=AddSetButton(i,"60%",.6,e,true,g==.6,false);a+=AddSetButton(i,"80%",.8,e,true,g==.8,false);a+=AddSetButton(i,"Auf",1,e,true,g==1,false);a+="</div>"}else if(h=="STOP"&&c=="WINMATIC")a+=AddSetButton(i,"Stop",true,e,false,false,false);else if(h=="LEVEL"&&c=="AKKU")a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+g*100+" "+n+" </span>Batterieladung | <span><i>"+e+"</i></span></p>";else if(h=="LEVEL"&&(c=="DIMMER"||c=="VIRTUAL_DIMMER")){a+=AddSetNumber(i,g,n,0,1,.01,100,e+" | 0% = Aus, 100% = An",false);a+="<div data-role='controlgroup' data-type='horizontal'>";a+=AddSetButton(i,"Aus",0,e,true,g==0,false);a+=AddSetButton(i,"20%",.2,e,true,g==.2,false);a+=AddSetButton(i,"40%",.4,e,true,g==.4,false);a+=AddSetButton(i,"60%",.6,e,true,g==.6,false);a+=AddSetButton(i,"80%",.8,e,true,g==.8,false);a+=AddSetButton(i,"An",1,e,true,g==1,false);a+="</div>"}else if(h=="U_SOURCE_FAIL"&&c=="POWER"){if(q=="false")m="<span class='valueNoError valueNoError-"+theme+"'>Netzbetrieb</span>";else m="<span class='valueError valueError-"+theme+"'>Batteriebetrieb</span>";a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+m+" <span><i>"+e+"</i></span></p>"}else if(h=="LOWBAT"&&c=="POWER"){if(q=="false")m="<span class='valueOK valueOK-"+theme+"'>Batterie OK</span>";else m="<span class='valueError valueError-"+theme+"'>Batterie leer</span>";a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+m+" <span><i>"+e+"</i></span></p>"}else if(h=="U_USBD_OK"&&c=="POWER"){if(q=="false")m="<span class='valueNoError valueNoError-"+theme+"'>USB nicht aktiv</span>";else m="<span class='valueOK valueOK-"+theme+"'>USB aktiv</span>";a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+m+" <span><i>"+e+"</i></span></p>"}else if(h=="BAT_LEVEL"&&c=="POWER")a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+g*100+" "+n+" </span>Batterieladung | <span><i>"+e+"</i></span></p>";else if(h=="STATUS"&&c=="AKKU"){if(g==0)m="<span class='valueNoError valueNoError-"+theme+"'>Erhaltungsladung</span>";else if(g==1)m="<span class='valueNoError valueNoError-"+theme+"'>Akku l&auml;dt</span>";else if(g==2)m="<span class='valueNoError valueNoError-"+theme+"'>Versorgung durch Akku</span>";else m="<span class='valueWarning valueWarning-"+theme+"'>Status unbekannt</span>";a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+m+" <span><i>"+e+"</i></span></p>"}else if(h=="STATE_UNCERTAIN"){if(q=="true")m="<span class='valueWarning valueWarning-"+theme+"'>Zustand unbestimmt</span>";else m="<span class='valueNoError valueNoError-"+theme+"'>Zustand OK</span>";a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:30px'>"+m+" <span><i>"+e+"</i></span></p>"}else if(h=="LED_STATUS")switch(g){case 0:a+="<p><img class='ui-img-"+theme+"' src='img/channels/off_lamp.png' style='max-height:40px'> Status | <span><i>"+e+"</i></span></p>";break;case 1:a+="<p><img class='ui-img-"+theme+"' src='img/channels/red_lamp.png' style='max-height:40px'> Status | <span><i>"+e+"</i></span></p>";break;case 2:a+="<p><img class='ui-img-"+theme+"' src='img/channels/green_lamp.png' style='max-height:40px'> Status | <span><i>"+e+"</i></span></p>";break;case 3:a+="<p><img class='ui-img-"+theme+"' src='img/channels/orange_lamp.png' style='max-height:40px'> Status | <span><i>"+e+"</i></span></p>"}else if(h=="ERROR"||h.substring(0,6)=="ERROR_"){if(h=="ERROR"&&g>0||h.substring(0,6)=="ERROR_"){var x;if(h=="ERROR")x=g;else x=K;m=GetErrorMessage("HSSDP",h,x,c);if(m!="")a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+m+" <span><i>"+e+"</i></span></p>"}}else if(!(h=="ON_TIME"||h=="INHIBIT"||h=="ADJUSTING_COMMAND"||h=="ADJUSTING_DATA"||h=="RELOCK_DELAY"||h=="SPEED"||h=="LEVEL"||h=="RAMP_STOP"||h=="RAMP_TIME"||h=="OLD_LEVEL")){var H=MapText(h);x=q;if(!isNaN(q))x=g;if(H!="-")a+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/"+MapImage(h)+"' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+x+" "+n+" </span>"+H+" | <span><i>"+e+"</i></span></p>"}}else if(I=="VARDP"){var s=k.id,z=unescape(k.info),r=unescape(k.value),u=k.valueType;n=k.valueUnit;var N=k.valueName0,O=k.valueName1,M=k.valueMin,L=k.valueMax,G=k.valueList;C=k.date;e=GetTimeDiffString(C,b);f="";l=[];var B=z.indexOf("(");if(B!=-1){var E=z.indexOf(")",B);if(E!=-1){var J=z.substring(B+1,E);l=J.split(",");if(l.length>=1)f=l[0].toLowerCase()}}if(f!="nv"){a+="<br><h2 class='ui-li-heading'>"+unescape(k.name)+"</h2>";a+="<p>"+z+"</p>";if(isReadOnly(z))a+=AddReadonlyVariable(s,r,e,u,n,G);else if(f=="d"||f=="dk"||f=="g"||f=="h"){P=true;if(f=="dk")o=k.diagrams;else o=r;p="chart_"+s;F=n;if(f=="g")a+="<div id='"+p+"' style='height:200px; width:300px;'></div> <i class='ui-li-desc'>"+e+"</i>";else a+="<div id='"+p+"' style='height:300px; width:90%;'></div> <i class='ui-li-desc'>"+e+"</i>"}else if(u=="2")a+=AddSetBoolButtonList(s,r,N,O,n,e,true);else if(u=="4")a+=AddSetNumber(s,r,n,M,L,.001,1,e,true);else if(u=="16")a+=AddSetValueList(s,r,G,n,e,true);else if(u=="20"&&n=="html")a+=AddHTML(s,r,e,false);else if(u=="20")a+=AddSetText(s,r,n,e);else a+="Unbekannter Variablentyp!"}}});if(!X)a=""}else if(e.type=="VARDP"){var v=e.id,B=unescape(e.info),t=unescape(e.value),x=e.valueType,u=e.valueUnit,xb=e.valueName0,yb=e.valueName1,rb=e.valueMin,qb=e.valueMax,db=e.valueList,mb=e.date,m=GetTimeDiffString(mb,b);f="";l=[];var M=B.indexOf("(");if(M!=-1){var W=B.indexOf(")",M);if(W!=-1){var lb=B.substring(M+1,W);l=lb.split(",");if(l.length>=1)f=l[0].toLowerCase()}}a+="<p>"+B+"</p>";if(isReadOnly(B))a+=AddReadonlyVariable(v,t,m,x,u,db);else if(f=="d"||f=="dk"||f=="g"||f=="h"){P=true;if(f=="dk")o=channel.diagrams;else o=t;p="chart_"+v;F=u;if(f=="g")a+="<div id='"+p+"' style='height:200px; width:300px;'></div> <i class='ui-li-desc'>"+m+"</i>";else a+="<div id='"+p+"' style='height:300px; width:90%;'></div> <i class='ui-li-desc'>"+m+"</i>"}else if(f=="nv")a="";else if(x=="2")a+=AddSetBoolButtonList(v,t,xb,yb,u,m,true);else if(x=="4")a+=AddSetNumber(v,t,u,rb,qb,.001,1,m,true);else if(x=="16")a+=AddSetValueList(v,t,db,u,m,true);else if(x=="20"&&u=="html")a+=AddHTML(v,t,m,false);else if(x=="20")a+=AddSetText(v,t,u,m);else a+="Unbekannter Variablentyp!"}else if(e.type=="PROGRAM"){var tb=e.id,pb=e.info,ob=e.date;m=GetTimeDiffString(ob,b);a+="<p>"+pb+"</p>";a+=AddStartProgramButton(tb,"Ausf&uuml;hren",m)}if(a!=""){a+="</li>";$("#dataList").append(a)}if(P){$("#dataList").listview("refresh");var I="l",fb="69A5CF",z="",y="",T=1,gb="0/#008800",kb="30/#AA4400";for(d=0;d<l.length;d++){var g=l[d].split("=");if(g.length==2)if(g[0]=="t")I=g[1];else if(g[0]=="c")fb=g[1];else if(g[0]=="l")z=g[1];else if(g[0]=="h")y=g[1];else if(g[0]=="k")T=parseInt(g[1]);else if(g[0]=="s")gb=g[1];else if(g[0]=="e")kb=g[1]}if(f=="g"){var H=parseFloat(o),ab=gb.split("/"),A=parseFloat(ab[0]),O=ab[1];if(H<A)A=H;var hb=kb.split("/"),G=parseFloat(hb[0]),N=hb[1];if(H>G)G=H;var jb=parseInt(O.substring(1,3),16),ib=parseInt(O.substring(3,5),16),eb=parseInt(O.substring(5,7),16),wb=parseInt(N.substring(1,3),16),vb=parseInt(N.substring(3,5),16),ub=parseInt(N.substring(5,7),16),cb=[],bb=[],Q=10;for(d=1;d<=Q;d++){var E=d/Q,n=A+E*(G-A);cb.push(n);E=(d-1)/(Q-1);var L=Math.floor(jb+E*(wb-jb)).toString(16);if(L.length<2)L="0"+L;var K=Math.floor(ib+E*(vb-ib)).toString(16);if(K.length<2)K="0"+K;var J=Math.floor(eb+E*(ub-eb)).toString(16);if(J.length<2)J="0"+J;var zb="#"+L+K+J;bb.push(zb)}var sb=[o];$.jqplot(p,[sb],{seriesDefaults:{renderer:$.jqplot.MeterGaugeRenderer,rendererOptions:{label:o+" "+F,labelPosition:"bottom",labelHeightAdjust:-5,min:A,max:G,intervals:cb,intervalColors:bb}},grid:{backgroundColor:"transparent"}})}else if(f=="h"){var w=o.split(";"),C=w[0];if(C>0){var h=[];h[0]=[];h[1]=[];h[2]=[];h[3]=[];h[4]=[];var s=0,j;if(z=="")j=15;else j=parseFloat(z);var i;if(y=="")i=23;else i=parseFloat(y);var r="",q="";for(d=1;d<=C;d++){var Ab=w[d],U=Ab.split(","),k=U[0];if(r==""||k<r)r=k;if(q==""||k>q)q=k;for(s=1;s<U.length;s++){var V=[];V[0]=k;var D=U[s];V[1]=D;h[s-1][d-1]=V}}}var nb=$.jqplot(p,[h[0],h[1],h[2],h[3],h[4]],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%a, %#d %#H:%M",angle:20},min:r,max:q},yaxis:{min:j,max:i,showLabel:true,tickOptions:{formatString:"%."+T+"f&deg;C"}},y2axis:{min:0,max:100,showLabel:true,tickOptions:{formatString:"%d%"}}},legend:{show:false,fontSize:23,placement:"outside",location:"e"},seriesDefaults:{lineWidth:2,showMarker:false,fill:false,shadow:false},series:[{label:"Soll",color:"#555555",fill:true,fillAlpha:.1},{label:"Ist",color:"#DD0000"},{label:"relF%",color:"#0174DF",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis"}],highlighter:{show:true,sizeAdjust:5.5},cursor:{zoom:true,show:true},grid:{backgroundColor:"#F4F4F4"}})}else if(I=="l"||I=="f"){w=o.split(",");C=w.length;if(C>=3){h=[];s=0;j=1e6;i=-1e6;r="";q="";for(d=1;d<C;d=d+2){k=w[d];D=w[d+1];var S=[];S[0]=k;n;if(D=="true")n=1;else if(D=="false")n=0;else n=parseFloat(D);S[1]=n;if(n<j)j=n;if(n>i)i=n;if(r==""||k<r)r=k;if(q==""||k>q)q=k;h[s]=S;s++}if(z=="")j=j-.1*(i-j);else if(z!="m"){var Z=parseFloat(z);if(Z<j)j=Z}if(y=="")i=i+.1*(i-j);else if(y!="m"){var Y=parseFloat(y);if(Y>i)i=Y}var R;if(I=="l")R=false;else R=true;nb=$.jqplot(p,[h],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%b %#d, %#H:%M",angle:20},min:r,max:q},yaxis:{min:j,max:i,tickOptions:{formatString:"%."+T+"f"+F}}},seriesDefaults:{rendererOptions:{smooth:true}},series:[{color:"#"+fb,lineWidth:2,showMarker:false,fill:R}],highlighter:{show:true,sizeAdjust:5.5},cursor:{show:false},grid:{backgroundColor:"#F4F4F4"}})}}}}});$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+c.name+"<p style='float:right;'>"+b+"</p></li>");$("#dataListHeader").listview().listview("refresh");$("#buttonRefresh .ui-btn-text").html("&nbsp;");$("#dataList").listview().listview("refresh");$("#dataList").trigger("create");$(".ui-input-search .ui-input-text").trigger("change");$("[id^=button]").trigger("create");$("[id^=input]").trigger("create");if(a==-1)ScrollToContentHeader();else ScrollToPosition(a)})}function loadVariables(c){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var b=false;if(c){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>Lade...</li>").listview("refresh");if(localStorage.getItem("webmaticVariablesMap")===null){$.ajax({type:"GET",url:"cgi/systemvariables.cgi",dataType:"json",success:function(a){variablesMap=a;localStorage.setItem("webmaticVariablesMap",JSON.stringify(variablesMap))},async:false});b=true}else variablesMap=JSON.parse(localStorage.getItem("webmaticVariablesMap"));var a=variablesMap.date;$.each(variablesMap.entries,function(e,b){var c=b.visible=="true",d=b.id;(readModus&&c||!readModus)&&$("#dataList").append(processVariable(b,d,a))});reloadList("Systemvariablen",a)}!b&&$.getJSON("cgi/systemvariables.cgi",function(b){var a=b.date;$.each(b.entries,function(e,c){var d=c.visible=="true",b=c.id;if($("#"+b).length==0&&(readModus&&d||!readModus))$("#dataList").append(processVariable(c,b,a));else if(readModus&&d||!readModus)$("#"+b).replaceWith(processVariable(c,b,a));else $("#"+b).length!=0&&$("#"+b).hide()});localStorage.setItem("webmaticVariablesMap",JSON.stringify(b));reloadList("Systemvariablen",a)});$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change")}function loadPrograms(c){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var b=false;if(c){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>Lade...</li>").listview("refresh");if(localStorage.getItem("webmaticProgramsMap")===null){$.ajax({type:"GET",url:"cgi/programs.cgi",dataType:"json",success:function(a){programsMap=a;localStorage.setItem("webmaticProgramsMap",JSON.stringify(programsMap))},async:false});b=true}else programsMap=JSON.parse(localStorage.getItem("webmaticProgramsMap"));var a=programsMap.date;$.each(programsMap.entries,function(f,b){var c=b.visible=="true",d=b.active=="true",e=b.id;(readModus&&c&&d||!readModus)&&$("#dataList").append(processProgram(b,e,a))});reloadList("Programme",a);$("#dataList").find(".btnDisabled").button("disable")}!b&&$.getJSON("cgi/programs.cgi",function(b){var a=b.date;$.each(b.entries,function(f,c){var d=c.visible=="true",e=c.active=="true",b=c.id;if($("#"+b).length==0&&(readModus&&d&&e||!readModus))$("#dataList").append(processProgram(c,b,a));else if(readModus&&d&&e||!readModus)$("#"+b).replaceWith(processProgram(c,b,a));else $("#"+b).length!=0&&$("#"+b).hide()});localStorage.setItem("webmaticProgramsMap",JSON.stringify(b));reloadList("Programme",a);$("#dataList").find(".btnDisabled").button("disable")});$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change")}function loadGraphicIDs(){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>Lade...</li>").listview("refresh");$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");if(localStorage.getItem("webmaticFavoritesMap")===null)$.ajax({type:"GET",url:"cgi/favorites.cgi",dataType:"json",success:function(a){favoritesMap=a;localStorage.setItem("webmaticFavoritesMap",JSON.stringify(favoritesMap))},async:false});else{favoritesMap=JSON.parse(localStorage.getItem("webmaticFavoritesMap"));$.getJSON("cgi/favorites.cgi",function(a){localStorage.setItem("webmaticFavoritesMap",JSON.stringify(a))})}$("#dataList").append("<li data-role='list-divider' role='heading'>Favoriten</li>");processGraphicID("favorites",favoritesMap);if(localStorage.getItem("webmaticRoomsMap")===null)$.ajax({type:"GET",url:"cgi/rooms.cgi",dataType:"json",success:function(a){roomsMap=a;localStorage.setItem("webmaticRoomsMap",JSON.stringify(roomsMap))},async:false});else{roomsMap=JSON.parse(localStorage.getItem("webmaticRoomsMap"));$.getJSON("cgi/rooms.cgi",function(a){localStorage.setItem("webmaticRoomsMap",JSON.stringify(a))})}$("#dataList").append("<li data-role='list-divider' role='heading'>R&auml;ume</li>");processGraphicID("rooms",roomsMap);if(localStorage.getItem("webmaticFunctionsMap")===null)$.ajax({type:"GET",url:"cgi/functions.cgi",dataType:"json",success:function(a){functionsMap=a;localStorage.setItem("webmaticFunctionsMap",JSON.stringify(functionsMap))},async:false});else{functionsMap=JSON.parse(localStorage.getItem("webmaticFunctionsMap"));$.getJSON("cgi/functions.cgi",function(a){localStorage.setItem("webmaticFunctionsMap",JSON.stringify(a))})}$("#dataList").append("<li data-role='list-divider' role='heading'>Gewerke</li>");processGraphicID("functions",functionsMap);$("#dataList").listview("refresh");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly");$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>Grafik IDs</li>");$("#dataListHeader").listview("refresh");$("#buttonRefresh .ui-btn-text").html("&nbsp;");$("#dataList").listview("refresh");$("#dataList").trigger("create")}function loadOptions(){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>Optionen</li>");var a="<li><h1>Gr&ouml;&szlig;e der Menugrafiken</h1><p><div data-role='fieldcontain'>";a+="<div data-role='controlgroup' data-type='horizontal'>";var e=localStorage.getItem("optionsMenuGfxSize"),b="",c="";if(!e||e==""||e=="large")c="class='ui-btn-active'";else b="class='ui-btn-active'";a+="<a href='#' id='optionsMenuGfxSizeSmall' data-id='optionsMenuGfxSizeSmall' data-role='button' data-inline='true' "+b+">Klein</a>";a+="<a href='#' id='optionsMenuGfxSizeLarge' data-id='optionsMenuGfxSizeLarge' data-role='button' data-inline='true' "+c+">Gro&szlig;</a>";a+="</div></li>";$("#dataList").append(a);a="<li><h1>Testseiten anzeigen</h1><p><div data-role='fieldcontain'>";var d=localStorage.getItem("optionsMenuShowTestpages");if(!d||d==""||d=="false"){b="";c="class='ui-btn-active'"}else{b="class='ui-btn-active'";c=""}a+="<div data-role='controlgroup' data-type='horizontal'>";a+="<a href='#' id='optionsMenuShowTestpages' data-id='optionsMenuShowTestpages' data-role='button' data-inline='true' "+b+">Anzeigen</a>";a+="<a href='#' id='optionsMenuHideTestpages' data-id='optionsMenuHideTestpages' data-role='button' data-inline='true' "+c+">Verstecken</a>";a+="</div></li>";$("#dataList").append(a);a="<li><h1>Theme ausw&auml;hlen</h1><p><div data-role='fieldcontain'>";a+="<div data-role='controlgroup' data-type='horizontal'>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='a' class='"+(theme=="a"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Normal</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='b' class='"+(theme=="b"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Schwarz</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='c' class='"+(theme=="c"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Rosa</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='d' class='"+(theme=="d"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Gr&uuml;n</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='e' class='"+(theme=="e"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Gelb</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='f' class='"+(theme=="f"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Grau</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='g' class='"+(theme=="g"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Blau</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='h' class='"+(theme=="h"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Rot</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='i' class='"+(theme=="i"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Braun</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='j' class='"+(theme=="j"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Wei&szlig;</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='k' class='"+(theme=="k"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Brazil</a>";a+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='l' class='"+(theme=="l"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Deutschland</a>";a+="</div></li>";$("#dataList").append(a);a="<li><h1>WebMatic neu laden, damit alle Einstellungen wirksam werden</h1><p><div data-role='fieldcontain'>";a+="<a href='#' id='reloadWebMatic' data-id='reloadWebMatic' data-role='button' data-inline='true'>Neu laden</a>";a+="</li>";$("#dataList").append(a);$("#dataListHeader").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create")}$(function(){$(document).bind("mobileinit",function(){$.mobile.listview.prototype.options.filterPlaceholder="Daten filtern..."});$(document.body).on("click","[id^=setButton]",function(){var b=$(this).data("id"),c=$(this).data("refresh"),d=$(this).data("value"),a="info_"+b;$("#"+a).text("\ufffdbertrage...");$.getJSON("cgi/set.cgi?id="+b+"&value="+d,function(){if(c){$("#"+a).text("OK!");RefreshPage(0,true)}else $("#"+a).text("Wert wird noch an Ger\ufffdt \ufffdbertragen und erst verz\ufffdgert hier dargestellt.")})});$(document.body).on("click","[id^=setNumberButton]",function(){var a=$(this).data("id"),e=$(this).data("refresh"),c="setValue_"+a,b="info_"+a,g=$("#"+c).val(),f=$("#"+c).data("factor"),d=parseFloat(g)/f;$("#"+b).text("\ufffdbertrage...");$.getJSON("cgi/set.cgi?id="+a+"&value="+d,function(){if(e){$("#"+b).text("OK!");RefreshPage(0,true)}else $("#"+b).text("Wert wird noch an Ger\ufffdt \ufffdbertragen und erst verz\ufffdgert hier dargestellt.")})});$(document.body).on("click","[id^=setBoolButton]",function(){var a=$(this).data("id"),c="setValue_"+a,b="info_"+a,d=$("#"+c).val();$("#"+b).text("\ufffdbertrage...");$.getJSON("cgi/set.cgi?id="+a+"&value="+d,function(){$("#"+b).text("OK!");RefreshPage(0,true)})});$(document.body).on("click","[id^=setValueListButton]",function(){var a=$(this).data("id"),c="setValue_"+a,b="info_"+a,d=$("#"+c).val();$("#"+b).text("\ufffdbertrage...");$.getJSON("cgi/set.cgi?id="+a+"&value="+d,function(){$("#"+b).text("OK!");RefreshPage(0,true)})});$(document.body).on("click","[id^=setTextButton]",function(){var b=$(this).data("id"),d="setValue_"+b,c="info_"+b,a=$("#"+d).val();a=a.replace(/\"/g,"'");a=encodeURIComponent(a);$("#"+c).text("\ufffdbertrage...");$.getJSON("cgi/set.cgi?id="+b+"&value="+a,function(){$("#"+c).text("OK!");RefreshPage(0,true)})});$(document.body).on("click","[id^=startProgramButton]",function(){var a=$(this).data("id"),b="info_"+a;$("#"+b).text("Starte...");$.getJSON("cgi/startprogram.cgi?id="+a,function(){$("#"+b).text("OK!")})});$(document.body).on("change",":file",function(){var a=this.files[0];if(a.name.length>=1)if(a.type!="image/png"&&a.type!="image/jpg"&&!a.type!="image/gif"&&a.type!="image/jpeg")alert("Es k\ufffdnnen nur JPG, GIF oder PNG hochgeladen werden!");else{var b=$(this).attr("id"),c=b.substr(4,b.length);$("#uploadPicture"+c).removeClass("ui-state-disabled")}});$(document.body).on("click","a[name=uploadPicture]",function(){var d=$(this).attr("id"),a=d.substr(13,d.length),f=$(this).data("type"),b=new FormData,e=document.getElementById("file"+a).files[0],c=new FileReader;c.onloadend=function(){var d=new Image;d.src=c.result;d.onload=function(){var l=160,k=160,e=d.width,c=d.height;if(e>c){if(e>l){c*=l/e;e=l}}else if(c>k){e*=k/c;c=k}var g=document.createElement("canvas");g.width=e;g.height=c;var q=g.getContext("2d");q.drawImage(this,0,0,e,c);for(var m=g.toDataURL("image/png"),j=atob(m.split(",")[1]),i=new ArrayBuffer(j.length),p=new Uint8Array(i),h=0;h<j.length;h++)p[h]=j.charCodeAt(h)&255;var n;try{n=new Blob([i],{type:"image/png"})}catch(r){var o=new(window.WebKitBlobBuilder||window.MozBlobBuilder);o.append(i);n=o.getBlob("image/png")}$("#img"+a).fadeOut(500,function(){$("#img"+a).attr("src",m).fadeIn(1e3)});$("#menuImg"+a).fadeOut(500,function(){$("#menuImg"+a).attr("src",m).fadeIn(1e3)});b.append("file",n,a+".png");b.append("filename",a+".png");b.append("path","/usr/local/etc/config/addons/www/webmatic_user/img/ids/"+f+"/");$.ajax({url:"cgi/upload.cgi",type:"POST",data:b,cache:false,contentType:false,processData:false},"json")};$("#uploadPicture"+a).addClass("ui-state-disabled")};c.readAsDataURL(e)})});