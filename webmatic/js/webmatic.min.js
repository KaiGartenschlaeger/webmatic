
var webmaticVersion="0";var newWebmaticVersion=webmaticVersion;var storageVersion=1;var debugModus=true;var testSite=false;var lastClickType=-1;var oldID=-1;var lastClickID=-1;var readModus=false;var prevItem=0;var saveDataToFile=false;var newVersion=false;var mustBeSaved=false;var programsMap,functionsMap,roomsMap,favoritesMap,variablesMap,optionsMap,devicesMap;var theme,font;var loadedFont=["a"];var today=new Date();var dateNow=(today.getDate()<10?"0"+today.getDate():today.getDate())+"."+(today.getMonth()+1<10?"0"+today.getMonth()+1:today.getMonth()+1)+"."+today.getFullYear();var refreshTimer=setInterval(function(){checkrefreshPage()},1000);var lastTime=-1;if(localStorage.getItem("webmaticOptionsMap")===null){localStorage.clear();loadConfigData(false,"../webmatic_user/config.json","config","webmaticOptionsMap",false,true)}else{optionsMap=JSON.parse(localStorage.getItem("webmaticOptionsMap"));var ok=true;if(optionsMap.storageVersion!==storageVersion){ok=false;localStorage.clear();newVersion=true}loadConfigData(ok,"../webmatic_user/config.json","config","webmaticOptionsMap",false,true)}$.get("https://raw.githubusercontent.com/jens-maus/webmatic/master/VERSION",function(a){newWebmaticVersion=a});if(localStorage.getItem("optionsMenuGfxTheme")===null){theme=optionsMap.default_theme;localStorage.setItem("optionsMenuGfxTheme",theme)}else{theme=localStorage.getItem("optionsMenuGfxTheme")}if(theme==="undefined"||$.inArray(theme,["a","b","c","d","e","f","g","h","i","j","k","l"])===-1){theme="a"}if(localStorage.getItem("optionsMenuGfxFont")===null){font=optionsMap.default_font;localStorage.setItem("optionsMenuGfxFont",font)}else{font=localStorage.getItem("optionsMenuGfxFont")}if(font==="undefined"||$.inArray(font,["a","b","c","d","e","f","g","h","i","j","k","l"])===-1){font="a"}function checkrefreshPage(){var b=new Date();var a=b.getTime();if(lastTime!==-1){if(a-lastTime>60000){if(lastClickType!==4&&lastClickType!==7){refreshPage(0)}refreshServiceMessages();lastTime=a}}else{lastTime=a}}function restartTimer(){var a=new Date();lastTime=a.getTime()}function refreshPage(item){restartTimer();testSite=false;if(item!==0){if(prevItem!==0){prevItem.removeClass("ui-btn-down-"+theme);prevItem.addClass("ui-btn-up-"+theme);prevItem.attr("data-theme",theme)}item.removeClass("ui-btn-up-"+theme);item.addClass("ui-btn-down-"+theme);item.attr("data-theme",theme);prevItem=item}if(lastClickType!==-1&&lastClickID!==-1){var restart=oldID!==lastClickID;oldID=lastClickID;if(restart){$("#dataList").hide()}switch(lastClickType){case 1:loadData("cgi/list.cgi",lastClickID,restart);break;case 2:loadVariables(restart);break;case 3:loadPrograms(restart);break;case 4:loadGraphicIDs();break;case 5:testSite=true;loadData("debug/debug.json","a",restart);break;case 6:testSite=true;loadData("debug/debug_cuxd.json","b",restart);break;case 7:loadOptions()}$(".evalScript").find("script").each(function(){var src=$(this).attr("src");if(src){$.getScript(src)}else{eval($(this).text())}})}}function refreshServiceMessages(){$("#buttonService .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");$.getJSON("cgi/service.cgi",function(b){$("#serviceList").empty();var a=0;$.each(b.entries,function(f,e){var k=e.name;var g=e.type;var j=e.device;var l=e.error;var d=e.value;var c=e.date;var h=getErrorMessage(g,l,d,j);$("#serviceList").append("<li><p class='ui-li-desc' style='text-align:right;'>"+c+"</p><h1>"+k+"</h1><p>"+h+"</p></li>");a+=1});if(webmaticVersion!==newWebmaticVersion){$("#serviceList").append("<li><p class='ui-li-desc' style='text-align:right;'>"+dateNow+"</p><h1>"+mapText("NEW_VERSION")+"</h1><p><span class='valueInfo valueInfo-"+theme+"'><a href='https://github.com/jens-maus/webmatic/releases' target='_blank' >Webmatic "+newWebmaticVersion+" "+mapText("DOWNLOAD")+"</a></span></p></li>");a+=1}$("#buttonService .ui-btn-text").text("("+a+")");if(a===0){$("#buttonService, #popupDiv").removeClass(function(d,c){return(c.match(/(^|\s)valueService-\S{1}/g)||[]).join(" ")});$("#headerButtonGroup").controlgroup("refresh",true);$("#serviceList").append("<li><p>"+mapText("NO_SERVICE_MESSAGES")+"</p></li>")}else{$("#buttonService, #popupDiv").addClass("valueService-"+theme);$("#headerButtonGroup").controlgroup("refresh",true)}$("#serviceList").listview("refresh",true)})}function removeMessages(){$.ajax("cgi/removemessages.cgi")}function changeTheme(a){$("body, .ui-popup-screen").removeClass(function(c,b){return(b.match(/(^|\s)ui-overlay-\S{1}/g)||[]).join(" ")}).addClass("ui-overlay-"+a);$(".ui-page").removeClass(function(c,b){return(b.match(/(^|\s)ui-page-theme-\S{1}/g)||[]).join(" ")}).addClass("ui-page-theme-"+a).attr("data-theme",a);$(".ui-header").removeClass(function(c,b){return(b.match(/(^|\s)ui-bar-\S{1}/g)||[]).join(" ")}).addClass("ui-bar-"+a).attr("data-theme",a);$(".ui-content").removeClass(function(c,b){return(b.match(/(^|\s)ui-body-\S{1}/g)||[]).join(" ")}).addClass("ui-body-"+a).attr("data-theme",a);$(".ui-collapsible-set, .ui-listview").removeClass(function(c,b){return(b.match(/(^|\s)ui-group-theme-\S{1}/g)||[]).join(" ")}).addClass("ui-group-theme-"+a).attr("data-theme",a);$(".ui-btn").removeClass(function(c,b){return(b.match(/(^|\s)ui-btn-\S{1}/g)||[]).join(" ")}).addClass("ui-btn-"+a).attr("data-theme",a);$(".valueNoError").removeClass(function(c,b){return(b.match(/(^|\s)valueNoError-\S{1}/g)||[]).join(" ")}).addClass("valueNoError-"+a);$(".valueInfo").removeClass(function(c,b){return(b.match(/(^|\s)valueInfo-\S{1}/g)||[]).join(" ")}).addClass("valueInfo-"+a);$(".valueWarning").removeClass(function(c,b){return(b.match(/(^|\s)valueWarning-\S{1}/g)||[]).join(" ")}).addClass("valueWarning-"+a);$(".valueError").removeClass(function(c,b){return(b.match(/(^|\s)valueError-\S{1}/g)||[]).join(" ")}).addClass("valueError-"+a);$(".valueOK").removeClass(function(c,b){return(b.match(/(^|\s)valueOK-\S{1}/g)||[]).join(" ")}).addClass("valueOK-"+a);$("#buttonService, #popupDiv").removeClass(function(c,b){return(b.match(/(^|\s)valueService-\S{1}/g)||[]).join(" ")}).addClass("valueService-"+a);$("img").removeClass(function(c,b){return(b.match(/(^|\s)ui-img-\S{1}/g)||[]).join(" ")}).addClass("ui-img-"+a);$(".control-set").removeClass(function(c,b){return(b.match(/(^|\s)control-set-\S{1}/g)||[]).join(" ")}).addClass("control-set-"+a);theme=a;localStorage.setItem("optionsMenuGfxTheme",theme)}function changeFont(c){var d="";var b="";switch(c){case"a":b="sans-serif";break;case"b":b="KochFraktur";d="themes/fonts/KochFraktur/KochFraktur.ttf";break;case"c":b="PlanetBenson";d="themes/fonts/Planet_benson/planetbe.ttf";break;case"d":b="ActionMan";d="themes/fonts/Action_Man/Action_Man.ttf";break;case"e":b="Amadeus";d="themes/fonts/Amadeus/Amadeus.ttf";break;case"f":b="Vamp";d="themes/fonts/Vamp/RIKY2vamp.ttf";break;case"g":b="HennyPenny";d="themes/fonts/HennyPenny/HennyPenny-Regular.otf";break;case"h":b="Kavoon";d="themes/fonts/Anglican/AnglicanText.ttf";break;case"i":b="Nosifer";d="themes/fonts/Nosifer/NosiferCaps-Regular.ttf";break;case"j":b="Pacifico";d="themes/fonts/Pacifico/Pacifico.ttf";break;case"k":b="Sixties";d="themes/fonts/Sixties/Sixties.ttf";break;case"l":b="Crackman";d="themes/fonts/Crackman/CRACKMAN.ttf";break}setFont=function(e){$("body, input, select, textarea, button, .ui-btn").css("font-family",e)};if($.inArray(c,loadedFont)===-1){var a=new Font();a.onload=function(){setFont(b)};a.fontFamily=b;a.src=d}else{setFont(b)}loadedFont.push(c);font=c;localStorage.setItem("optionsMenuGfxFont",font)}function addSetButton(d,b,h,f,g,j,a,e){var c="";if(!j){c+="<p class='ui-li-desc'>"}if(a){c+="<a href='#' data-value='"+f+"' data-role='button' class='ui-btn-active' data-inline='true' data-theme='"+theme+"'>"+h+"</a>"}else{c+="<a href='#' id='setButton_"+b+"' data-id='"+b+"' data-parent-id='"+d+"' data-refresh='"+e+"' data-value='"+f+"' data-role='button' data-inline='true'>"+h+"</a>"}if(!j){c+="<i>"+g+"</i> <span id='info_"+b+"' class='valueOK valueOK-"+theme+"'></span></p>"}return c}function addSetControlGroup(e,a,c,b,j,f,g,h){var d="";d+="<div data-role='controlgroup' data-type='horizontal'>";if(g){d+=g}d+=addSetButton(e,a,c,0,j,true,f===0,false);d+=addSetButton(e,a,"20%",0.2,j,true,f===0.2,false);d+=addSetButton(e,a,"40%",0.4,j,true,f===0.4,false);d+=addSetButton(e,a,"60%",0.6,j,true,f===0.6,false);d+=addSetButton(e,a,"80%",0.8,j,true,f===0.8,false);d+=addSetButton(e,a,b,1,j,true,f===1,false);if(h){d+=h}d+="</div>";return d}function addStartProgramButton(f,e,d,c,a){var b="<p class='ui-li-desc'><a href='#' "+(!a?"class='ui-link ui-btn ui-icon-gear ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-inline='true' data-icon='gear'")+" id='startProgramButton_"+e+"' data-parent-id='"+f+"' data-id='"+e+"'>"+d+"</a></div>";b+="<i>"+c+"</i> <span id='info_"+e+"' class='valueOK valueOK-"+theme+"'></span></p>";return b}function addSetNumber(e,a,k,l,c,h,b,g,j,f){var d="<div class='ui-field-contain'>";d+="<input type='range' value='"+k*g+"' min='"+c*g+"' max='"+h*g+"' step='"+b*g+"' data-factor='"+g+"' id='setValue_"+a+"' data-id='"+a+"' data-highlight='true' data-theme='"+theme+"'/>";d+=" ("+c*g+" - "+h*g+" <span id='unit_ "+a+"'>"+l+"</span>) ";d+="<a href='#' id='setNumberButton_"+a+"' data-parent-id='"+e+"' data-id='"+a+"' data-refresh='"+f+"' data-role='button' data-inline='true' data-icon='check'>"+mapText("SET")+"</a>";d+="<i class='ui-li-desc'>"+j+"</i> <span id='info_"+a+"' class='valueOK valueOK-"+theme+"'></span>";d+="</div>";return d}function addSetBoolButtonList(c,d,j,g,e,f,k,h){var b="<div data-role='fieldcontain'>";b+="<div data-role='controlgroup' data-type='horizontal'>";var a="";if(j==="false"||j===""){a="class='ui-btn-active'"}else{a="id='setButton_"+d+"' data-parent-id='"+c+"' data-id='"+d+"' data-refresh='"+h+"'"}b+="<a href='#' "+a+" data-value='false' data-role='button' data-inline='true' data-theme='"+theme+"'>"+g+"</a>";if(j==="true"){a="class='ui-btn-active'"}else{a="id='setButton_"+d+"' data-parent-id='"+c+"' data-id='"+d+"' data-refresh='"+h+"'"}b+="<a href='#' "+a+" data-value='true' data-role='button' data-inline='true' data-theme='"+theme+"'>"+e+"</a>";b+="</div>";b+="</div>";b+=" <span id='unit_ "+d+"'>"+f+"</span> ";b+="<i class='ui-li-desc'>"+k+"</i> <span id='info_"+d+"' class='valueOK valueOK-"+theme+"'></span>";return b}function addSetValueList(c,f,k,b,h,l,j){var d="<div data-role='fieldcontain'>";d+="<div data-role='controlgroup' data-type='horizontal'>";var g=parseInt(k);var e=b.split(";");for(var a=0;a<e.length;a++){if(g===a){d+="<a href='#' data-value='"+a+"' data-role='button' data-inline='true' class='ui-btn-active' data-theme='"+theme+"'>"+e[a]+"</a>"}else{d+="<a href='#' id='setButton_"+f+"' data-parent-id='"+c+"' data-id='"+f+"' data-refresh='"+j+"' data-value='"+a+"' data-role='button' data-inline='true'>"+e[a]+"</a>"}}d+="</div>";d+="</div>";d+=" <span id='unit_ "+f+"'>"+h+"</span> ";d+="<i class='ui-li-desc'>"+l+"</i> <span id='info_"+f+"' class='valueOK valueOK-"+theme+"'></span>";return d}function addSetText(f,c,d,e,b){var a="<div data-role='fieldcontain'>";d=d.replace(/\"/g,"&quot;");if(d.length>40){a+="<textarea id='setValue_"+c+"' data-parent-id='"+f+"' data-id='"+c+"' style='width:20em; display:inline-block;'>"+d+"</textarea>"}else{a+="<input type='text' id='setValue_"+c+"' data-parent-id='"+f+"' data-id='"+c+"' value=\""+d+"\" style='width:20em; display:inline-block;'/>"}a+=" <span id='unit_ "+c+"'>"+e+"</span> <a href='#' id='setTextButton_"+c+"' data-parent-id='"+f+"' data-id='"+c+"' data-role='button' data-inline='true' data-icon='check'>"+mapText("SET")+"</a>";a+="<i class='ui-li-desc'>"+b+"</i> <span id='info_"+c+"' class='valueOK valueOK-"+theme+"'></span>";a+="</div>";return a}function addHTML(f,d,e,c,a){var b="<div data-role='fieldcontain' class='"+(a?"":"ui-grid-a")+"'>";b+="<div class='evalScript"+(a?"":" ui-block-a")+"'>"+e+"</div>";if(!a){b+="<div class='ui-block-b'><textarea id='setValue_"+d+"' data-parent-id='"+f+"' data-id='"+d+"' style='width:20em; display:inline-block;'>"+e+"</textarea>";b+="<a href='#' id='setTextButton_"+d+"' data-parent-id='"+f+"' data-id='"+d+"' data-role='button' data-inline='true' data-icon='check'>"+mapText("SET")+"</a>";b+="<i class='ui-li-desc'>"+c+"</i> <span id='info_"+d+"' class='valueOK valueOK-"+theme+"'></span>";b+="</div>";b+="</div>"}return b}function addReadonlyVariable(e,j,k,c,g,b,h,f){var a="";if(c==="2"){if(j==="true"){a=f}else{a=h}}else{if(c==="4"){a=parseFloat(j)}else{if(c==="16"){var d=b.split(";");a=d[parseInt(j)]}else{a=j}}}if(c==="20"&&g==="html"){return addHTML("",e,j,k,true)}else{return"<p><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+a+" "+g+" </span></p><i class='ui-li-desc'>"+k+"</i>"}}function processVariable(c,g,b){var l=unescape(c.value);var f=c.valueType;var k=c.valueUnit;var d=c.valueList;var m=getTimeDiffString(c.date,b);var a=unescape(c.info);var j=c.valueName0;var h=c.valueName1;var e="<li class='dataListItem' id='"+g+"'><h2 class='ui-li-heading'>"+unescape(c.name)+"</h2>";e+="<p>"+a+"</p>";if(isReadOnly(a)){e+=addReadonlyVariable(g,l,m,f,k,d,j,h)}else{if(f==="2"){e+=addSetBoolButtonList("",g,l,j,h,k,m,true)}else{if(f==="4"){e+=addSetNumber("",g,l,k,c.valueMin,c.valueMax,0.001,1,m,true)}else{if(f==="16"){e+=addSetValueList("",g,l,d,k,m,true)}else{if(f==="20"&&k==="html"){e+=addHTML("",g,l,m,false)}else{if(f==="20"){e+=addSetText("",g,l,k,m)}else{e+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}e+="</li>";return e}function processProgram(e,c,b,d){var a="<li class='dataListItem' id='"+c+"'><h2 class='ui-li-heading'>"+e.name+"</h2><p>"+e.info+" "+(!d?"("+mapText("MANUAL")+")":"")+"</p>";a+=addStartProgramButton("",c,mapText("RUN"),getTimeDiffString(e.date,b),(e.operate==="true"||!readModus));a+="</li>";return a}function processGraphicID(d,f){var g={};$.each(f,function(j,k){var h="<li id='list"+j+"'>";h+="<div style='float: left; text-align: center;'>";h+="<img id='img"+j+"' class='ui-div-thumbnail ui-img-"+theme;if(k.pic){h+=" lazyLoadImage' data-original='../webmatic_user/img/ids/"+d+"/"+j+".png"}h+="' src='img/menu/"+d+".png'/>";h+="<a href='#' "+(!k.pic?"class='ui-btn ui-mini ui-icon-delete ui-btn-icon-left ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-mini='true' data-icon='delete'")+" name='deletePic' id='deletePic"+j+"' data-id='"+j+"' data-type='"+d+"'>"+mapText("DELETE")+"</a>";h+="<h1>(<a href='get.html?id="+j+"' target='_blank'>"+j+"</a>)</h1>";h+="</div>";h+="<form method='post' enctype='multipart/form-data' action='#' id='form"+j+"'>";h+="<div class='ui-grid-b'>";h+="<div class='ui-block-a'><input name='editName' data-id='"+j+"' data-type='"+d+"' type='text' value='"+k.name+"' /></div>";h+="<div class='ui-block-b'><input name='file' id='file"+j+"' type='file' accept='image/*' /></div>";h+="<div class='ui-block-c'><a href='#' name='uploadPicture' data-type='"+d+"' id='uploadPicture"+j+"' class='ui-link ui-btn ui-icon-check ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all ui-state-disabled'>"+mapText("UPLOAD")+"</a></div>";h+="<div class='ui-block-a small-hidden'></div>";h+="<div class='ui-block-b small-hidden'></div>";h+="<div class='ui-block-c'>";h+="<label>"+mapText("VISIBILITY")+":&nbsp;";h+="<input type='checkbox' data-role='flipswitch' name='editVisible' data-type='"+d+"' data-id='"+j+"' data-on-text='"+mapText("YES")+"' data-off-text='"+mapText("NO")+"' "+(k.visible?"checked":"")+"/>";h+="</label>";h+="</div>";h+="</div>";h+="</form>";h+="</li>";g[k.position]=h});var e=Object.keys(g).sort();var a=e.length;for(var c=0;c<a;c++){var b=e[c];$("#dataList").append(g[b])}}function getErrorMessage(c,d,f,b){var a="";if(c==="ALARMDP"){var e;if(d==="CONFIG_PENDING"||d==="STICKY_UNREACH"){e="Info"}else{if(d==="LOWBAT"){e="Warning"}else{e="Error"}}return"<span class='value"+e+" value"+e+"-"+theme+"'>"+mapText(c+"__"+d)+"</span>"}else{if(c==="HSSDP"){a=mapText(b+"__"+d+"__"+f);if(a!==""&&a!=="-"){return"<span class='valueError valueError-"+theme+"'>"+a+"</span>"}}}if(a===""){a="<span class='valueError valueError-"+theme+"'>"+mapText("UNKNOWN_ERROR")+": "+f+"</span>"}return a}function addDiagram(z){if(z.addDiagram){$("#dataList").listview("refresh");var B="l";var Z="69A5CF";var O="";var q="";var x=1;var S="0/#008800";var b="30/#AA4400";for(var X=0;X<z.varOptions.length;X++){var J=z.varOptions[X].split("=");if(J.length===2){if(J[0]==="t"){B=J[1]}else{if(J[0]==="c"){Z=J[1]}else{if(J[0]==="l"){O=J[1]}else{if(J[0]==="h"){q=J[1]}else{if(J[0]==="k"){x=parseInt(J[1])}else{if(J[0]==="s"){S=J[1]}else{if(J[0]==="e"){b=J[1]}}}}}}}}}if(z.varOptionsFirst==="g"){var m=parseFloat(z.diagramData);var R=S.split("/");var H=parseFloat(R[0]);var p=R[1];if(m<H){H=m}var g=b.split("/");var d=parseFloat(g[0]);var F=g[1];if(m>d){d=m}var a=parseInt(p.substring(1,3),16);var w=parseInt(p.substring(3,5),16);var Q=parseInt(p.substring(5,7),16);var T=parseInt(F.substring(1,3),16);var s=parseInt(F.substring(3,5),16);var o=parseInt(F.substring(5,7),16);var C=[];var U=[];var P=10;for(var X=1;X<=P;X++){var aa=X/P;var L=H+aa*(d-H);C.push(L);aa=(X-1)/(P-1);var A=Math.floor(a+aa*(T-a)).toString(16);if(A.length<2){A="0"+A}var E=Math.floor(w+aa*(s-w)).toString(16);if(E.length<2){E="0"+E}var I=Math.floor(Q+aa*(o-Q)).toString(16);if(I.length<2){I="0"+I}var ab="#"+A+E+I;U.push(ab)}var G=[z.diagramData];$.jqplot(z.diagramID,[G],{seriesDefaults:{renderer:$.jqplot.MeterGaugeRenderer,rendererOptions:{label:z.diagramData+" "+z.diagramUnit,labelPosition:"bottom",labelHeightAdjust:-5,min:H,max:d,intervals:C,intervalColors:U,smooth:true,animation:{show:true}}},grid:{backgroundColor:"transparent"}})}else{if(z.varOptionsFirst==="h"){var u=z.diagramData.split(";");var l=u[0];if(l>0){var n=new Array();n[0]=new Array();n[1]=new Array();n[2]=new Array();n[3]=new Array();n[4]=new Array();var W=0;var y;if(O===""){y=15}else{y=parseFloat(O)}var k;if(q===""){k=23}else{k=parseFloat(q)}var M="";var V="";for(var X=1;X<=l;X++){var N=u[X];var K=N.split(",");var ad=K[0];if(M===""||ad<M){M=ad}if(V===""||ad>V){V=ad}for(W=1;W<K.length;W++){var D=new Array();D[0]=ad;var ac=K[W];D[1]=ac;n[W-1][X-1]=D}}}$.jqplot(z.diagramID,[n[0],n[1],n[2],n[3],n[4]],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%a, %#d %#H:%M",angle:20},min:M,max:V},yaxis:{min:y,max:k,showLabel:true,tickOptions:{formatString:"%."+x+"f&deg;C"}},y2axis:{min:0,max:100,showLabel:true,tickOptions:{formatString:"%d%"}}},legend:{show:false,fontSize:23,placement:"outside",location:"e"},seriesDefaults:{lineWidth:2,showMarker:false,fill:false,shadow:false},series:[{label:"Soll",color:"#555555",fill:true,fillAlpha:0.1},{label:"Ist",color:"#DD0000"},{label:"relF%",color:"#0174DF",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis"}],highlighter:{show:true,sizeAdjust:5.5},cursor:{zoom:true,show:true},grid:{backgroundColor:"#F4F4F4"},animated:true})}else{if(B==="l"||B==="f"){u=z.diagramData.split(",");l=u.length;if(l>=3){n=new Array();W=0;y=1000000;k=-1000000;M="";V="";for(var X=1;X<l;X=X+2){ad=u[X];ac=u[X+1];var h=new Array();h[0]=ad;L;if(ac==="true"){L=1}else{if(ac==="false"){L=0}else{L=parseFloat(ac)}}h[1]=L;if(L<y){y=L}if(L>k){k=L}if(M===""||ad<M){M=ad}if(V===""||ad>V){V=ad}n[W]=h;W++}if(O===""){y=y-0.1*(k-y)}else{if(O==="m"){}else{var r=parseFloat(O);if(r<y){y=r}}}if(q===""){k=k+0.1*(k-y)}else{if(q==="m"){}else{var Y=parseFloat(q);if(Y>k){k=Y}}}var e;if(B==="l"){e=false}else{e=true}$.jqplot(z.diagramID,[n],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%b %#d, %#H:%M",angle:20},min:M,max:V},yaxis:{min:y,max:k,tickOptions:{formatString:"%."+x+"f"+z.diagramUnit}}},seriesDefaults:{rendererOptions:{smooth:true}},series:[{color:"#"+Z,lineWidth:2,showMarker:false,fill:e}],highlighter:{show:true,sizeAdjust:5.5},cursor:{show:false},grid:{backgroundColor:"#F4F4F4"},animated:true})}}}}}}function addChannel(c,a,n){var d=c.hssType;var l=c.id;var g=false;var m=[];m.deviceHTMLPostChannelGroup="";m.deviceHTMLPostChannelGroupMode=0;var k="";$.each(c.channels,function(H,T){g=true;var s=T.type;if(s==="HSSDP"){var L=T.id;var t=T.hssType;var G=T.date;var P=getTimeDiffString(G,a);var D=T.value;var q=parseFloat(T.value);var p=(D==="true");var r=mapUnit(T.valueUnit,t);var z=parseFloat(T.valueMin);var B=parseFloat(T.valueMax);if(t==="SETPOINT"||t==="SET_TEMPERATURE"){k+=addSetNumber(l,L,q,r,6,30,0.5,1,P,false);var E=q-3;var o=E+6;if(E<z){E=z;o=11}if(o>B){E=25;o=B}k+="<div data-role='controlgroup' data-type='horizontal'>";if(t==="SETPOINT"){k+=addSetButton(l,L,mapText(d+"__"+t+"__VENT_CLOSED"),0,P,true,0===q,false)}for(i=E;i<=o;i+=1){k+=addSetButton(l,L,i+r,i,P,true,i===q,false)}if(t==="SETPOINT"){k+=addSetButton(l,L,mapText(d+"__"+t+"__VENT_OPEN"),100,P,true,100===q,false)}k+="</div>"}else{if(d==="CLIMATECONTROL_RT_TRANSCEIVER"&&(t.endsWith("MODE")||t.startsWith("PARTY"))){if(t==="CONTROL_MODE"){m.deviceHTMLPostChannelGroupMode=q}else{if(t==="AUTO_MODE"){m.deviceHTMLPostChannelGroup+=addSetButton(l,L,mapText(d+"__"+t),true,P,true,m.deviceHTMLPostChannelGroupMode===0,true)}else{if(t==="MANU_MODE"){m.deviceHTMLPostChannelGroup+=addSetButton(l,L,mapText(d+"__"+t),true,P,true,m.deviceHTMLPostChannelGroupMode===1,true)}else{if(t==="BOOST_MODE"){m.deviceHTMLPostChannelGroup+=addSetButton(l,L,mapText(d+"__"+t),true,P,true,m.deviceHTMLPostChannelGroupMode===3,true)}else{if(t==="LOWERING_MODE"||t==="COMFORT_MODE"){m.deviceHTMLPostChannelGroup+=addSetButton(l,L,mapText(d+"__"+t),true,P,true,false,true)}else{if(t==="PARTY_TEMPERATURE"){m.PARTY_TEMPERATURE=q}else{if(t==="PARTY_START_TIME"){m.PARTY_START_TIME=parseInt(D)}else{if(t==="PARTY_START_DAY"){m.PARTY_START_DAY=parseInt(D)}else{if(t==="PARTY_START_MONTH"){m.PARTY_START_MONTH=parseInt(D)}else{if(t==="PARTY_START_YEAR"){m.PARTY_START_YEAR=parseInt(D)}else{if(t==="PARTY_STOP_TIME"){m.PARTY_STOP_TIME=parseInt(D)}else{if(t==="PARTY_STOP_DAY"){m.PARTY_STOP_DAY=parseInt(D)}else{if(t==="PARTY_STOP_MONTH"){m.PARTY_STOP_MONTH=parseInt(D)}else{if(t==="PARTY_STOP_YEAR"){m.PARTY_STOP_YEAR=parseInt(D)}else{if(t==="PARTY_MODE_SUBMIT"){m.PARTY_MODE_ID=L;m.VORDATE=P}}}}}}}}}}}}}}}}else{if(t==="PROGRAM"&&d==="RGBW_AUTOMATIC"){k+="<div data-role='controlgroup' data-type='horizontal'>";k+=addSetButton(l,L,mapText(d+"__"+t+"__0"),0,P,true,q===0,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__1"),1,P,true,q===1,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__2"),2,P,true,q===2,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__3"),3,P,true,q===3,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__4"),4,P,true,q===4,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__5"),5,P,true,q===5,true);k+=addSetButton(l,L,mapText(d+"__"+t+"__6"),6,P,true,q===6,true);k+="</div>"}else{if(t==="COLOR"&&d==="RGBW_COLOR"){k+="<span class='RGBW-Color'>";k+=addSetNumber(l,L,q,r,0,200,1,1,P,true);k+="</span>"}else{if(t==="LED_STATUS"&&d==="KEY"){switch(q){case 0:k+="<p><img class='ui-img-"+theme+"' src='img/channels/off_lamp.png' style='max-height:40px'> "+mapText(d+"__"+t+"__0")+" | <span><i>"+P+"</i></span></p>";break;case 1:k+="<p><img class='ui-img-"+theme+"' src='img/channels/red_lamp.png' style='max-height:40px'> "+mapText(d+"__"+t+"__1")+" | <span><i>"+P+"</i></span></p>";break;case 2:k+="<p><img class='ui-img-"+theme+"' src='img/channels/green_lamp.png' style='max-height:40px'> "+mapText(d+"__"+t+"__2")+" | <span><i>"+P+"</i></span></p>";break;case 3:k+="<p><img class='ui-img-"+theme+"' src='img/channels/orange_lamp.png' style='max-height:40px'> "+mapText(d+"__"+t+"__3")+" | <span><i>"+P+"</i></span></p>";break}}else{if(t==="LEVEL"&&d==="BLIND"){k+=addSetNumber(l,L,q,r,0,100,0.01,1,P+" | 0<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("CLOSE")+", 100<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("OPEN"),false);k+=addSetControlGroup(l,L,mapText("CLOSE_SHORT"),mapText("OPEN_SHORT"),P,q)}else{if(t==="LEVEL"&&d==="WINMATIC"){k+=addSetNumber(l,L,q,r,-0.005,100,0.01,1,P+" | -0.5<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("LOCKED")+", 0<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("CLOSE")+", 100<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("OPEN"),false);k+=addSetControlGroup(l,L,mapText("CLOSE_SHORT"),mapText("OPEN_SHORT"),P,q,addSetButton(l,L,mapText("LOCK"),-0.005,P,true,q===-0.005,false))}else{if(t==="LEVEL"&&(d==="DIMMER"||d==="VIRTUAL_DIMMER")){k+=addSetNumber(l,L,q,r,0,100,0.01,1,P+" | 0<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("OFF")+", 100<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("ON"),false);k+=addSetControlGroup(l,L,mapText("OFF"),mapText("ON"),P,q)}else{if(t==="FREQUENCY"&&d==="DIGITAL_ANALOG_OUTPUT"){k+=addSetNumber(l,L,q,r,0,50000,100,1,P+" | 0<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("MAX")+", 50000<span id='unit_ "+b+"'>"+r+"</span> = "+mapText("MIN"),false);k+="<div data-role='controlgroup' data-type='horizontal'>";k+=addSetButton(l,L,mapText("MAX"),0,P,true,q===0,true);k+=addSetButton(l,L,mapText("MED"),30000,P,true,q===30000,true);k+=addSetButton(l,L,mapText("MIN"),50000,P,true,q===50000,true);k+="</div>"}else{if(t==="SUBMIT"&&(d==="SIGNAL_LED"||d==="SIGNAL_CHIME")){}else{if(t==="ON_TIME"||t==="RAMP_TIME"){k+="<div class='ui-field-contain ui-grid-c'>";k+="<div class='ui-block-a'>";k+="<input type='text' data-role='datebox' data-duration-parent='"+l+"' data-id='"+L+'\' data-options=\'{"mode":"durationbox"}\'/>&nbsp;';k+="</div>";k+="<div class='ui-block-b grid-text'>";k+=mapText(d+"__"+t);k+="</div>";k+="</div>"}else{var C=mapInput(d,T,P,l);if(C!==""){k+=C}else{var F=mapState(t,d,q,p);if(F!=="Hide"){var K="";var S="&nbsp;";var J=1;if(F!==""){K="<span class='value"+F+" value"+F+"-"+theme+"'>"+mapText(d+"__"+t+"__"+D)+"&nbsp;<span id='unit_ "+b+"'>"+r+"</span></span>"}else{if(t==="VALUE"){K=D+" <span id='unit_ "+b+"'>"+r+"</span>"}else{if((t==="LEVEL"&&d==="AKKU")||(t==="BAT_LEVEL"&&d==="POWER")){J=100}S=mapText(d+"__"+t);var A=D;if(!isNaN(D)||J!==1){A=q*J}K=A+" <span id='unit_ "+b+"'>"+r+"</span>"}}if(S!=="-"){k+="<p class='ui-li-desc'>";k+="<img class='ui-img-"+theme+"' src='img/channels/"+mapImage(t)+"' style='max-height:20px'>";k+="<span class='valueInfo valueInfo-"+theme+"'>"+K+" </span>&nbsp;"+S+"&nbsp;|&nbsp;";k+="<span><i>"+P+"</i></span>";k+="</p>"}}}}}}}}}}}}}}}else{if(s==="VARDP"){var u=T.id;var x=unescape(T.info);var M=unescape(T.value);var I=T.valueType;r=T.valueUnit;var Q=T.valueName0;var O=T.valueName1;var w=T.valueList;G=T.date;P=getTimeDiffString(G,a);n.varOptionsFirst="";n.varOptions=[];var y=x.indexOf("(");if(y!==-1){var R=x.indexOf(")",y);if(R!==-1){var N=x.substring(y+1,R);n.varOptions=N.split(",");if(n.varOptions.length>=1){n.varOptionsFirst=n.varOptions[0].toLowerCase()}}}if(n.varOptionsFirst!=="nv"){k+="<br><h2 class='ui-li-heading'>"+unescape(T.name)+"</h2>";k+="<p>"+x+"</p>";if(isReadOnly(x)){k+=addReadonlyVariable(u,M,P,I,r,w,Q,O)}else{if(n.varOptionsFirst==="d"||n.varOptionsFirst==="dk"||n.varOptionsFirst==="g"||n.varOptionsFirst==="h"){n.addDiagram=true;if(n.varOptionsFirst==="dk"){n.diagramData=T.diagrams}else{n.diagramData=M}n.diagramID="chart_"+u;n.diagramUnit=r;if(n.varOptionsFirst==="g"){k+="<div id='"+n.diagramID+"' style='height:200px; width:300px;'></div> <i class='ui-li-desc'>"+P+"</i>"}else{k+="<div id='"+n.diagramID+"' style='height:300px; width:90%;'></div> <i class='ui-li-desc'>"+P+"</i>"}}else{if(I==="2"){k+=addSetBoolButtonList(l,u,M,Q,O,r,P,true)}else{if(I==="4"){k+=addSetNumber(l,u,M,r,z,B,0.001,1,P,true)}else{if(I==="16"){k+=addSetValueList(l,u,M,w,r,P,true)}else{if(I==="20"&&r==="html"){k+=addHTML(l,u,M,P,false)}else{if(I==="20"){k+=addSetText(l,u,M,r,P)}else{k+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}}}}}});if(m.deviceHTMLPostChannelGroup!==""){k+="<div data-role='controlgroup' data-type='horizontal'>";k+=m.deviceHTMLPostChannelGroup;k+="</div>";var b=m.PARTY_MODUS_ID;var f=[m.PARTY_START_YEAR+2000,m.PARTY_START_MONTH-1,m.PARTY_START_DAY];var e=m.PARTY_START_TIME*60;var j=[m.PARTY_STOP_YEAR+2000,m.PARTY_STOP_MONTH-1,m.PARTY_STOP_DAY];var h=m.PARTY_STOP_TIME*60;k+="<div class='ui-field-contain ui-grid-c control-set control-set-"+theme+"'>";k+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_TEMPERATURE")+"</div>";k+="<div class='ui-block-b'><input type='range' data-parent-id='"+l+"' value='"+m.PARTY_TEMPERATURE+"' min='5.0' max='30.0' step='0.5' data-factor='1' id='setTemperature_"+b+"' data-highlight='true' data-theme='"+theme+"'/></div>";k+="<div class='ui-block-c'></div>";k+="<div class='ui-block-d'></div>";k+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_START")+"</div>";k+="<div class='ui-block-b'><input type='text' data-parent-id='"+l+"' data-datebox-default-value='"+f+"' id='setStartDate_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='calbox' data-datebox-use-lang='de'/></div>";k+="<div class='ui-block-c'><input type='text' data-parent-id='"+l+"' data-datebox-default-value='"+e+"' id='setStartTime_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='timebox' data-datebox-minute-step='30' data-datebox-use-lang='de'/></div>";k+="<div class='ui-block-d'></div>";k+="<div class='ui-block-a grid-text'>"+mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_STOP")+"</div>";k+="<div class='ui-block-b'><input type='text' data-parent-id='"+l+"' data-datebox-default-value='"+j+"' id='setEndDate_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='calbox' data-datebox-use-lang='de'/></div>";k+="<div class='ui-block-c'><input type='text' data-parent-id='"+l+"' data-datebox-default-value='"+h+"' id='setEndTime_"+b+"' data-theme='"+theme+"' data-role='datebox' data-datebox-mode='timebox' data-datebox-minute-step='30' data-datebox-use-lang='de'/></div>";k+="<div class='ui-block-d'></div>";k+="<div class='ui-block-a'>"+addSetButton(l,b,mapText("CLIMATECONTROL_RT_TRANSCEIVER__PARTY_MODE"),"",m.VORDATE,true,m.deviceHTMLPostChannelGroupMode===2,true)+"</div>";k+="</div>"}else{if(!g){k=""}}return k}function log(a,b){if(debugModus){if(b===0){console.info(a)}else{if(b===1){console.warn(a)}else{if(b===2){console.error(a)}else{console.log(a)}}}}}function activateSettingSaveButton(){$('[name="saveAllChanges"]').removeClass("ui-state-disabled");mustBeSaved=true}function getDateFromString(d){var a=d.substring(0,2);var f=d.substring(3,5)-1;var e=d.substring(6,10);var c=d.substring(11,13);var b=d.substring(14,16);var g=d.substring(17,19);return new Date(e,f,a,c,b,g)}function loadConfigData(d,a,c,e,b,g,f){$.ajax({type:"GET",url:a,dataType:"json",async:d}).done(function(h){switch(c){case"config":if(!d){saveDataToFile=true;saveConfigFile(c,h,b,e,true)}else{optionsMap=h;localStorage.setItem(e,JSON.stringify(h))}break;case"variables":variablesMap=h;localStorage.setItem(e,JSON.stringify(h));break;case"programs":programsMap=h;localStorage.setItem(e,JSON.stringify(h));break;case"favorites":saveConfigFile(c,h,b,e,g);break;case"rooms":saveConfigFile(c,h,b,e,g);break;case"functions":saveConfigFile(c,h,b,e,g);break;case"devices":devicesMap=h;localStorage.setItem(e,JSON.stringify(h));break}if(typeof f==="function"){f(h)}}).fail(function(h,j){if(h.status===404){createConfigFile(c,e)}else{log("Request failed: "+j,2)}})}function saveConfigFile(f,e,d,g,h){if(h){var b={};if(f==="rooms"||f==="favorites"||f==="functions"){var c=0;$.each(e,function(j,l){c++;var k={};k.name=l;k.oldname=l;k.visible=true;k.pic=false;k.position=c;b[j]=k})}else{b=e}var a;switch(f){case"variables":a=variablesMap;break;case"programs":a=programsMap;break;case"favorites":a=favoritesMap;break;case"rooms":a=roomsMap;break;case"functions":a=functionsMap;break;case"devices":a=devicesMap;break}b=refreshJSONObj(f,b,d,a);localStorage.setItem(g,JSON.stringify(b));if(saveDataToFile){saveDataToFile=false;$.post("cgi/saveconfig.cgi",{name:f,text:JSON.stringify(b)})}}else{switch(f){case"variables":variablesMap=e;break;case"programs":programsMap=e;break;case"favorites":favoritesMap=e;break;case"rooms":roomsMap=e;break;case"functions":functionsMap=e;break;case"devices":devicesMap=e;break}}}function refreshJSONObj(e,d,c,a){if(e==="rooms"||e==="favorites"||e==="functions"){if(c){var b={};$.each(d,function(f,g){$.ajax({type:"GET",url:"../webmatic_user/img/ids/"+e+"/"+f+".png",async:false}).done(function(){g.pic=true}).fail(function(){g.pic=false});b[f]=g});d=b}else{var b={};$.each(d,function(f,h){if(f in a){var g=a[f];h.visible=g.visible;h.pic=g.pic;h.position=g.position;if(h.oldname===g.oldname){h.name=g.name}else{saveDataToFile=true}}b[f]=h});d=b}}else{if(e==="config"&&!c){d.storageVersion=storageVersion}}switch(e){case"config":optionsMap=d;break;case"variables":variablesMap=d;break;case"programs":programsMap=d;break;case"favorites":favoritesMap=d;break;case"rooms":roomsMap=d;break;case"functions":functionsMap=d;break;case"devices":devicesMap=d;break}return d}function createConfigFile(a,b){saveDataToFile=true;if(a==="config"){var c="{";c+='"storageVersion" : '+storageVersion+",";c+='"favorites" : true,';c+='"rooms" : true,';c+='"functions" : true,';c+='"variables" : true,';c+='"programs" : true,';c+='"others" : true,';c+='"collapsed" : "rooms",';c+='"systemvar_readonly" : true,';c+='"default_theme" : "a",';c+='"default_font" : "a"';c+="}";saveConfigFile(a,JSON.parse(c),true,b,true)}else{loadConfigData(false,"cgi/"+a+".cgi",a,b,true,true)}}function saveAllDatasToServer(){localStorage.setItem("webmaticFavoritesMap",JSON.stringify(favoritesMap));localStorage.setItem("webmaticRoomsMap",JSON.stringify(roomsMap));localStorage.setItem("webmaticFunctionsMap",JSON.stringify(functionsMap));$.post("cgi/saveconfig.cgi",{name:"favorites",text:JSON.stringify(favoritesMap)});$.post("cgi/saveconfig.cgi",{name:"rooms",text:JSON.stringify(roomsMap)});$.post("cgi/saveconfig.cgi",{name:"functions",text:JSON.stringify(functionsMap)});mustBeSaved=false;$('[name="saveAllChanges"]').addClass("ui-state-disabled")}function isReadOnly(b){if(!readModus){return false}var a="";var f=[];var c=b.indexOf("(");if(c!==-1){var d=b.indexOf(")",c);if(d!==-1){var e=b.substring(c+1,d);f=e.split(",");if(f.length>=1){a=f[0].toLowerCase()}}}if(a==="h"||a==="dk"||a==="d"||a==="g"){return false}if(optionsMap.systemvar_readonly&&readModus){return a!=="w"}return a==="r"}function isEmpty(b){for(var a in b){if(b.hasOwnProperty(a)){return false}}return true}function getTimeDiffString(b,c){var d=(getDateFromString(c)-getDateFromString(b))/1000;var a;if(d<0){return""}else{if(d<60){a=Math.floor(d+0.5);return mapText("TIME_PREFIX")+" "+a+" "+(a===1?mapText("TIME_SEC_SINGULAR"):mapText("TIME_SEC_PLURAL"))+" "+mapText("TIME_SUFFIX")}else{if(d<60*60){a=Math.floor(d/60+0.5);return mapText("TIME_PREFIX")+" "+a+" "+(a===1?mapText("TIME_MIN_SINGULAR"):mapText("TIME_MIN_PLURAL"))+" "+mapText("TIME_SUFFIX")}else{if(d<60*60*24){a=Math.floor(d/(60*60)+0.5);return mapText("TIME_PREFIX")+" "+a+" "+(a===1?mapText("TIME_H_SINGULAR"):mapText("TIME_H_PLURAL"))+" "+mapText("TIME_SUFFIX")}else{if(d<60*60*24*30.5){a=Math.floor(d/(60*60*24)+0.5);return mapText("TIME_PREFIX")+" "+a+" "+(a===1?mapText("TIME_DAY_SINGULAR"):mapText("TIME_DAY_PLURAL"))+" "+mapText("TIME_SUFFIX")}else{if(d<60*60*24*30.5*12){a=Math.floor(d/(60*60*24*30.5)+0.5);return mapText("TIME_PREFIX")+" "+a+" "+(a===1?mapText("TIME_MON_SINGULAR"):mapText("TIME_MON_PLURAL"))+" "+mapText("TIME_SUFFIX")}else{a=Math.floor(d/(60*60*24*30.5*12)+0.5);if(a<40){return mapText("TIME_PREFIX")+" "+a+" "+(a===1?mapText("TIME_Y_SINGULAR"):mapText("TIME_Y_PLURAL"))+" "+mapText("TIME_SUFFIX")}}}}}}}return""}function buttonEvents(a,c){var e=a.data("id");var j="?id="+e;var h="info_"+e;var g=a.data("value");if(typeof g==="undefined"){var b="setValue_"+e;g=$("#"+b).val();var d=$("#"+b).data("factor");if(typeof d!=="undefined"){j+="&value="+(parseFloat(g)/d)}else{j+="&value="+g}}else{j+="&value="+g}var f=0;var k=$("[data-duration-parent='"+a.data("parent-id")+"']");k.each(function(l){var m=$(this).datebox("getLastDur");if(!isNaN(m)){f=m>f?m:f;j+="&durationId"+l+"="+k.data("id")+"&durationValue"+l+"="+m}});if(testSite){j+="&debug=true"}$("#"+h).text(mapText("TRANSFER"));$.get("cgi/set.cgi"+j,function(){if(c){$("#"+h).text(mapText("TRANSFER_OK"));refreshPage(0)}else{$("#"+h).text(mapText("DELAY"))}if(f>0){setTimeout(function(){refreshPage(0)},(f+3)*1000)}})}function reloadList(a,c,b,d){$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+a+"<p style='float:right;'>"+c+"</p></li>");if(d!==""){$("#dataListHeader").append("<li class='description'>"+d+"</li>")}$("#dataListHeader").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create");if(b){$("#dataList").fadeIn()}}function processDevices(o,d,b){var q="<li class='dataListItem' id='"+o.id+"'><h2 class='ui-li-heading'>"+unescape(o.name)+"</h2>";if(o.type==="CHANNEL"){q+=addChannel(o,d,b)}else{if(o.type==="VARDP"){var c=o.id;var g=unescape(o.info);var r=unescape(o.value);var p=o.valueType;var a=o.valueUnit;var v=o.valueName0;var u=o.valueName1;var h=o.valueMin;var m=o.valueMax;var f=o.valueList;var n=o.date;var t=getTimeDiffString(n,d);b.varOptionsFirst="";b.varOptions=[];var j=g.indexOf("(");if(j!==-1){var w=g.indexOf(")",j);if(w!==-1){var s=g.substring(j+1,w);b.varOptions=s.split(",");if(b.varOptions.length>=1){b.varOptionsFirst=b.varOptions[0].toLowerCase()}}}q+="<p>"+g+"</p>";if(isReadOnly(g)){q+=addReadonlyVariable(c,r,t,p,a,f,v,u)}else{if(b.varOptionsFirst==="d"||b.varOptionsFirst==="dk"||b.varOptionsFirst==="g"||b.varOptionsFirst==="h"){b.addDiagram=true;if(b.varOptionsFirst==="dk"){b.diagramData=o.diagrams}else{b.diagramData=r}b.diagramID="chart_"+c;b.diagramUnit=a;if(b.varOptionsFirst==="g"){q+="<div id='"+b.diagramID+"' style='height:200px; width:300px;'></div> <i class='ui-li-desc'>"+t+"</i>"}else{q+="<div id='"+b.diagramID+"' style='height:300px; width:90%;'></div> <i class='ui-li-desc'>"+t+"</i>"}}else{if(b.varOptionsFirst==="nv"){q=""}else{if(p==="2"){q+=addSetBoolButtonList("",c,r,v,u,a,t,true)}else{if(p==="4"){q+=addSetNumber("",c,r,a,h,m,0.001,1,t,true)}else{if(p==="16"){q+=addSetValueList("",c,r,f,a,t,true)}else{if(p==="20"&&a==="html"){q+=addHTML("",c,r,t,false)}else{if(p==="20"){q+=addSetText("",c,r,a,t)}else{q+=mapText("UNKNOWN_VAR_TYPE")+"!"}}}}}}}}}else{if(o.type==="PROGRAM"){var l=o.id;var e=o.info;var k=o.date;t=getTimeDiffString(k,d);q+="<p>"+e+"</p>";q+=addStartProgramButton("",l,mapText("RUN"),t,o.operate==="true")}}}if(q!==""){q+="</li>"}return q}function loadData(b,e,a){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var d=false;if(a){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticDevicesMap"+e)===null){if(newVersion){saveDataToFile=true}loadConfigData(false,b+"?list="+e,"devices","webmaticDevicesMap"+e,false,true);d=true}else{devicesMap=JSON.parse(localStorage.getItem("webmaticDevicesMap"+e))}var c=devicesMap.date;$.each(devicesMap.entries,function(h,j){var f=new Object();f.addDiagram=false;f.diagramData="";f.diagramID="";f.diagramUnit="";f.varOptions={};f.varOptionsFirst="";if(j.visible!=="false"){var g=processDevices(j,c,f);if(g!==""){$("#dataList").append(g)}}addDiagram(f)});reloadList(devicesMap.name,c,a,devicesMap.description)}if(!d){loadConfigData(true,b+"?list="+e,"devices","webmaticDevicesMap"+e,false,true,function(g){var f=g.date;$.each(g.entries,function(l,m){var j=new Object();j.addDiagram=false;j.diagramData="";j.diagramID="";j.diagramUnit="";j.varOptions={};j.varOptionsFirst="";var k=processDevices(m,f,j);if(k!==""){var n=m.visible!=="false";var h=m.id;if($("#"+h).length===0&&n){$("#dataList").append(k)}else{if(n){$("#"+h).replaceWith(k)}else{if($("#"+h).length!==0){$("#"+h).remove()}}}}addDiagram(j)});reloadList(g.name,f,a,g.description)})}$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change");$("[id^=button]").trigger("create");$("[id^=input]").trigger("create");$("textarea").textinput("refresh")}function loadVariables(a){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var c=false;if(a){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticVariablesMap")===null){if(newVersion){saveDataToFile=true}loadConfigData(false,"cgi/systemvariables.cgi","variables","webmaticVariablesMap",false,true);c=true}else{variablesMap=JSON.parse(localStorage.getItem("webmaticVariablesMap"))}var b=variablesMap.date;$.each(variablesMap.entries,function(e,d){var g=d.visible==="true";var f=d.id;if((readModus&&g)||!readModus){$("#dataList").append(processVariable(d,f,b))}});reloadList(mapText("SYS_VAR"),b,a,"")}if(!c){loadConfigData(true,"cgi/systemvariables.cgi","variables","webmaticVariablesMap",false,true,function(e){var d=e.date;$.each(e.entries,function(g,f){var j=f.visible==="true";var h=f.id;if($("#"+h).length===0&&((readModus&&j)||!readModus)){$("#dataList").append(processVariable(f,h,d))}else{if((readModus&&j)||!readModus){$("#"+h).replaceWith(processVariable(f,h,d))}else{if($("#"+h).length!==0){$("#"+h).remove()}}}});reloadList(mapText("SYS_VAR"),d,a,"")})}$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change");$("textarea").textinput("refresh")}function loadPrograms(a){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var c=false;if(a){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");if(localStorage.getItem("webmaticProgramsMap")===null){if(newVersion){saveDataToFile=true}loadConfigData(false,"cgi/programs.cgi","programs","webmaticProgramsMap",false,true);c=true}else{programsMap=JSON.parse(localStorage.getItem("webmaticProgramsMap"))}var b=programsMap.date;$.each(programsMap.entries,function(f,h){var e=h.visible==="true";var d=h.active==="true";var g=h.id;if((readModus&&e)||!readModus){$("#dataList").append(processProgram(h,g,b,d))}});reloadList(mapText("PROGRAMS"),b,a,"");$("#dataList").find(".btnDisabled").button("disable")}if(!c){loadConfigData(true,"cgi/programs.cgi","programs","webmaticProgramsMap",false,true,function(e){var d=e.date;$.each(e.entries,function(h,k){var g=k.visible==="true";var f=k.active==="true";var j=k.id;if($("#"+j).length===0&&((readModus&&g)||!readModus)){$("#dataList").append(processProgram(k,j,d,f))}else{if((readModus&&g)||!readModus){$("#"+j).replaceWith(processProgram(k,j,d,f))}else{if($("#"+j).length!==0){$("#"+j).remove()}}}});reloadList(mapText("PROGRAMS"),d,a,"");$("#dataList").find(".btnDisabled").button("disable")})}$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change")}function loadGraphicIDs(){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>"+mapText("LOADING")+"...</li>").listview("refresh");$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");$("#dataList").append("<li sytle='text-align:center;'><a href='#' "+(!mustBeSaved?"class='ui-btn ui-btn-inline ui-icon-check ui-btn-icon-left ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-inline='true' data-icon='check'")+" name='saveAllChanges'>"+mapText("SAVE")+"</a></li>");if(localStorage.getItem("webmaticFavoritesMap")===null){if(newVersion){saveDataToFile=true}loadConfigData(false,"../webmatic_user/favorites.json","favorites","webmaticFavoritesMap",false,false)}else{favoritesMap=JSON.parse(localStorage.getItem("webmaticFavoritesMap"))}loadConfigData(true,"cgi/favorites.cgi","favorites","webmaticFavoritesMap",false,true);$("#dataList").append("<li data-role='list-divider' role='heading'>"+mapText("FAVORITES")+"</li>");processGraphicID("favorites",favoritesMap);if(localStorage.getItem("webmaticRoomsMap")===null){if(newVersion){saveDataToFile=true}loadConfigData(false,"../webmatic_user/rooms.json","rooms","webmaticRoomsMap",false,false)}else{roomsMap=JSON.parse(localStorage.getItem("webmaticRoomsMap"))}loadConfigData(true,"cgi/rooms.cgi","rooms","webmaticRoomsMap",false,true);$("#dataList").append("<li data-role='list-divider' role='heading'>"+mapText("ROOMS")+"</li>");processGraphicID("rooms",roomsMap);if(localStorage.getItem("webmaticFunctionsMap")===null){if(newVersion){saveDataToFile=true}loadConfigData(false,"../webmatic_user/functions.json","functions","webmaticFunctionsMap",false,false)}else{functionsMap=JSON.parse(localStorage.getItem("webmaticFunctionsMap"))}loadConfigData(true,"cgi/functions.cgi","functions","webmaticFunctionsMap",false,true);$("#dataList").append("<li data-role='list-divider' role='heading'>"+mapText("FUNCTIONS")+"</li>");processGraphicID("functions",functionsMap);$("#dataList").append("<li sytle='text-align:center;'><a href='#' "+(!mustBeSaved?"class='ui-btn ui-btn-inline ui-icon-check ui-btn-icon-left ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-inline='true' data-icon='check'")+" name='saveAllChanges'>"+mapText("SAVE")+"</a></li>");$("#dataList").listview("refresh");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly");$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+mapText("EDIT")+"</li>");$("#dataListHeader").listview("refresh");$("#buttonRefresh .ui-btn-text").html("&nbsp;");$("#dataList").listview("refresh");$("#dataList").trigger("create").fadeIn()}function loadOptions(){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+mapText("OPTIONS")+"</li>");var b="<li><h1>"+mapText("GRAPHICS_SIZE")+"</h1><p><div data-role='fieldcontain'>";b+="<div data-role='controlgroup' data-type='horizontal'>";var d=localStorage.getItem("optionsMenuGfxSize");var a="";var e="";if(!d||d===""||d==="large"){e="class='ui-btn-active'"}else{a="class='ui-btn-active'"}b+="<a href='#' id='optionsMenuGfxSizeSmall' data-id='optionsMenuGfxSizeSmall' data-role='button' data-inline='true' "+a+">"+mapText("SMALL")+"</a>";b+="<a href='#' id='optionsMenuGfxSizeLarge' data-id='optionsMenuGfxSizeLarge' data-role='button' data-inline='true' "+e+">"+mapText("BIG")+"</a>";b+="</div></li>";$("#dataList").append(b);b="<li><h1>"+mapText("SHOW_TEST")+"</h1><p><div data-role='fieldcontain'>";var c=localStorage.getItem("optionsMenuShowTestpages");if(!c||c===""||c==="false"){a="";e="class='ui-btn-active'"}else{a="class='ui-btn-active'";e=""}b+="<div data-role='controlgroup' data-type='horizontal'>";b+="<a href='#' id='optionsMenuShowTestpages' data-id='optionsMenuShowTestpages' data-role='button' data-inline='true' "+a+">"+mapText("SHOW")+"</a>";b+="<a href='#' id='optionsMenuHideTestpages' data-id='optionsMenuHideTestpages' data-role='button' data-inline='true' "+e+">"+mapText("HIDE")+"</a>";b+="</div></li>";$("#dataList").append(b);b="<li><h1>Theme auswählen</h1><p><div data-role='fieldcontain'>";b+="<div data-role='controlgroup' data-type='horizontal'>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='a' class='"+(theme==="a"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("DEFAULT")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='b' class='"+(theme==="b"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("BLACK")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='c' class='"+(theme==="c"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("PINK")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='d' class='"+(theme==="d"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("GREEN")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='e' class='"+(theme==="e"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("YELLOW")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='f' class='"+(theme==="f"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("GREY")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='g' class='"+(theme==="g"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("BLUE")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='h' class='"+(theme==="h"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("RED")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='i' class='"+(theme==="i"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("BROWN")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='j' class='"+(theme==="j"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("WHITE")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='k' class='"+(theme==="k"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("BRAZIL")+"</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='l' class='"+(theme==="l"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>"+mapText("GERMANY")+"</a>";b+="</div><br/><br/><br/>";b+="<div data-role='controlgroup' data-type='horizontal'>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='a' class='"+(font==="a"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Normal</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='b' class='"+(font==="b"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Koch Fraktur</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='c' class='"+(font==="c"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Planet Benson</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='d' class='"+(font==="d"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Action Man</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='e' class='"+(font==="e"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Amadeus</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='f' class='"+(font==="f"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Vamp</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='g' class='"+(font==="g"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>HennyPenny</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='h' class='"+(font==="h"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Anglican</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='i' class='"+(font==="i"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Nosifer</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='j' class='"+(font==="j"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Pacifico</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='k' class='"+(font==="k"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Sixties</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='l' class='"+(font==="l"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Crackman</a>";b+="</div></li>";$("#dataList").append(b);b="<li><h1>WebMatic neu laden, damit alle Einstellungen wirksam werden</h1><p><div data-role='fieldcontain'>";b+="<a href='#' id='reloadWebMatic' data-id='reloadWebMatic' data-role='button' data-inline='true'>Neu laden</a>";b+="</li>";$("#dataList").append(b);$("#dataListHeader").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create").fadeIn()}$(function(){$(document).bind("mobileinit",function(){$.mobile.listview.prototype.options.filterPlaceholder=mapText("FILTER")});$(document.body).on("click","[id^=setButton]",function(){var a=$(this);buttonEvents(a,a.data("refresh"))});$(document.body).on("click","[id^=setNumberButton]",function(){var a=$(this);buttonEvents(a,a.data("refresh"))});$(document.body).on("click","[id^=setBoolButton]",function(){buttonEvents($(this),true)});$(document.body).on("click","[id^=setValueListButton]",function(){buttonEvents($(this),true)});$(document.body).on("click","[id^=setTextButton]",function(){var b=$(this).data("id");var a="setValue_"+b;var d="info_"+b;var e=$("#"+a).val();e=e.replace(/\"/g,"'");e=encodeURIComponent(e);var c="";if(testSite){c+="&debug=true"}$("#"+d).text(mapText("TRANSFER"));$.get("cgi/set.cgi?id="+b+"&value="+e+c,function(){$("#"+d).text(mapText("TRANSFER_OK"));refreshPage(0)})});$(document.body).on("click","[id^=startProgramButton]",function(){var a=$(this).data("id");var c="info_"+a;var b="";if(testSite){b+="&debug=true"}$("#"+c).text("START");$.get("cgi/startprogram.cgi?id="+a+b,function(){$("#"+c).text(mapText("TRANSFER_OK"))})});$(document.body).on("click","[name='deletePic']",function(){var b=$(this);var a=b.data("type");var c=b.data("id");$.get("cgi/delete.cgi?type="+a+"&name="+c,function(){$("#img"+c).fadeOut(500,function(){$("#img"+c).attr("src","img/menu/"+a+".png").fadeIn(1000)});$("#menuImg"+c).fadeOut(500,function(){$("#menuImg"+c).attr("src","img/menu/"+a+".png").fadeIn(1000)});switch(a){case"favorites":favoritesMap[c]["pic"]=false;break;case"rooms":roomsMap[c]["pic"]=false;break;case"functions":functionsMap[c]["pic"]=false;break}b.addClass("ui-state-disabled")})});$(document.body).on("change","[name='editVisible']",function(){var c=$(this);var d=c.data("id");var a=c.data("type");var b=c.prop("checked");if(b){$("#"+d).fadeIn(1000)}else{$("#"+d).fadeOut(1000)}switch(a){case"favorites":favoritesMap[d]["visible"]=b;break;case"rooms":roomsMap[d]["visible"]=b;break;case"functions":functionsMap[d]["visible"]=b;break}activateSettingSaveButton()});$(document.body).on("click","[name='saveAllChanges']",function(){saveAllDatasToServer()});$(document.body).on("change","[name='editName']",function(){var c=$(this);var d=c.data("id");var a=c.val();var b=c.data("type");switch(b){case"favorites":favoritesMap[d]["name"]=a;break;case"rooms":roomsMap[d]["name"]=a;break;case"functions":functionsMap[d]["name"]=a;break}$("#menuText"+d).fadeOut(500,function(){$("#menuText"+d).text(a).fadeIn(1000)});activateSettingSaveButton()});$(document.body).on("change",":file",function(){var b=this.files[0];if(b.name.length<1){}else{if(b.type!=="image/png"&&b.type!=="image/jpg"&&!b.type!=="image/gif"&&b.type!=="image/jpeg"){$.mobile.alert(mapText("IMAGE_UPLOAD"))}else{var c=$(this).attr("id");var a=c.substr(4,c.length);$("#uploadPicture"+a).removeClass("ui-state-disabled")}}});$(document.body).on("click","a[name=uploadPicture]",function(){var f=$(this).attr("id");var c=f.substr(13,f.length);var d=$(this).data("type");var e=new FormData();var b=document.getElementById("file"+c).files[0];var a=new FileReader();a.onloadend=function(){var g=new Image();g.src=a.result;g.onload=function(){var n=160;var j=160;var q=g.width;var k=g.height;if(q>k){if(q>n){k*=n/q;q=n}}else{if(k>j){q*=j/k;k=j}}var l=document.createElement("canvas");l.width=q;l.height=k;var v=l.getContext("2d");v.drawImage(this,0,0,q,k);var m=l.toDataURL("image/png");var u=atob(m.split(",")[1]);var o=new ArrayBuffer(u.length);var t=new Uint8Array(o);for(var p=0;p<u.length;p++){t[p]=u.charCodeAt(p)&255}var h;try{h=new Blob([o],{type:"image/png"})}catch(r){var s=new (window.WebKitBlobBuilder||window.MozBlobBuilder);s.append(o);h=s.getBlob("image/png")}$("#img"+c).fadeOut(500,function(){$("#img"+c).attr("src",m).fadeIn(1000)});$("#menuImg"+c).fadeOut(500,function(){$("#menuImg"+c).attr("src",m).fadeIn(1000)});switch(d){case"favorites":favoritesMap[c]["pic"]=true;break;case"rooms":roomsMap[c]["pic"]=true;break;case"functions":functionsMap[c]["pic"]=true;break}e.append("file",h,c+".png");e.append("filename",c+".png");e.append("path","/usr/local/etc/config/addons/www/webmatic_user/img/ids/"+d+"/");$.ajax({url:"cgi/upload.cgi",type:"POST",data:e,cache:false,contentType:false,processData:false},"json")};$("#uploadPicture"+c).addClass("ui-state-disabled");$("#deletePic"+c).removeClass("ui-state-disabled")};a.readAsDataURL(b)});$(window).on("beforeunload",function(){if(mustBeSaved){saveAllDatasToServer()}})});