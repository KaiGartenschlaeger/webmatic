
var oldType=-1;var lastClickType=-1;var lastClickID=-1;var readModus=false;var prevItem=0;var programsMap,functionsMap,roomsMap,favoritesMap,variablesMap,optionsMap;var theme,font;var loadedFont=["a"];var refreshTimer=setInterval(function(){CheckRefreshPage()},1000);var lastTime=-1;if(localStorage.getItem("webmaticOptionsMap")===null){$.ajax({type:"GET",url:"../webmatic_user/config.json",dataType:"json",success:function(a){optionsMap=a;localStorage.setItem("webmaticOptionsMap",JSON.stringify(a))},async:false})}else{optionsMap=JSON.parse(localStorage.getItem("webmaticOptionsMap"))}if(localStorage.getItem("optionsMenuGfxTheme")===null){theme=optionsMap.default_theme;localStorage.setItem("optionsMenuGfxTheme",theme)}else{theme=localStorage.getItem("optionsMenuGfxTheme")}if(theme==="undefined"||$.inArray(theme,["a","b","c","d","e","f","g","h","i","j","k","l"])===-1){theme="a"}if(localStorage.getItem("optionsMenuGfxFont")===null){font=optionsMap.default_font;localStorage.setItem("optionsMenuGfxFont",font)}else{font=localStorage.getItem("optionsMenuGfxFont")}if(font==="undefined"||$.inArray(font,["a","b","c","d","e","f","g","h","i","j","k","l"])===-1){font="a"}function CheckRefreshPage(){var b=new Date();var a=b.getTime();if(lastTime!==-1){if(a-lastTime>60000){if(lastClickType!==4&&lastClickType!==7){RefreshPage(0,true)}RefreshServiceMessages();lastTime=a}}else{lastTime=a}}function RestartTimer(){var a=new Date();lastTime=a.getTime()}function RefreshPage(item,saveScrollPos){RestartTimer();if(item!==0){if(prevItem!==0){prevItem.removeClass("ui-btn-down-"+theme);prevItem.addClass("ui-btn-up-"+theme);prevItem.attr("data-theme",theme)}item.removeClass("ui-btn-up-"+theme);item.addClass("ui-btn-down-"+theme);item.attr("data-theme",theme);prevItem=item}if(lastClickType!==-1&&lastClickID!==-1){var oldScrollPos=-1;if(saveScrollPos){oldScrollPos=$(window).scrollTop()}var restart=oldType!==lastClickType;oldType=lastClickType;switch(lastClickType){case 1:loadData("cgi/list.cgi?list="+lastClickID,oldScrollPos);break;case 2:loadVariables(restart);break;case 3:loadPrograms(restart);break;case 4:loadGraphicIDs();break;case 5:loadData("debug/debug.json",oldScrollPos);break;case 6:loadData("debug/debug_cuxd.json",oldScrollPos);break;case 7:loadOptions()}$("#prim").find("script").each(function(){var src=$(this).attr("src");if(src){$.getScript(src)}else{eval($(this).text())}})}}function RefreshServiceMessages(){$("#buttonService .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");$.getJSON("cgi/service.cgi",function(b){$("#serviceList").empty();var a=0;$.each(b.entries,function(f,e){var k=e.name;var g=e.type;var j=e.device;var l=e.error;var d=e.value;var c=e.date;var h=GetErrorMessage(g,l,d,j);$("#serviceList").append("<li><p class='ui-li-desc' style='text-align:right;'>"+c+"</p><h1>"+k+"</h1><p>"+h+"</p></li>");a+=1});$("#buttonService .ui-btn-text").text("("+a+")");if(a===0){$("#buttonService, #popupDiv").removeClass(function(d,c){return(c.match(/(^|\s)valueService-\S{1}/g)||[]).join(" ")});$("#headerButtonGroup").controlgroup("refresh",true);$("#serviceList").append("<li><p>Keine Servicemeldungen vorhanden.</p></li>")}else{$("#buttonService, #popupDiv").addClass("valueService-"+theme);$("#headerButtonGroup").controlgroup("refresh",true)}$("#serviceList").listview().listview("refresh",true)})}function RemoveMessages(){$.getJSON("cgi/removemessages.cgi",function(){})}function changeTheme(a){$("body, .ui-popup-screen").removeClass(function(c,b){return(b.match(/(^|\s)ui-overlay-\S{1}/g)||[]).join(" ")}).addClass("ui-overlay-"+a);$(".ui-page").removeClass(function(c,b){return(b.match(/(^|\s)ui-page-theme-\S{1}/g)||[]).join(" ")}).addClass("ui-page-theme-"+a).attr("data-theme",a);$(".ui-header").removeClass(function(c,b){return(b.match(/(^|\s)ui-bar-\S{1}/g)||[]).join(" ")}).addClass("ui-bar-"+a).attr("data-theme",a);$(".ui-content").removeClass(function(c,b){return(b.match(/(^|\s)ui-body-\S{1}/g)||[]).join(" ")}).addClass("ui-body-"+a).attr("data-theme",a);$(".ui-collapsible-set, .ui-listview").removeClass(function(c,b){return(b.match(/(^|\s)ui-group-theme-\S{1}/g)||[]).join(" ")}).addClass("ui-group-theme-"+a).attr("data-theme",a);$(".ui-btn").removeClass(function(c,b){return(b.match(/(^|\s)ui-btn-\S{1}/g)||[]).join(" ")}).addClass("ui-btn-"+a).attr("data-theme",a);$(".valueNoError").removeClass(function(c,b){return(b.match(/(^|\s)valueNoError-\S{1}/g)||[]).join(" ")}).addClass("valueNoError-"+a);$(".valueInfo").removeClass(function(c,b){return(b.match(/(^|\s)valueInfo-\S{1}/g)||[]).join(" ")}).addClass("valueInfo-"+a);$(".valueWarning").removeClass(function(c,b){return(b.match(/(^|\s)valueWarning-\S{1}/g)||[]).join(" ")}).addClass("valueWarning-"+a);$(".valueError").removeClass(function(c,b){return(b.match(/(^|\s)valueError-\S{1}/g)||[]).join(" ")}).addClass("valueError-"+a);$(".valueOK").removeClass(function(c,b){return(b.match(/(^|\s)valueOK-\S{1}/g)||[]).join(" ")}).addClass("valueOK-"+a);$("#buttonService, #popupDiv").removeClass(function(c,b){return(b.match(/(^|\s)valueService-\S{1}/g)||[]).join(" ")}).addClass("valueService-"+a);$("img").removeClass(function(c,b){return(b.match(/(^|\s)ui-img-\S{1}/g)||[]).join(" ")}).addClass("ui-img-"+a);theme=a;localStorage.setItem("optionsMenuGfxTheme",theme)}function changeFont(c){var d="";var b="";switch(c){case"a":b="sans-serif";break;case"b":b="KochFraktur";d="themes/fonts/KochFraktur/KochFraktur.ttf";break;case"c":b="PlanetBenson";d="themes/fonts/Planet_benson/planetbe.ttf";break;case"d":b="ActionMan";d="themes/fonts/Action_Man/Action_Man.ttf";break;case"e":b="Amadeus";d="themes/fonts/Amadeus/Amadeus.ttf";break;case"f":b="Vamp";d="themes/fonts/Vamp/RIKY2vamp.ttf";break;case"g":b="HennyPenny";d="themes/fonts/HennyPenny/HennyPenny-Regular.otf";break;case"h":b="Kavoon";d="themes/fonts/Anglican/AnglicanText.ttf";break;case"i":b="Nosifer";d="themes/fonts/Nosifer/NosiferCaps-Regular.ttf";break;case"j":b="Pacifico";d="themes/fonts/Pacifico/Pacifico.ttf";break;case"k":b="Sixties";d="themes/fonts/Sixties/Sixties.ttf";break;case"l":b="Crackman";d="themes/fonts/Crackman/CRACKMAN.ttf";break}setFont=function(e){$("body, input, select, textarea, button, .ui-btn").css("font-family",e)};if($.inArray(c,loadedFont)===-1){var a=new Font();a.onload=function(){setFont(b)};a.fontFamily=b;a.src=d}else{setFont(b)}loadedFont.push(c);font=c;localStorage.setItem("optionsMenuGfxFont",font)}function AddSetButton(h,f,e,d,g,a,c){var b="";if(!g){b+="<p class='ui-li-desc'>"}if(a){b+="<a href='#' data-value='"+e+"' data-role='button' data-inline='true' data-theme='"+theme+"'>"+f+"</a>"}else{b+="<a href='#' id='setButton_"+h+"' data-id='"+h+"' data-refresh='"+c+"' data-value='"+e+"' data-role='button' data-inline='true'>"+f+"</a>"}if(!g){b+="<i>"+d+"</i> <span id='info_"+h+"' class='valueOK valueOK-"+theme+"'></span></p>"}return b}function AddStartProgramButton(e,d,c,a){var b="<p class='ui-li-desc'><a href='#' "+(!a?"class='ui-link ui-btn ui-icon-gear ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all ui-state-disabled'":"data-role='button' data-inline='true' data-icon='gear'")+" id='startProgramButton_"+e+"' data-id='"+e+"'>"+d+"</a></div>";b+="<i>"+c+"</i> <span id='info_"+e+"' class='valueOK valueOK-"+theme+"'></span></p>";return b}function AddSetNumber(a,h,j,c,g,b,f,i,e){var d="<div data-role='fieldcontain'>";d+="<input type='range' value='"+h*f+"' min='"+c*f+"' max='"+g*f+"' step='"+b*f+"' data-factor='"+f+"' id='setValue_"+a+"' data-id='"+a+"' data-highlight='true' data-theme='"+theme+"'/>";d+=" ("+c*f+" - "+g*f+" "+j+") ";d+="<a href='#' id='setNumberButton_"+a+"' data-id='"+a+"' data-refresh='"+e+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";d+="<i class='ui-li-desc'>"+i+"</i> <span id='info_"+a+"' class='valueOK valueOK-"+theme+"'></span>";d+="</div>";return d}function AddSetBoolButtonList(c,h,f,d,e,i,g){var b="<div data-role='fieldcontain'>";b+="<div data-role='controlgroup' data-type='horizontal'>";var a="";if(h==="false"||h===""){a="class='ui-btn-active'"}else{a="id='setButton_"+c+"' data-id='"+c+"' data-refresh='"+g+"'"}b+="<a href='#' "+a+" data-value='false' data-role='button' data-inline='true' data-theme='"+theme+"'>"+f+"</a>";if(h==="true"){a="class='ui-btn-active'"}else{a="id='setButton_"+c+"' data-id='"+c+"' data-refresh='"+g+"'"}b+="<a href='#' "+a+" data-value='true' data-role='button' data-inline='true' data-theme='"+theme+"'>"+d+"</a>";b+="</div>";b+="</div>";b+=" "+e+" ";b+="<i class='ui-li-desc'>"+i+"</i> <span id='info_"+c+"' class='valueOK valueOK-"+theme+"'></span>";return b}function AddSetBoolComboBox(d,f,e,c,g,b){var a="<div data-role='fieldcontain'>";a+="<select id='setValue_"+d+"' data-id='"+d+"' data-native-menu='false' data-inline='true'>";if(f==="true"){a+="<option value='false'>"+e+"</option><option selected value='true'>"+c+"</option>"}else{a+="<option selected value='false'>"+e+"</option><option value='true'>"+c+"</option>"}a+="</select>";a+=" "+g+" <a href='#' id='setBoolButton_"+d+"' data-id='"+d+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";a+="<i class='ui-li-desc'>"+b+"</i> <span id='info_"+d+"' class='valueOK valueOK-"+theme+"'></span>";a+="</div>";return a}function AddSetBoolSwitch(d,f,e,c,g,b){var a="<div data-role='fieldcontain'>";a+="<div class='longerFlip'><select id='setValue_"+d+"' data-id='"+d+"' data-role='slider'>";if(f==="true"){a+="<option value='false'>"+e+"</option><option selected value='true'>"+c+"</option>"}else{a+="<option selected value='false'>"+e+"</option><option value='true'>"+c+"</option>"}a+="</select></div>";a+=" "+g+" <a href='#' id='setBoolButton_"+d+"' data-id='"+d+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";a+="<i class='ui-li-desc'>"+b+"</i> <span id='info_"+d+"' class='valueOK valueOK-"+theme+"'></span>";a+="</div>";return a}function AddSetValueList(e,j,b,g,k,h){var c="<div data-role='fieldcontain'>";c+="<div data-role='controlgroup' data-type='horizontal'>";var f=parseInt(j);var d=b.split(";");for(var a=0;a<d.length;a++){if(f===a){c+="<a href='#' data-value='"+a+"' data-role='button' data-inline='true' class='ui-btn-active' data-theme='"+theme+"'>"+d[a]+"</a>"}else{c+="<a href='#' id='setButton_"+e+"' data-id='"+e+"' data-refresh='"+h+"' data-value='"+a+"' data-role='button' data-inline='true'>"+d[a]+"</a>"}}c+="</div>";c+="</div>";c+=" "+g+" ";c+="<i class='ui-li-desc'>"+k+"</i> <span id='info_"+e+"' class='valueOK valueOK-"+theme+"'></span>";return c}function AddSetText(c,d,e,b){var a="<div data-role='fieldcontain'>";d=d.replace(/\"/g,"&quot;");if(d.length>40){a+="<textarea id='setValue_"+c+"' data-id='"+c+"' style='width:20em; display:inline-block;'>"+d+"</textarea>"}else{a+="<input type='text' id='setValue_"+c+"' data-id='"+c+"' value=\""+d+"\" style='width:20em; display:inline-block;'/>"}a+=" "+e+" <a href='#' id='setTextButton_"+c+"' data-id='"+c+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";a+="<i class='ui-li-desc'>"+b+"</i> <span id='info_"+c+"' class='valueOK valueOK-"+theme+"'></span>";a+="</div>";return a}function AddHTML(d,e,c,a){var b="<div data-role='fieldcontain' class='"+(a?"":"ui-grid-a")+"'>";b+="<div class='"+(a?"":"ui-block-a")+"'>"+e+"</div>";if(!a){b+="<div class='ui-block-b'><textarea id='setValue_"+d+"' data-id='"+d+"' style='width:20em; display:inline-block;'>"+e+"</textarea>";b+="<a href='#' id='setTextButton_"+d+"' data-id='"+d+"' data-role='button' data-inline='true' data-icon='check'>Setzen</a>";b+="<i class='ui-li-desc'>"+c+"</i> <span id='info_"+d+"' class='valueOK valueOK-"+theme+"'></span>";b+="</div>";b+="</div>"}return b}function AddReadonlyVariable(e,i,j,c,g,b,h,f){var a="";if(c==="2"){if(i==="true"){a=f}else{a=h}}else{if(c==="4"){a=parseFloat(i)}else{if(c==="16"){var d=b.split(";");a=d[parseInt(i)]}else{a=i}}}if(c==="20"&&g==="html"){return AddHTML(e,i,j,true)}else{return"<p><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+a+" "+g+" </span></p><i class='ui-li-desc'>"+j+"</i>"}}function processVariable(c,g,b){var k=unescape(c.value);var f=c.valueType;var j=c.valueUnit;var d=c.valueList;var l=GetTimeDiffString(c.date,b);var a=unescape(c.info);var i=c.valueName0;var h=c.valueName1;var e="<li class='dataListItem' id='"+g+"'><h2 class='ui-li-heading'>"+unescape(c.name)+"</h2>";e+="<p>"+a+"</p>";if(isReadOnly(a)){e+=AddReadonlyVariable(g,k,l,f,j,d,i,h)}else{if(f==="2"){e+=AddSetBoolButtonList(g,k,i,h,j,l,true)}else{if(f==="4"){e+=AddSetNumber(g,k,j,c.valueMin,c.valueMax,0.001,1,l,true)}else{if(f==="16"){e+=AddSetValueList(g,k,d,j,l,true)}else{if(f==="20"&&j==="html"){e+=AddHTML(g,k,l,false)}else{if(f==="20"){e+=AddSetText(g,k,j,l)}else{e+="Unbekannter Variablentyp!"}}}}}}e+="</li>";return e}function processProgram(d,c,b){var a="<li class='dataListItem' id='"+c+"'><h2 class='ui-li-heading'>"+d.name+"</h2><p>"+d.info+"</p>";a+=AddStartProgramButton(c,"Ausf&uuml;hren",GetTimeDiffString(d.date,b),d.operate==="true");a+="</li>";return a}function processGraphicID(a,b){$.each(b,function(d,e){var c="<li>";c+="<img id='img"+d+"' class='lazyLoadImage ui-li-thumbnail ui-img-"+theme+"' data-original='../webmatic_user/img/ids/"+a+"/"+d+".png' src='img/menu/"+a+".png'/>";c+="<form method='post' enctype='multipart/form-data' action='#' id='form"+d+"'>";c+="<div class='ui-grid-b'>";c+="<div class='ui-block-a'><h1>"+e+" (<a href='get.html?id="+d+"' target='_blank'>"+d+"</a>)</h1></div>";c+="<div class='ui-block-b'><input name='file' id='file"+d+"' type='file' accept='image/*' /></div>";c+="<div class='ui-block-c'><a href='#' name='uploadPicture' data-type='"+a+"' id='uploadPicture"+d+"' class='ui-link ui-btn ui-icon-check ui-btn-icon-left ui-btn-inline ui-shadow ui-corner-all ui-state-disabled'>Speichern</a></div>";c+="</div>";c+="</form>";c+="</li>";$("#dataList").append(c)})}function GetDateFromString(d){var a=d.substring(0,2);var f=d.substring(3,5)-1;var e=d.substring(6,10);var c=d.substring(11,13);var b=d.substring(14,16);var g=d.substring(17,19);return new Date(e,f,a,c,b,g)}function isReadOnly(b){if(!readModus){return false}var a="";var f=[];var c=b.indexOf("(");if(c!==-1){var d=b.indexOf(")",c);if(d!==-1){var e=b.substring(c+1,d);f=e.split(",");if(f.length>=1){a=f[0].toLowerCase()}}}if(optionsMap.systemvar_readonly&&readModus){return a!=="w"}return a==="r"}function GetTimeDiffString(a,b){var d=(GetDateFromString(b)-GetDateFromString(a))/1000;if(d<60){return"Vor "+Math.floor(d+0.5)+" Sekunde/n"}else{if(d<60*60){return"Vor "+Math.floor(d/60+0.5)+" Minute/n"}else{if(d<60*60*24){return"Vor "+Math.floor(d/(60*60)+0.5)+" Stunde/n"}else{if(d<60*60*24*30.5){return"Vor "+Math.floor(d/(60*60*24)+0.5)+" Tag/en"}else{if(d<60*60*24*30.5*12){return"Vor "+Math.floor(d/(60*60*24*30.5)+0.5)+" Monat/en"}else{var c=Math.floor(d/(60*60*24*30.5*12)+0.5);if(c>40){return"Noch nicht ver&auml;ndert"}else{return"Vor "+c+" Jahr/en"}}}}}}}function GetErrorMessage(d,e,f,c){var b=false;var a="";if(d==="ALARMDP"){if(e==="CONFIG_PENDING"){return"<span class='valueInfo valueInfo-"+theme+"'>Konfigurationsdaten werden &uuml;bertragen</span>"}if(e==="LOWBAT"){return"<span class='valueWarning valueWarning-"+theme+"'>Batteriestand niedrig</span>"}if(e==="STICKY_UNREACH"){return"<span class='valueInfo valueInfo-"+theme+"'>Kommunikation war gest&ouml;rt</span>"}if(e==="UNREACH"){return"<span class='valueError valueError-"+theme+"'>Kommunikation zur Zeit gest&ouml;rt</span>"}}else{if(d==="HSSDP"){if(e==="LOWBAT"){a="Batterie leer"}else{if(e==="ERROR"){if(c==="CLIMATECONTROL_VENT_DRIVE"){if(f===1){a="Ventilantrieb schwerg&auml;ngig oder blockiert"}else{if(f===2){a="Ventilantrieb nicht montiert oder Stellbereich zu gro&szlig;"}else{if(f===3){a="Stellbereich zu klein"}else{if(f===4){a="St&iuml;rungsposition angefahren, Batterien nahezu entladen"}}}}}else{if(c==="DIMMER"||c==="VIRTUAL_DIMMER"){if(f>=1){a="Lastfehler"}}else{if(c==="KEYMATIC"){if(f===1){a="Einkuppeln fehlgeschlagen"}else{if(f===2){a="Motorlauf abgebrochen"}}}else{if(c==="WINMATIC"){if(f===1){a="Fehler Drehantrieb"}else{if(f===2){a="Fehler Kippantrieb"}}}else{if(c==="ROTARY_HANDLE_SENSOR"||c==="SHUTTER_CONTACT"||c==="MOTION_DETECTOR"){if(f>=1){a="Sabotage ausgel&ouml;st"}}}}}}}else{if(e==="STATE"){if(c==="SMOKE_DETECTOR_TEAM"){if(f==="true"){a="Rauch erkannt"}}else{if(c==="SENSOR_FOR_CARBON_DIOXIDE"){if(f===1){a="CO<sub>2</sub> Konzentration erh&ouml;ht"}if(f>=2){a="CO<sub>2</sub> Konzentration stark erh&ouml;ht"}}else{if(c==="WATERDETECTIONSENSOR"){if(f===1){a="Feucht"}if(f===2){a="Nass"}}}}}else{if(e==="ERROR_REDUCED"){if(f){a="Reduzierte Leistung"}else{b=true}}else{if(e==="ERROR_OVERLOAD"){if(f){a="Strom-&Uuml;berlastung"}else{b=true}}else{if(e==="ERROR_OVERHEAT"){if(f){a="&Uuml;berhitzung"}else{b=true}}else{if(e==="ERROR_POWER"){if(!f){a="Netzspannung fehlerhaft"}else{b=true}}else{if(e==="ERROR_SABOTAGE"){if(!f){a="Sabotage ausgel&ouml;st"}else{b=true}}else{if(e==="ERROR_BATTERY"){if(!f){a="Batterie fehlerhaft"}else{b=true}}}}}}}}}}if(a!==""){a="<span class='valueError valueError-"+theme+"'>"+a+"</span>"}}}if(a===""&&!b){a="<span class='valueError valueError-"+theme+"'>Unbekannter Fehler: "+f+"</span>"}return a}function reloadList(a,b){$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+a+"<p style='float:right;'>"+b+"</p></li>").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create")}function ScrollToContentHeader(){$("html, body").animate({scrollTop:$("#prim").offset().top-60},200)}function ScrollToPosition(a){$("html, body").animate({scrollTop:a},200)}function loadData(a,b){if(b===-1){ScrollToContentHeader()}$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>Lade...</li>");$("#dataListHeader").listview("refresh");$("#buttonRefresh .ui-btn-text").html("<img src='img/misc/wait16.gif' class='ui-img-"+theme+"' width=12px height=12px>");$.getJSON(a,function(d){var c=d.date;$.each(d.entries,function(V,at){if(at.visible!=="false"){var G="<li class='dataListItem' id='"+at.id+"'><h2 class='ui-li-heading'>"+unescape(at.name)+"</h2>";var aj=false;var s="";var k="";var aB="";var J={};var ar="";if(at.type==="CHANNEL"){var B=at.hssType;var ad=false;$.each(at.channels,function(aZ,bc){ad=true;var aL=bc.type;if(aL==="HSSDP"){var a4=bc.id;var aM=bc.hssType;var aY=bc.date;var a8=GetTimeDiffString(aY,c);var aW=bc.value;var t=parseFloat(bc.value);var i=(aW==="true");var al=bc.valueUnit;if(typeof(al)==="undefined"){al=""}else{if(al==="100%"){al="%"}}if(aM==="STATE"){var aK="";var a3="";var aV="";var a2=false;var a1="valFloat: "+t+", valString: "+aW;if(B==="SHUTTER_CONTACT"){if(aW==="true"){a1="<span class='valueError valueError-"+theme+"'>Offen</span>"}else{a1="<span class='valueOK valueOK-"+theme+"'>Geschlossen</span>"}}else{if(B==="SMOKE_DETECTOR_TEAM"){if(aW==="true"){a1="<span class='valueError valueError-"+theme+"'>Rauch erkannt</span>"}else{a1="<span class='valueOK valueOK-"+theme+"'>Kein Rauch erkannt</span>"}}else{if(B==="SENSOR_FOR_CARBON_DIOXIDE"){if(t===0){a1="<span class='valueOK valueOK-"+theme+"'>CO<sub>2</sub> Konzentration normal</span>"}if(t===1){a1="<span class='valueWarning valueWarning-"+theme+"'>CO<sub>2</sub> Konzentration erh&ouml;ht</span>"}if(t>=2){a1="<span class='valueError valueError-"+theme+"'>CO<sub>2</sub> Konzentration stark erh&ouml;ht</span>"}}else{if(B==="TILT_SENSOR"){if(aW==="true"){a1="<span class='valueWarning valueWarning-"+theme+"'>Offen</span>"}else{a1="<span class='valueOK valueOK-"+theme+"'>Geschlossen</span>"}}else{if(B==="WATERDETECTIONSENSOR"){if(t===0){a1="<span class='valueOK valueOK-"+theme+"'>Trocken</span>"}if(t===1){a1="<span class='valueWarning valueWarning-"+theme+"'>Feucht</span>"}if(t===2){a1="<span class='valueError valueError-"+theme+"'>Nass</span>"}}else{if(B==="ROTARY_HANDLE_SENSOR"){if(t===0){a1="<span class='valueOK valueOK-"+theme+"'>Geschlossen</span>"}if(t===1){a1="<span class='valueWarning valueWarning-"+theme+"'>Gekippt</span>"}if(t===2){a1="<span class='valueError valueError-"+theme+"'>Offen</span>"}}else{if(B==="KEYMATIC"){a2=true;aK="Auf";a3="Zu"}else{if(B==="SWITCH"){a2=true;aK="Ein";a3="Aus"}else{if(B==="ALARMACTUATOR"){a2=true;aK="Ein";a3="Aus"}else{if(B==="DIGITAL_OUTPUT"){a2=true;aK="Ein";a3="Aus"}else{if(B==="DIGITAL_ANALOG_OUTPUT"){a2=true;aK="Ein";a3="Aus"}else{if(B==="DIGITAL_INPUT"){if(t==="true"){a1="Ein"}else{a1="Aus"}}else{if(t==="true"){a1="Aus"}else{a1="Ein"}}}}}}}}}}}}}if(a2){G+=AddSetBoolButtonList(bc.id,aW,a3,aK,"",a8,true)}else{G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+a1+" </span><span><i>"+a8+"</i></span></p>"}}else{if(aM==="VALUE"){G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+aW+" "+al+" </span> <span><i>"+a8+"</i></span></p>"}else{if(aM==="SENSOR"&&B==="SENSOR"){if(aW==="true"){a1="<span class='valueError valueError-"+theme+"'>Offen</span>"}else{a1="<span class='valueOK valueOK-"+theme+"'>Geschlossen</span>"}G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+a1+" </span><span><i>"+a8+"</i></span></p>"}else{if(aM==="PRESS_SHORT"){G+=AddSetButton(bc.id,"Kurzer Tastendruck",true,a8,false,false,true)}else{if(aM==="PRESS_LONG"){G+=AddSetButton(bc.id,"Langer Tastendruck",true,a8,false,false,true)}else{if(aM==="SETPOINT"){G+=AddSetNumber(a4,t,al,6,30,0.5,1,a8,false);var aX=t-3;var f=aX+6;if(aX<6){aX=6;f=11}if(f>30){aX=25;f=30}G+="<div data-role='controlgroup' data-type='horizontal'>";for(V=aX;V<=f;V+=1){G+=AddSetButton(a4,V+al,V,a8,true,V===t,false)}G+="</div>"}else{if(aM==="RAINING"){var aU="";if(aW==="true"){aU="Regen"}else{aU="Kein Regen"}G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+aU+"</span> | <span><i>"+a8+"</i></span></p>"}else{if(aM==="MOTION"){if(aW==="true"){aV="<span class='valueWarning valueWarning-"+theme+"'>Bewegung </span>"}else{aV="<span class='valueOK valueOK-"+theme+"'>Keine Bewegung </span>"}G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+aV+"<span><i>"+a8+"</i></span></p>"}else{if(aM==="LEVEL"&&B==="BLIND"){G+=AddSetNumber(a4,t,al,0,1,0.01,100,a8+" | 0% = Geschlossen, 100% = Offen",false);G+="<div data-role='controlgroup' data-type='horizontal'>";G+=AddSetButton(a4,"Zu",0,a8,true,t===0,false);G+=AddSetButton(a4,"20%",0.2,a8,true,t===0.2,false);G+=AddSetButton(a4,"40%",0.4,a8,true,t===0.4,false);G+=AddSetButton(a4,"60%",0.6,a8,true,t===0.6,false);G+=AddSetButton(a4,"80%",0.8,a8,true,t===0.8,false);G+=AddSetButton(a4,"Auf",1,a8,true,t===1,false);G+="</div>"}else{if(aM==="STOP"&&B==="BLIND"){G+=AddSetButton(a4,"Stop",true,a8,false,false,false)}else{if(aM==="OPEN"&&B==="KEYMATIC"){G+=AddSetButton(a4,"&Ouml;ffnen",true,a8,false,false,true)}else{if(aM==="LEVEL"&&B==="WINMATIC"){G+=AddSetNumber(a4,t,al,-0.005,1,0.01,100,a8+" | -0.5 = Verriegelt, 0% = Geschlossen, 100% = Offen",false);G+="<div data-role='controlgroup' data-type='horizontal'>";G+=AddSetButton(a4,"Verriegeln",-0.005,a8,true,t===-0.005,false);G+=AddSetButton(a4,"Zu",0,a8,true,t===0,false);G+=AddSetButton(a4,"20%",0.2,a8,true,t===0.2,false);G+=AddSetButton(a4,"40%",0.4,a8,true,t===0.4,false);G+=AddSetButton(a4,"60%",0.6,a8,true,t===0.6,false);G+=AddSetButton(a4,"80%",0.8,a8,true,t===0.8,false);G+=AddSetButton(a4,"Auf",1,a8,true,t===1,false);G+="</div>"}else{if(aM==="STOP"&&B==="WINMATIC"){G+=AddSetButton(a4,"Stop",true,a8,false,false,false)}else{if(aM==="LEVEL"&&B==="AKKU"){G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+t*100+" "+al+" </span>Batterieladung | <span><i>"+a8+"</i></span></p>"}else{if(aM==="LEVEL"&&(B==="DIMMER"||B==="VIRTUAL_DIMMER")){G+=AddSetNumber(a4,t,al,0,1,0.01,100,a8+" | 0% = Aus, 100% = An",false);G+="<div data-role='controlgroup' data-type='horizontal'>";G+=AddSetButton(a4,"Aus",0,a8,true,t===0,false);G+=AddSetButton(a4,"20%",0.2,a8,true,t===0.2,false);G+=AddSetButton(a4,"40%",0.4,a8,true,t===0.4,false);G+=AddSetButton(a4,"60%",0.6,a8,true,t===0.6,false);G+=AddSetButton(a4,"80%",0.8,a8,true,t===0.8,false);G+=AddSetButton(a4,"An",1,a8,true,t===1,false);G+="</div>"}else{if(aM==="U_SOURCE_FAIL"&&B==="POWER"){if(aW==="false"){aV="<span class='valueNoError valueNoError-"+theme+"'>Netzbetrieb</span>"}else{aV="<span class='valueError valueError-"+theme+"'>Batteriebetrieb</span>"}G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+aV+" <span><i>"+a8+"</i></span></p>"}else{if(aM==="LOWBAT"&&B==="POWER"){if(aW==="false"){aV="<span class='valueOK valueOK-"+theme+"'>Batterie OK</span>"}else{aV="<span class='valueError valueError-"+theme+"'>Batterie leer</span>"}G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+aV+" <span><i>"+a8+"</i></span></p>"}else{if(aM==="U_USBD_OK"&&B==="POWER"){if(aW==="false"){aV="<span class='valueNoError valueNoError-"+theme+"'>USB nicht aktiv</span>"}else{aV="<span class='valueOK valueOK-"+theme+"'>USB aktiv</span>"}G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+aV+" <span><i>"+a8+"</i></span></p>"}else{if(aM==="BAT_LEVEL"&&B==="POWER"){G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+t*100+" "+al+" </span>Batterieladung | <span><i>"+a8+"</i></span></p>"}else{if(aM==="STATUS"&&B==="AKKU"){if(t===0){aV="<span class='valueNoError valueNoError-"+theme+"'>Erhaltungsladung</span>"}else{if(t===1){aV="<span class='valueNoError valueNoError-"+theme+"'>Akku l&auml;dt</span>"}else{if(t===2){aV="<span class='valueNoError valueNoError-"+theme+"'>Versorgung durch Akku</span>"}else{aV="<span class='valueWarning valueWarning-"+theme+"'>Status unbekannt</span>"}}}G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+aV+" <span><i>"+a8+"</i></span></p>"}else{if(aM==="STATE_UNCERTAIN"){if(aW==="true"){aV="<span class='valueWarning valueWarning-"+theme+"'>Zustand unbestimmt</span>"}else{aV="<span class='valueNoError valueNoError-"+theme+"'>Zustand OK</span>"}G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:30px'>"+aV+" <span><i>"+a8+"</i></span></p>"}else{if(aM==="LED_STATUS"){switch(t){case 0:G+="<p><img class='ui-img-"+theme+"' src='img/channels/off_lamp.png' style='max-height:40px'> Status | <span><i>"+a8+"</i></span></p>";break;case 1:G+="<p><img class='ui-img-"+theme+"' src='img/channels/red_lamp.png' style='max-height:40px'> Status | <span><i>"+a8+"</i></span></p>";break;case 2:G+="<p><img class='ui-img-"+theme+"' src='img/channels/green_lamp.png' style='max-height:40px'> Status | <span><i>"+a8+"</i></span></p>";break;case 3:G+="<p><img class='ui-img-"+theme+"' src='img/channels/orange_lamp.png' style='max-height:40px'> Status | <span><i>"+a8+"</i></span></p>";break}}else{if(aM==="ERROR"||aM.substring(0,6)==="ERROR_"){if((aM==="ERROR"&&t>0)||aM.substring(0,6)==="ERROR_"){var aS;if(aM==="ERROR"){aS=t}else{aS=i}aV=GetErrorMessage("HSSDP",aM,aS,B);if(aV!==""){G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/unknown.png' style='max-height:20px'>"+aV+" <span><i>"+a8+"</i></span></p>"}}}else{if(aM==="ON_TIME"||aM==="INHIBIT"||aM==="ADJUSTING_COMMAND"||aM==="ADJUSTING_DATA"||aM==="RELOCK_DELAY"||aM==="SPEED"||aM==="LEVEL"||aM==="RAMP_STOP"||aM==="RAMP_TIME"||aM==="OLD_LEVEL"){}else{var bb=MapText(aM);aS=aW;if(!isNaN(aW)){aS=t}if(bb!=="-"){G+="<p class='ui-li-desc'><img class='ui-img-"+theme+"' src='img/channels/"+MapImage(aM)+"' style='max-height:20px'><span class='valueInfo valueInfo-"+theme+"'>"+aS+" "+al+" </span>"+bb+" | <span><i>"+a8+"</i></span></p>"}}}}}}}}}}}}}}}}}}}}}}}}}}else{if(aL==="VARDP"){var aN=bc.id;var aP=unescape(bc.info);var a5=unescape(bc.value);var a0=bc.valueType;al=bc.valueUnit;var a9=bc.valueName0;var a7=bc.valueName1;var aR=bc.valueMin;var aT=bc.valueMax;var aO=bc.valueList;aY=bc.date;a8=GetTimeDiffString(aY,c);ar="";J=[];var aQ=aP.indexOf("(");if(aQ!==-1){var ba=aP.indexOf(")",aQ);if(ba!==-1){var a6=aP.substring(aQ+1,ba);J=a6.split(",");if(J.length>=1){ar=J[0].toLowerCase()}}}if(ar!=="nv"){G+="<br><h2 class='ui-li-heading'>"+unescape(bc.name)+"</h2>";G+="<p>"+aP+"</p>";if(isReadOnly(aP)){G+=AddReadonlyVariable(aN,a5,a8,a0,al,aO,a9,a7)}else{if(ar==="d"||ar==="dk"||ar==="g"||ar==="h"){aj=true;if(ar==="dk"){s=bc.diagrams}else{s=a5}k="chart_"+aN;aB=al;if(ar==="g"){G+="<div id='"+k+"' style='height:200px; width:300px;'></div> <i class='ui-li-desc'>"+a8+"</i>"}else{G+="<div id='"+k+"' style='height:300px; width:90%;'></div> <i class='ui-li-desc'>"+a8+"</i>"}}else{if(a0==="2"){G+=AddSetBoolButtonList(aN,a5,a9,a7,al,a8,true)}else{if(a0==="4"){G+=AddSetNumber(aN,a5,al,aR,aT,0.001,1,a8,true)}else{if(a0==="16"){G+=AddSetValueList(aN,a5,aO,al,a8,true)}else{if(a0==="20"&&al==="html"){G+=AddHTML(aN,a5,a8,false)}else{if(a0==="20"){G+=AddSetText(aN,a5,al,a8)}else{G+="Unbekannter Variablentyp!"}}}}}}}}}}});if(!ad){G=""}}else{if(at.type==="VARDP"){var an=at.id;var aI=unescape(at.info);var A=unescape(at.value);var K=at.valueType;var av=at.valueUnit;var E=at.valueName0;var D=at.valueName1;var aD=at.valueMin;var w=at.valueMax;var o=at.valueList;var aJ=at.date;var q=GetTimeDiffString(aJ,c);ar="";J=[];var l=aI.indexOf("(");if(l!==-1){var ak=aI.indexOf(")",l);if(ak!==-1){var C=aI.substring(l+1,ak);J=C.split(",");if(J.length>=1){ar=J[0].toLowerCase()}}}G+="<p>"+aI+"</p>";if(isReadOnly(aI)){G+=AddReadonlyVariable(an,A,q,K,av,o,E,D)}else{if(ar==="d"||ar==="dk"||ar==="g"||ar==="h"){aj=true;if(ar==="dk"){s=at.diagrams}else{s=A}k="chart_"+an;aB=av;if(ar==="g"){G+="<div id='"+k+"' style='height:200px; width:300px;'></div> <i class='ui-li-desc'>"+q+"</i>"}else{G+="<div id='"+k+"' style='height:300px; width:90%;'></div> <i class='ui-li-desc'>"+q+"</i>"}}else{if(ar==="nv"){G=""}else{if(K==="2"){G+=AddSetBoolButtonList(an,A,E,D,av,q,true)}else{if(K==="4"){G+=AddSetNumber(an,A,av,aD,w,0.001,1,q,true)}else{if(K==="16"){G+=AddSetValueList(an,A,o,av,q,true)}else{if(K==="20"&&av==="html"){G+=AddHTML(an,A,q,false)}else{if(K==="20"){G+=AddSetText(an,A,av,q)}else{G+="Unbekannter Variablentyp!"}}}}}}}}}else{if(at.type==="PROGRAM"){var S=at.id;var ap=at.info;var au=at.date;q=GetTimeDiffString(au,c);G+="<p>"+ap+"</p>";G+=AddStartProgramButton(S,"Ausf&uuml;hren",q)}}}if(G!==""){G+="</li>";$("#dataList").append(G)}if(aj){$("#dataList").listview("refresh");var ay="l";var aA="69A5CF";var ah="";var Y="";var aq=1;var aw="0/#008800";var m="30/#AA4400";for(V=0;V<J.length;V++){var R=J[V].split("=");if(R.length===2){if(R[0]==="t"){ay=R[1]}else{if(R[0]==="c"){aA=R[1]}else{if(R[0]==="l"){ah=R[1]}else{if(R[0]==="h"){Y=R[1]}else{if(R[0]==="k"){aq=parseInt(R[1])}else{if(R[0]==="s"){aw=R[1]}else{if(R[0]==="e"){m=R[1]}}}}}}}}}if(ar==="g"){var y=parseFloat(s);var ac=aw.split("/");var x=parseFloat(ac[0]);var H=ac[1];if(y<x){x=y}var aa=m.split("/");var Q=parseFloat(aa[0]);var n=aa[1];if(y>Q){Q=y}var g=parseInt(H.substring(1,3),16);var F=parseInt(H.substring(3,5),16);var ab=parseInt(H.substring(5,7),16);var T=parseInt(n.substring(1,3),16);var u=parseInt(n.substring(3,5),16);var e=parseInt(n.substring(5,7),16);var X=[];var az=[];var O=10;for(V=1;V<=O;V++){var W=V/O;var L=x+W*(Q-x);X.push(L);W=(V-1)/(O-1);var I=Math.floor(g+W*(T-g)).toString(16);if(I.length<2){I="0"+I}var N=Math.floor(F+W*(u-F)).toString(16);if(N.length<2){N="0"+N}var P=Math.floor(ab+W*(e-ab)).toString(16);if(P.length<2){P="0"+P}var Z="#"+I+N+P;az.push(Z)}var aH=[s];$.jqplot(k,[aH],{seriesDefaults:{renderer:$.jqplot.MeterGaugeRenderer,rendererOptions:{label:s+" "+aB,labelPosition:"bottom",labelHeightAdjust:-5,min:x,max:Q,intervals:X,intervalColors:az}},grid:{backgroundColor:"transparent"}})}else{if(ar==="h"){var aG=s.split(";");var am=aG[0];if(am>0){var ax=new Array();ax[0]=new Array();ax[1]=new Array();ax[2]=new Array();ax[3]=new Array();ax[4]=new Array();var U=0;var h;if(ah===""){h=15}else{h=parseFloat(ah)}var p;if(Y===""){p=23}else{p=parseFloat(Y)}var aF="";var ai="";for(V=1;V<=am;V++){var M=aG[V];var aC=M.split(",");var ag=aC[0];if(aF===""||ag<aF){aF=ag}if(ai===""||ag>ai){ai=ag}for(U=1;U<aC.length;U++){var aE=new Array();aE[0]=ag;var ae=aC[U];aE[1]=ae;ax[U-1][V-1]=aE}}}$.jqplot(k,[ax[0],ax[1],ax[2],ax[3],ax[4]],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%a, %#d %#H:%M",angle:20},min:aF,max:ai},yaxis:{min:h,max:p,showLabel:true,tickOptions:{formatString:"%."+aq+"f&deg;C"}},y2axis:{min:0,max:100,showLabel:true,tickOptions:{formatString:"%d%"}}},legend:{show:false,fontSize:23,placement:"outside",location:"e"},seriesDefaults:{lineWidth:2,showMarker:false,fill:false,shadow:false},series:[{label:"Soll",color:"#555555",fill:true,fillAlpha:0.1},{label:"Ist",color:"#DD0000"},{label:"relF%",color:"#0174DF",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis",lineWidth:1},{label:"Ventil",color:"#777777",yaxis:"y2axis"}],highlighter:{show:true,sizeAdjust:5.5},cursor:{zoom:true,show:true},grid:{backgroundColor:"#F4F4F4"}})}else{if(ay==="l"||ay==="f"){aG=s.split(",");am=aG.length;if(am>=3){ax=new Array();U=0;h=1000000;p=-1000000;aF="";ai="";for(V=1;V<am;V=V+2){ag=aG[V];ae=aG[V+1];var ao=new Array();ao[0]=ag;L;if(ae==="true"){L=1}else{if(ae==="false"){L=0}else{L=parseFloat(ae)}}ao[1]=L;if(L<h){h=L}if(L>p){p=L}if(aF===""||ag<aF){aF=ag}if(ai===""||ag>ai){ai=ag}ax[U]=ao;U++}if(ah===""){h=h-0.1*(p-h)}else{if(ah==="m"){}else{var z=parseFloat(ah);if(z<h){h=z}}}if(Y===""){p=p+0.1*(p-h)}else{if(Y==="m"){}else{var af=parseFloat(Y);if(af>p){p=af}}}var r;if(ay==="l"){r=false}else{r=true}plotDiagram=$.jqplot(k,[ax],{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%b %#d, %#H:%M",angle:20},min:aF,max:ai},yaxis:{min:h,max:p,tickOptions:{formatString:"%."+aq+"f"+aB}}},seriesDefaults:{rendererOptions:{smooth:true}},series:[{color:"#"+aA,lineWidth:2,showMarker:false,fill:r}],highlighter:{show:true,sizeAdjust:5.5},cursor:{show:false},grid:{backgroundColor:"#F4F4F4"}})}}}}}}});$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>"+d.name+"<p style='float:right;'>"+c+"</p></li>");$("#dataListHeader").listview().listview("refresh");$("#buttonRefresh .ui-btn-text").html("&nbsp;");$("#dataList").listview().listview("refresh");$("#dataList").trigger("create");$(".ui-input-search .ui-input-text").trigger("change");$("[id^=button]").trigger("create");$("[id^=input]").trigger("create");if(b===-1){ScrollToContentHeader()}else{ScrollToPosition(b)}})}function loadVariables(a){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var c=false;if(a){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>Lade...</li>").listview("refresh");if(localStorage.getItem("webmaticVariablesMap")===null){$.ajax({type:"GET",url:"cgi/systemvariables.cgi",dataType:"json",success:function(d){variablesMap=d;localStorage.setItem("webmaticVariablesMap",JSON.stringify(variablesMap))},async:false});c=true}else{variablesMap=JSON.parse(localStorage.getItem("webmaticVariablesMap"))}var b=variablesMap.date;$.each(variablesMap.entries,function(e,d){var g=d.visible==="true";var f=d.id;if((readModus&&g)||!readModus){$("#dataList").append(processVariable(d,f,b))}});reloadList("Systemvariablen",b)}if(!c){$.getJSON("cgi/systemvariables.cgi",function(e){var d=e.date;$.each(e.entries,function(g,f){var j=f.visible==="true";var h=f.id;if($("#"+h).length===0&&((readModus&&j)||!readModus)){$("#dataList").append(processVariable(f,h,d))}else{if((readModus&&j)||!readModus){$("#"+h).replaceWith(processVariable(f,h,d))}else{if($("#"+h).length!==0){$("#"+h).hide()}}}});localStorage.setItem("webmaticVariablesMap",JSON.stringify(e));reloadList("Systemvariablen",d)})}$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change")}function loadPrograms(a){$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");var c=false;if(a){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>Lade...</li>").listview("refresh");if(localStorage.getItem("webmaticProgramsMap")===null){$.ajax({type:"GET",url:"cgi/programs.cgi",dataType:"json",success:function(d){programsMap=d;localStorage.setItem("webmaticProgramsMap",JSON.stringify(programsMap))},async:false});c=true}else{programsMap=JSON.parse(localStorage.getItem("webmaticProgramsMap"))}var b=programsMap.date;$.each(programsMap.entries,function(f,h){var e=h.visible==="true";var d=h.active==="true";var g=h.id;if((readModus&&e&&d)||!readModus){$("#dataList").append(processProgram(h,g,b))}});reloadList("Programme",b);$("#dataList").find(".btnDisabled").button("disable")}if(!c){$.getJSON("cgi/programs.cgi",function(e){var d=e.date;$.each(e.entries,function(h,k){var g=k.visible==="true";var f=k.active==="true";var j=k.id;if($("#"+j).length===0&&((readModus&&g&&f)||!readModus)){$("#dataList").append(processProgram(k,j,d))}else{if((readModus&&g&&f)||!readModus){$("#"+j).replaceWith(processProgram(k,j,d))}else{if($("#"+j).length!==0){$("#"+j).hide()}}}});localStorage.setItem("webmaticProgramsMap",JSON.stringify(e));reloadList("Programme",d);$("#dataList").find(".btnDisabled").button("disable")})}$("#buttonRefresh .ui-btn-text").html("&nbsp;");$(".ui-input-search .ui-input-text").trigger("change")}function loadGraphicIDs(){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li><img src='img/misc/wait16.gif' width=12px height=12px class='ui-li-icon ui-img-"+theme+"'>Lade...</li>").listview("refresh");$("#buttonRefresh .ui-btn-text").html("<img class='ui-img-"+theme+"' src='img/misc/wait16.gif' width=12px height=12px>");if(localStorage.getItem("webmaticFavoritesMap")===null){$.ajax({type:"GET",url:"cgi/favorites.cgi",dataType:"json",success:function(a){favoritesMap=a;localStorage.setItem("webmaticFavoritesMap",JSON.stringify(favoritesMap))},async:false})}else{favoritesMap=JSON.parse(localStorage.getItem("webmaticFavoritesMap"));$.getJSON("cgi/favorites.cgi",function(a){localStorage.setItem("webmaticFavoritesMap",JSON.stringify(a))})}$("#dataList").append("<li data-role='list-divider' role='heading'>Favoriten</li>");processGraphicID("favorites",favoritesMap);if(localStorage.getItem("webmaticRoomsMap")===null){$.ajax({type:"GET",url:"cgi/rooms.cgi",dataType:"json",success:function(a){roomsMap=a;localStorage.setItem("webmaticRoomsMap",JSON.stringify(roomsMap))},async:false})}else{roomsMap=JSON.parse(localStorage.getItem("webmaticRoomsMap"));$.getJSON("cgi/rooms.cgi",function(a){localStorage.setItem("webmaticRoomsMap",JSON.stringify(a))})}$("#dataList").append("<li data-role='list-divider' role='heading'>R&auml;ume</li>");processGraphicID("rooms",roomsMap);if(localStorage.getItem("webmaticFunctionsMap")===null){$.ajax({type:"GET",url:"cgi/functions.cgi",dataType:"json",success:function(a){functionsMap=a;localStorage.setItem("webmaticFunctionsMap",JSON.stringify(functionsMap))},async:false})}else{functionsMap=JSON.parse(localStorage.getItem("webmaticFunctionsMap"));$.getJSON("cgi/functions.cgi",function(a){localStorage.setItem("webmaticFunctionsMap",JSON.stringify(a))})}$("#dataList").append("<li data-role='list-divider' role='heading'>Gewerke</li>");processGraphicID("functions",functionsMap);$("#dataList").listview("refresh");$("img.lazyLoadImage").lazyload({event:"lazyLoadInstantly"});$("img").trigger("lazyLoadInstantly");$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>Grafik IDs</li>");$("#dataListHeader").listview("refresh");$("#buttonRefresh .ui-btn-text").html("&nbsp;");$("#dataList").listview("refresh");$("#dataList").trigger("create")}function loadOptions(){$("#dataList").empty();$("#dataListHeader").empty();$("#dataListHeader").append("<li data-role='list-divider' role='heading'>Optionen</li>");var b="<li><h1>Gr&ouml;&szlig;e der Menugrafiken</h1><p><div data-role='fieldcontain'>";b+="<div data-role='controlgroup' data-type='horizontal'>";var d=localStorage.getItem("optionsMenuGfxSize");var a="";var e="";if(!d||d===""||d==="large"){e="class='ui-btn-active'"}else{a="class='ui-btn-active'"}b+="<a href='#' id='optionsMenuGfxSizeSmall' data-id='optionsMenuGfxSizeSmall' data-role='button' data-inline='true' "+a+">Klein</a>";b+="<a href='#' id='optionsMenuGfxSizeLarge' data-id='optionsMenuGfxSizeLarge' data-role='button' data-inline='true' "+e+">Gro&szlig;</a>";b+="</div></li>";$("#dataList").append(b);b="<li><h1>Testseiten anzeigen</h1><p><div data-role='fieldcontain'>";var c=localStorage.getItem("optionsMenuShowTestpages");if(!c||c===""||c==="false"){a="";e="class='ui-btn-active'"}else{a="class='ui-btn-active'";e=""}b+="<div data-role='controlgroup' data-type='horizontal'>";b+="<a href='#' id='optionsMenuShowTestpages' data-id='optionsMenuShowTestpages' data-role='button' data-inline='true' "+a+">Anzeigen</a>";b+="<a href='#' id='optionsMenuHideTestpages' data-id='optionsMenuHideTestpages' data-role='button' data-inline='true' "+e+">Verstecken</a>";b+="</div></li>";$("#dataList").append(b);b="<li><h1>Theme ausw&auml;hlen</h1><p><div data-role='fieldcontain'>";b+="<div data-role='controlgroup' data-type='horizontal'>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='a' class='"+(theme==="a"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Normal</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='b' class='"+(theme==="b"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Schwarz</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='c' class='"+(theme==="c"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Rosa</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='d' class='"+(theme==="d"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Gr&uuml;n</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='e' class='"+(theme==="e"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Gelb</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='f' class='"+(theme==="f"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Grau</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='g' class='"+(theme==="g"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Blau</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='h' class='"+(theme==="h"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Rot</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='i' class='"+(theme==="i"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Braun</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='j' class='"+(theme==="j"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Wei&szlig;</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='k' class='"+(theme==="k"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Brazil</a>";b+="<a href='#' name='optionsMenuGfxThemeChooser' data-value='l' class='"+(theme==="l"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Deutschland</a>";b+="</div><br/><br/><br/>";b+="<div data-role='controlgroup' data-type='horizontal'>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='a' class='"+(font==="a"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Normal</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='b' class='"+(font==="b"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Koch Fraktur</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='c' class='"+(font==="c"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Planet Benson</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='d' class='"+(font==="d"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Action Man</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='e' class='"+(font==="e"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Amadeus</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='f' class='"+(font==="f"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Vamp</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='g' class='"+(font==="g"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>HennyPenny</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='h' class='"+(font==="h"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Anglican</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='i' class='"+(font==="i"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Nosifer</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='j' class='"+(font==="j"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Pacifico</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='k' class='"+(font==="k"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Sixties</a>";b+="<a href='#' name='optionsMenuGfxFontChooser' data-value='l' class='"+(font==="l"?"ui-btn-active":"")+"' data-role='button' data-inline='true'>Crackman</a>";b+="</div></li>";$("#dataList").append(b);b="<li><h1>WebMatic neu laden, damit alle Einstellungen wirksam werden</h1><p><div data-role='fieldcontain'>";b+="<a href='#' id='reloadWebMatic' data-id='reloadWebMatic' data-role='button' data-inline='true'>Neu laden</a>";b+="</li>";$("#dataList").append(b);$("#dataListHeader").listview("refresh");$("#dataList").listview("refresh");$("#dataList").trigger("create")}$(function(){$(document).bind("mobileinit",function(){$.mobile.listview.prototype.options.filterPlaceholder="Daten filtern..."});$(document.body).on("click","[id^=setButton]",function(){var a=$(this).data("id");var c=$(this).data("refresh");var d=$(this).data("value");var b="info_"+a;$("#"+b).text("Übertrage...");$.getJSON("cgi/set.cgi?id="+a+"&value="+d,function(){if(c){$("#"+b).text("OK!");RefreshPage(0,true)}else{$("#"+b).text("Wert wird noch an Gerät übertragen und erst verzögert hier dargestellt.")}})});$(document.body).on("click","[id^=setNumberButton]",function(){var b=$(this).data("id");var e=$(this).data("refresh");var a="setValue_"+b;var d="info_"+b;var g=$("#"+a).val();var c=$("#"+a).data("factor");var f=parseFloat(g)/c;$("#"+d).text("Übertrage...");$.getJSON("cgi/set.cgi?id="+b+"&value="+f,function(){if(e){$("#"+d).text("OK!");RefreshPage(0,true)}else{$("#"+d).text("Wert wird noch an Gerät übertragen und erst verzögert hier dargestellt.")}})});$(document.body).on("click","[id^=setBoolButton]",function(){var b=$(this).data("id");var a="setValue_"+b;var c="info_"+b;var d=$("#"+a).val();$("#"+c).text("Übertrage...");$.getJSON("cgi/set.cgi?id="+b+"&value="+d,function(){$("#"+c).text("OK!");RefreshPage(0,true)})});$(document.body).on("click","[id^=setValueListButton]",function(){var b=$(this).data("id");var a="setValue_"+b;var c="info_"+b;var d=$("#"+a).val();$("#"+c).text("Übertrage...");$.getJSON("cgi/set.cgi?id="+b+"&value="+d,function(){$("#"+c).text("OK!");RefreshPage(0,true)})});$(document.body).on("click","[id^=setTextButton]",function(){var b=$(this).data("id");var a="setValue_"+b;var c="info_"+b;var d=$("#"+a).val();d=d.replace(/\"/g,"'");d=encodeURIComponent(d);$("#"+c).text("Übertrage...");$.getJSON("cgi/set.cgi?id="+b+"&value="+d,function(){$("#"+c).text("OK!");RefreshPage(0,true)})});$(document.body).on("click","[id^=startProgramButton]",function(){var a=$(this).data("id");var b="info_"+a;$("#"+b).text("Starte...");$.getJSON("cgi/startprogram.cgi?id="+a,function(){$("#"+b).text("OK!")})});$(document.body).on("change",":file",function(){var b=this.files[0];if(b.name.length<1){}else{if(b.type!=="image/png"&&b.type!=="image/jpg"&&!b.type!=="image/gif"&&b.type!=="image/jpeg"){$.mobile.alert("Es können nur JPG, GIF oder PNG hochgeladen werden!")}else{var c=$(this).attr("id");var a=c.substr(4,c.length);$("#uploadPicture"+a).removeClass("ui-state-disabled")}}});$(document.body).on("click","a[name=uploadPicture]",function(){var f=$(this).attr("id");var c=f.substr(13,f.length);var d=$(this).data("type");var e=new FormData();var b=document.getElementById("file"+c).files[0];var a=new FileReader();a.onloadend=function(){var g=new Image();g.src=a.result;g.onload=function(){var n=160;var j=160;var q=g.width;var k=g.height;if(q>k){if(q>n){k*=n/q;q=n}}else{if(k>j){q*=j/k;k=j}}var l=document.createElement("canvas");l.width=q;l.height=k;var v=l.getContext("2d");v.drawImage(this,0,0,q,k);var m=l.toDataURL("image/png");var u=atob(m.split(",")[1]);var o=new ArrayBuffer(u.length);var t=new Uint8Array(o);for(var p=0;p<u.length;p++){t[p]=u.charCodeAt(p)&255}var h;try{h=new Blob([o],{type:"image/png"})}catch(r){var s=new (window.WebKitBlobBuilder||window.MozBlobBuilder);s.append(o);h=s.getBlob("image/png")}$("#img"+c).fadeOut(500,function(){$("#img"+c).attr("src",m).fadeIn(1000)});$("#menuImg"+c).fadeOut(500,function(){$("#menuImg"+c).attr("src",m).fadeIn(1000)});e.append("file",h,c+".png");e.append("filename",c+".png");e.append("path","/usr/local/etc/config/addons/www/webmatic_user/img/ids/"+d+"/");$.ajax({url:"cgi/upload.cgi",type:"POST",data:e,cache:false,contentType:false,processData:false},"json")};$("#uploadPicture"+c).addClass("ui-state-disabled")};a.readAsDataURL(b)})});